(()=>{var __webpack_modules__={6966:(e,t,r)=>{"use strict";r.d(t,{J:()=>u});var n=r(8779),a=r.n(n),s=r(9293),o=r.n(s),c=function(e){return e&&"object"===o()(e)&&!Array.isArray(e)},u=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;t="undefined"===t?{}:t;var n=Object.assign({},t);return c(t)&&c(r)&&Object.keys(r).forEach((function(s){var u=r[s];u&&("object"===o()(u)&&0===u.length||(c(r[s])&&s in t?n[s]=e(t[s],r[s]):Object.assign(n,a()({},s,r[s]))))})),n}},2826:(e,t,r)=>{"use strict";r.d(t,{GB:()=>c,Jp:()=>l,iK:()=>i,in:()=>p,n6:()=>u});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=function(){var e=a()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("collections"),e.next=3,n.findOne(r);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),u=function(){var e=a()(o().mark((function e(t,r,n){var a,s,c,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:null,s=t.collection("collections"),e.next=4,s.findOne({collectionName:n,projectId:r});case 4:if(c=e.sent,!a){e.next=9;break}if(c){e.next=8;break}return e.abrupt("return",{code:404,message:"Collection not found with provided name"});case 8:return e.abrupt("return",{code:200,message:"success",data:c});case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),i=function(){var e=a()(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("collections").findOne(r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=a()(o().mark((function e(t,r,n,a){var s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[{$match:{collectionName:n,projectId:r}},{$addFields:{finder:{$filter:{input:"$finders",as:"finder",cond:{$eq:["$$finder.uuid",a]}}},refCollectionFields:{$filter:{input:"$fields",as:"fields",cond:{$or:[{$eq:["$$fields.type","reference"]},{$eq:["$$fields.type","multi_reference"]},{$eq:["$$fields.type","belongsTo"]},{$eq:["$$fields.type","createdBy"]}]}}}}},{$unwind:"$finder"},{$addFields:{filterFinder:"$finder"}},{$unwind:{path:"$finder.conditions",preserveNullAndEmptyArrays:!0}},{$group:{_id:null,filterFinder:{$first:"$filterFinder"},fields:{$first:"$fields"},noOfExternalParams:{$first:"$finder.noOfExternalParams"},isPrivate:{$first:"$finder.isPrivate"},finder:{$first:"$finder"},refCollectionFields:{$first:"$refCollectionFields"},constants:{$first:"$constants"},isInMemory:{$first:"$isInMemory"},projectId:{$first:"$projectId"},lastRefreshTime:{$first:"$lastRefreshTime"},collectionName:{$first:"$collectionName"},externalParams:{$push:{$cond:[{$and:[{$gt:["$finder.noOfExternalParams",0]},{$eq:["$finder.conditions.requiredExternal",!0]}]},"$finder.conditions.query.value","$$REMOVE"]}}}},{$project:{noOfExternalParams:1,finder:"$filterFinder",isInMemory:1,lastRefreshTime:1,constants:1,collectionName:1,refCollectionFields:1,externalParams:1,projectId:1,isPrivate:1,fields:1}}],e.next=3,t.collection("collections").aggregate(s).toArray();case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),p=function(){var e=a()(o().mark((function e(t,r,n,a){var s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t,{collectionName:n,projectId:r});case 2:return s=e.sent,u=s.fields.find((function(e){return e.fieldName===a})),e.abrupt("return",u.validation);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},7525:(e,t,r)=>{"use strict";r.d(t,{S:()=>n,V:()=>a});var n=["staging","preview","beta","alpha"],a=["development","preview","cms"]},3515:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(1359),u=r(6540),i=r(7525),l=r(4587),p="localhost",_="27017",d="localhost",f="27017",m=process.env.PROJECT_HOSTNAME;p=p||"localhost",_=_||27017,d=d||"localhost",f=f||27017;const b=function(){var e=a()(o().mark((function e(){var t,r,n,a,s,b,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.Z.info("PROJECT_HOSTNAME ".concat(m)),m){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t={apiDomainName:m},u.Z.info("globalDBConnection query",t),e.next=8,(0,l.I)(d,"project_detail",f);case 8:return r=e.sent,e.next=11,(0,c.T3)(r,t);case 11:if(n=e.sent,r.close(),global.Global_db=null,global.Global_builderDB=null,!n){e.next=50;break}return a="project_".concat(n.uuid),s="project_config_".concat(n.uuid),e.prev=18,e.next=21,(0,l.I)(p,a,_);case 21:return global.Global_db=e.sent,e.next=24,(0,l.I)(d,s,d);case 24:global.Global_builderDB=e.sent,e.next=30;break;case 27:e.prev=27,e.t0=e.catch(18),u.Z.error("error Failed to Connect Project Database ".concat(e.t0));case 30:if(global.Global_perconaDb=null,global.Global_projectRemoteDb=null,!(b=n.mongoConfig)){e.next=37;break}return e.next=36,(0,l.X)(b);case 36:global.Global_projectRemoteDb=e.sent;case 37:v=null,i.V.includes("development")&&(v=n.environments.find((function(e){return"PREVIEW"===e.envType}))),global.Global_projectId=n.uuid,global.Global_projectName=n.name,global.Global_projectCreatedAt=n.createdAt,global.Global_projectConstants=n.constants,global.Global_key=n.environments,global.Global_timezone=n.timezone,global.Global_environment=v,global.Global_apiPublicAccess=n.enableDevKey,global.Global_connectorApiKey=n.connectorApiKey,e.next=52;break;case 50:return u.Z.error("This url does not exist. Please publish again."),e.abrupt("return");case 52:e.next=59;break;case 54:return e.prev=54,e.t1=e.catch(3),u.Z.error("error failed to connect builder database :>> ".concat(e.t1)),u.Z.info("This url does not exist. Failed to connect to database."),e.abrupt("return");case 59:case"end":return e.stop()}}),e,null,[[3,54],[18,27]])})));return function(){return e.apply(this,arguments)}}()},4587:(e,t,r)=>{"use strict";r.d(t,{I:()=>l,X:()=>p});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(1185),u=r.n(c),i=r(6540),l=function(){var e=a()(o().mark((function e(t,r){var n,a,s,c,l,p=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>2&&void 0!==p[2]?p[2]:27017,a=p.length>3&&void 0!==p[3]?p[3]:"",s=p.length>4&&void 0!==p[4]?p[4]:"",c="mongodb://".concat(t,":").concat(n),a&&(c="mongodb://".concat(a,":").concat(s,"@").concat(t,":").concat(n)),i.Z.info("connectionUrl: >> ".concat(c)),e.next=8,u().createConnection(c,{autoIndex:!1,maxPoolSize:1e3,socketTimeoutMS:45e3,dbName:r,useNewUrlParser:!0});case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),p=function(){var e=a()(o().mark((function e(t){var r,n,a,s,c,l,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tabType,n=t.username,a=t.password,s=t.host,c=t.port,l=t.databaseName,"",p="mongoAtlas"===r?"mongodb+srv://".concat(encodeURIComponent(n),":").concat(encodeURIComponent(a),"@").concat(s,"/").concat(l,"?retryWrites=true&w=majority"):"mongodb://".concat(encodeURIComponent(n),":").concat(encodeURIComponent(a),"@").concat(s,":").concat(c,"/").concat(l),e.prev=3,i.Z.info("mongoUrl :>> ".concat(p)),e.next=7,u().createConnection(p);case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e.catch(3),i.Z.error("error :>> ".concat(e.t0)),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()},1758:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Uk:()=>prepareObjectToDeveloperLogs,_H:()=>genericQuery,vy:()=>processItemsByFilter});var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9591),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1307),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),drapcode_utility__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7060),drapcode_utility__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(drapcode_utility__WEBPACK_IMPORTED_MODULE_2__),_collection_collection_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2826),_item_item_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(8194),_loginPlugin_jwtUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4554),processItemsByFilter=function(){var _ref=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee2(builderDB,dbConnection,perconaDb,projectId,collectionName,filterUuid,headerToken,timezone,headers){var queryData,count,search,stopNestedFilter,collection,_collection,isPrivate,constants,externalParams,finder,noOfExternalParams,refCollectionFields,fields,isInMemory,lastRefreshTime,req,currentUser,authData,reqQueryParams,searchObj,serachQueryTypeObj,refCollectionFieldsInItems,query,result,_args2=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return queryData=_args2.length>9&&void 0!==_args2[9]?_args2[9]:{},count=_args2.length>10&&void 0!==_args2[10]?_args2[10]:0,search=_args2.length>11&&void 0!==_args2[11]?_args2[11]:0,stopNestedFilter=_args2.length>12&&void 0!==_args2[12]&&_args2[12],_context2.next=6,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_3__.Jp)(builderDB,projectId,collectionName,filterUuid);case 6:if(collection=_context2.sent,console.log("collection :>> ",collection),collection&&collection.length){_context2.next=10;break}return _context2.abrupt("return",{code:404,message:"No collection ".concat(collectionName," found")});case 10:if(collection=collection[0],_collection=collection,isPrivate=_collection.isPrivate,constants=_collection.constants,externalParams=_collection.externalParams,finder=_collection.finder,noOfExternalParams=_collection.noOfExternalParams,refCollectionFields=_collection.refCollectionFields,fields=_collection.fields,isInMemory=_collection.isInMemory,lastRefreshTime=_collection.lastRefreshTime,req=null,req=isInMemory&&perconaDb?{db:perconaDb}:{db:dbConnection},console.log("req",lastRefreshTime),isPrivate="".concat(isPrivate),"true"!=isPrivate){_context2.next=23;break}return _context2.next=19,processAuthentication(builderDB,dbConnection,projectId,headerToken);case 19:if(authData=_context2.sent,200===authData.code){_context2.next=22;break}return _context2.abrupt("return",authData);case 22:currentUser=authData.data;case 23:if(stopNestedFilter&&(finder.fieldsInclude=["uuid"]),0==noOfExternalParams){_context2.next=30;break}if(externalParams=externalParams.map((function(e){return e.split("---")})),externalParams=externalParams.flat(),reqQueryParams=Object.keys(queryData),externalParams.every((function(e){return reqQueryParams.includes(e)}))){_context2.next=30;break}return _context2.abrupt("return",{code:422,message:"External params should be in [".concat(externalParams,"]")});case 30:if(searchObj=null,serachQueryTypeObj={},search&&(searchObj=Object.assign({},queryData),delete searchObj.offset,delete searchObj.limit,externalParams.length&&externalParams.forEach((function(e){delete searchObj[e]})),Object.keys(searchObj).forEach((function(e){var t=fields.find((function(t){return t.fieldName===e}));t||delete searchObj[e],t&&(serachQueryTypeObj[e]=t.type)}))),!finder||!finder.conditions.length){_context2.next=36;break}return _context2.next=36,Promise.all(finder.conditions.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(t){var r,n,a,s,o,c,u,i;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.query){e.next=2;break}return e.abrupt("return");case 2:if(r=t.query,n=r.fieldType,a=r.refCollection,s=r.refField,o=r.isFilter,c=r.field,u=r.value,"reference"!==n&&"belongsTo"!==n){e.next=21;break}if(a){e.next=6;break}return e.abrupt("return");case 6:if(i=[],!o||stopNestedFilter){e.next=13;break}return e.next=10,(0,_item_item_service__WEBPACK_IMPORTED_MODULE_4__.MZ)(builderDB,dbConnection,perconaDb,projectId,a,u,queryData,headerToken,timezone,headers);case 10:i=e.sent,e.next=17;break;case 13:return e.next=15,(0,_item_item_service__WEBPACK_IMPORTED_MODULE_4__.o5)(dbConnection,perconaDb,a,finder,queryData,constants,currentUser,timezone,t,s);case 15:i=e.sent,t.query.field=c;case 17:t.query.fieldType="static_option",t.query.key="IN_LIST",t.query.value=i,t.requiredExternal=!1;case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 36:if(count&&(finder.finder="COUNT"),console.log(")))))))))))))))))))))))))))))))))"),_context2.prev=38,refCollectionFieldsInItems=refCollectionFields&&refCollectionFields.length?refCollectionFields:null,query="",console.log(finder.finder,"--------finder--------"),!["SUM","AVG","MIN","MAX"].includes(finder.finder)){_context2.next=48;break}return _context2.next=45,(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_2__.queryParserNew)(collectionName,finder,constants,queryData,currentUser,timezone,searchObj,refCollectionFieldsInItems,serachQueryTypeObj);case 45:query=_context2.sent,_context2.next=51;break;case 48:return _context2.next=50,(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_2__.queryParser)(collectionName,finder,constants,queryData,currentUser,timezone,searchObj,refCollectionFieldsInItems,serachQueryTypeObj);case 50:query=_context2.sent;case 51:return console.log("query $$$$$$$$$$$",query),_context2.next=54,eval(query);case 54:return result=_context2.sent,console.log(":::::::::result",result),"COUNT"==finder.finder?result="".concat(result&&result.length?result[0].count:0):"SUM"==finder.finder?result="".concat(result&&result.length?result[0].total:0):"AVG"==finder.finder?result="".concat(result&&result.length?result[0].average:0):"MIN"==finder.finder?result="".concat(result&&result.length?result[0].minimum:0):"MAX"==finder.finder&&(result="".concat(result&&result.length?result[0].maximum:0)),_context2.abrupt("return",{code:200,message:"success",result,count});case 60:return _context2.prev=60,_context2.t0=_context2.catch(38),console.log("error :>> ",_context2.t0),_context2.abrupt("return",{code:400,message:_context2.t0.message});case 64:case"end":return _context2.stop()}}),_callee2,null,[[38,60]])})));return function(e,t,r,n,a,s,o,c,u){return _ref.apply(this,arguments)}}(),processAuthentication=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(t,r,n,a){var s,o,c;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",{code:401,message:"Authentication Failed. Please login."});case 2:return e.next=4,(0,_loginPlugin_jwtUtils__WEBPACK_IMPORTED_MODULE_5__.WX)(a);case 4:if((s=e.sent)&&0!==Object.keys(s).length&&Object.keys(s).includes("sub")){e.next=7;break}return e.abrupt("return",{code:403,message:"Authorization Failed. Please send valid token."});case 7:return e.next=9,(0,_item_item_service__WEBPACK_IMPORTED_MODULE_4__.ME)(t,r,n,"user",null,{$or:[{email:s.sub},{userName:s.sub}]});case 9:if(o=e.sent,c=o.data){e.next=13;break}return e.abrupt("return",{code:401,message:"Authentication Failed. Please login."});case 13:return e.abrupt("return",{code:200,data:c});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),genericQuery=function(e,t){var r=e.max,n=void 0===r?100:r,a=e.offset;"max"in e&&delete e.max,"offset"in e&&delete e.offset,"ids"in e&&delete e.ids;var s=e,o=[{$match:{}}];for(var c in s){var u=c.split(":")[0],i=c.split(":")[1],l=compareFieldsType({fieldName:u,value:s[c],fields:t});o[0].$match[u]=checkKey(i,l)}return o.push({$sort:{_id:-1}}),a&&o.push({$skip:parseInt(a)}),o.push({$limit:parseInt(n)}),o},compareFieldsType=function(e){var t=e.fieldName,r=e.value,n=e.fields,a=r;return n.map((function(e){e.fieldName===t&&"number"===e.type&&(a=+r)})),a},checkKey=function(e,t){switch(e){case"IS_NOT_NULL":return{$ne:null};case"IS_NULL":return null;case"EQUALS":return t;case"IN_LIST":return Array.isArray(t)||(t=[t]),{$in:t};case"NOT_IN_LIST":return Array.isArray(t)||(t=[t]),{$nin:t};case"LIKE":return{$regex:t,$options:"i"};case"LESS_THAN_EQUALS_TO":return{$lte:t};case"GREATER_THAN_EQUALS_TO":return{$gte:t};case"LESS_THAN":return{$lt:t};case"GREATER_THAN":return{$gt:t}}},prepareObjectToDeveloperLogs=function(e,t,r,n){var a=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(a){var s={body:e,header:t,url:r,response:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,method:n,status:arguments.length>5&&void 0!==arguments[5]?arguments[5]:400,error:arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,type:"DEVELOPER_API",token:arguments.length>7&&void 0!==arguments[7]?arguments[7]:null};(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_2__.dbLogger)(s,a)}}},8378:(e,t,r)=>{"use strict";r.d(t,{UC:()=>i,jg:()=>p,tx:()=>l});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(5828),u=r(1421),i=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("templates"),e.next=3,n.findOne(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("templates"),e.next=3,n.find(r).toArray();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),p=function(){var e=a()(o().mark((function e(t,r){var n,a,s,i,l,p,d,f,m,b;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.parentTemplateId){e.next=2;break}return e.abrupt("return",{code:403,message:"Parent Template is required."});case 2:return n=t.collection("templates"),a={uuid:r.parentTemplateId,templateType:r.templateType,projectId:r.projectId},e.next=6,n.findOne(a);case 6:if(s=e.sent,console.log("==> createTenantTemplate parentTemplate :>> ",s),s){e.next=10;break}return e.abrupt("return",{code:403,message:"Selected Parent Template doesn't exists."});case 10:return i={templateType:r.templateType,parentTemplateId:r.parentTemplateId,projectId:r.projectId},e.next=13,n.find(i).toArray();case 13:if(l=e.sent,console.log("==> createTenantTemplate allExistingTenantTemplates :>> ",l),p=r?r.tenants.map((function(e){return e.uuid})):[],!(d=_(l,p))){e.next=20;break}return console.log("==> createTenantTemplate templateHasTenantId ***",d),e.abrupt("return",{code:403,message:"Tenant Template for the selected Template already exists."});case 20:return r.uuid=(0,c.v4)(),r.name=s.name,r.collectionId=s.collectionId?s.collectionId:"",f="".concat("http://localhost:5000/api/","projects/").concat(r.projectId,"/tenant-template"),e.prev=24,e.next=27,(0,u.nN)(f,r);case 27:if(!(m=e.sent)){e.next=45;break}return e.next=31,n.deleteOne({uuid:m.uuid});case 31:return e.prev=31,e.next=34,n.insertOne(m);case 34:if(!(b=e.sent)||!b.insertedCount){e.next=38;break}return console.log("==> createTenantTemplate result :>> ",b.insertedId),e.abrupt("return",b.ops[0]);case 38:e.next=45;break;case 40:throw e.prev=40,e.t0=e.catch(31),console.log("error :>> ",e.t0),console.log("Failed to save tenant template in project_detail db"),new Error("Failed to save data");case 45:e.next=52;break;case 47:throw e.prev=47,e.t1=e.catch(24),console.log("error :>> ",e.t1),console.log("Failed to save tenant template in builder db"),new Error("Failed to save data");case 52:case"end":return e.stop()}}),e,null,[[24,47],[31,40]])})));return function(t,r){return e.apply(this,arguments)}}(),_=function(e,t){var r=!1;return e&&e.forEach((function(e){if(!r){var n=e&&e.tenants?e.tenants.map((function(e){return e.uuid})):[],a=n&&n.length&&t&&t.length?n.filter((function(e){return t.includes(e)})):[];console.log("tenantIds :>> ",a),a&&a.length&&(r=!0)}})),r}},6837:(e,t,r)=>{"use strict";r.d(t,{$3:()=>D,Am:()=>x,BO:()=>y,UB:()=>I,fm:()=>k});var n=r(8779),a=r.n(n),s=r(9591),o=r.n(s),c=r(1307),u=r.n(c),i=r(9336),l=r.n(i),p=r(8378),_=r(8027),d=r(8194),f=r(4554),m=r(177),b=r(7714),v=r(2826);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=function(){var e=o()(u().mark((function e(t){var r,n,a,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.toEmail,n=t.subject,a=t.htmlBody,e.next=3,E(r,n,a);case 3:return s=e.sent,console.log(s),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=o()(u().mark((function e(t){var r,n,a,s,o,c,i,l,h,x,y,k,D,P,I,w,T,M,A,C,R,L,B,j,U,N,S,W,K,F,$,q,G,J,Z,H,z,V,Q,X,Y;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.db,o=t.body,c=t.params,i=t.projectId,l=t.projectName,h=t.environment,x=t.user,y=o.sendTo,k=o.previousActionResponse,D=o.previousActionFormData,!(P=(x||"").uuid)){e.next=18;break}return e.next=6,(0,d.ME)(a,s,i,"user",P);case 6:if(e.t2=r=e.sent,e.t1=null===e.t2,e.t1){e.next=10;break}e.t1=void 0===r;case 10:if(!e.t1){e.next=14;break}e.t3=void 0,e.next=15;break;case 14:e.t3=r.data;case 15:e.t0=e.t3,e.next=19;break;case 18:e.t0={};case 19:return I=e.t0,e.next=22,(0,p.UC)(a,{uuid:c.templateId});case 22:if(w=e.sent,T={},M={},A=!1,C=null==t||null===(n=t.headers)||void 0===n?void 0:n.origin,T.siteUrl=C,T.projectName=l,!w||w.collectionId!==m.B0||!y){e.next=46;break}return R={$or:[{email:y},{userName:y}]},e.next=34,(0,d.ME)(a,s,i,m.B0,null,R);case 34:return L=e.sent,B=L.data,j=[],B&&B.tenantId&&(j=B.tenantId.map((function(e){return e.uuid}))),e.next=40,(0,p.tx)(a,{parentTemplateId:c.templateId});case 40:e.sent.forEach((function(e){if(!A){var t=e&&e.tenants?e.tenants.map((function(e){return e.uuid})):[],r=[];t&&t.length&&j&&j.length&&(r=t.filter((function(e){return j.includes(e)}))),A=!(!r||!r.length),console.log("** emailTemplate isTenantTemplateOverride ***",A),A&&(M=e)}})),T=g(g({},T),B),(U=(0,f._t)(T).token).startsWith("Bearer ")&&(U=U.substring(7,U.length)),T.autorizationToken=U;case 46:return A&&M&&(w=M),e.next=49,(0,v.GB)(a,{projectId:i,collectionName:w.collectionId});case 49:return N=e.sent,e.next=52,(0,v.GB)(a,{projectId:i,collectionName:m.B0});case 52:return S=e.sent,W=w.subject,K=w.content,F=O(W,T||{},I,h,N,S,k,D),$=O(K,T||{},I,h,N,S,k,D),e.next=59,(0,_.Z)(a,{code:"AWS_SES",projectId:i});case 59:return q=e.sent,G="",J={accessKeyId:"AKIAX4BKOZ6FMGGFTZE6",secretAccessKey:"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",region:"ap-south-1"},q&&(Z=q.setting,H=Z.access_key,z=Z.access_secret,V=Z.region,Q=Z.from_email,X=Z.from_name,H=(0,b.LO)(H,h),z=(0,b.LO)(z,h),V=(0,b.LO)(V,h),Q=(0,b.LO)(Q,h),X=(0,b.LO)(X,h),G="".concat(X," <").concat(Q,">"),J={accessKeyId:H,secretAccessKey:z,region:V}),e.next=65,E(J,y,F,$,G);case 65:Y=e.sent,console.log(Y);case 67:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(s=i.length>4&&void 0!==i[4]?i[4]:null)||process.env.AWS_SES_ADMIN_FROM_EMAIL_NAME,l().config.update(t),o=new(l().SES)({apiVersion:"2010-12-01"}),c={Source:s,Destination:{ToAddresses:Array.isArray(r)?r:[r]},Message:{Body:{Html:{Charset:"UTF-8",Data:a}},Subject:{Charset:"UTF-8",Data:n}}},e.next=7,o.sendEmail(c).promise();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),O=function(e,t,r,n,a,s,o,c){var u,i=null===(u=e.match(/{{(.*?)}}/g))||void 0===u?void 0:u.map((function(e){return e.replace(/{{(.*?)}}/g,"$1")}));return Object.keys(t).length>0&&(null==i||i.forEach((function(u){e=function(e,t,r,n,a,s,o,c,u){var i=s.utilities,l="{{".concat(e,"}}"),p="";if(e.startsWith("DF::")){if(i.length>0){var _=e.replace("DF::",""),d=i.find((function(e){return e.name===_}));p=(0,b.B$)(d,r,n,a.constants)}}else if(e.startsWith("RF::")){var f=e.replace("RF::","");p=I(r,f)}else if(e.startsWith("current_user.")){var m=e.replace("current_user.","");if(m.startsWith("DF::")){m=m.replace("DF::","");var v=o.utilities.find((function(e){return e.name===m}));p=(0,b.B$)(v,n,n,a.constants)}else p=I(n,m)}else if(e.startsWith("environment_variable.")){var h,g=e.replace("environment_variable.","");p=null===(h=a.constants.find((function(e){return e.name===g})))||void 0===h?void 0:h.value}else if(e.startsWith("current_session.")){var x=e.replace("current_session.","");p=I(c,x)}else if(e.startsWith("form_data_session.")){var y=e.replace("form_data_session.","");p=I(u,y)}else p=I(r,e);return k(l,p,t)}(u,e,t,r,n,a,s,o,c)}))),e},k=function(e,t,r){var n=new RegExp(e,"ig");return t&&t.length>0||(t=""),r.replace(n,t)},D=function(){var e=o()(u().mark((function e(t){var r,n,a,s,c,i,l,h,g,x,y,k,D,I,w,T,M,A,C,R,L,B,j,U,N;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.builderDB,a=t.body,s=t.db,c=t.projectId,i=t.user,l=t.projectConstants,h=t.environment,g=t.projectName,x=a.templatesRules,y=a.itemId,k=a.propagateItemId,D=a.previousActionResponse,I=a.previousActionFormData,!(w=(i||"").uuid)){e.next=18;break}return e.next=6,(0,d.ME)(n,s,c,"user",w);case 6:if(e.t2=r=e.sent,e.t1=null===e.t2,e.t1){e.next=10;break}e.t1=void 0===r;case 10:if(!e.t1){e.next=14;break}e.t3=void 0,e.next=15;break;case 14:e.t3=r.data;case 15:e.t0=e.t3,e.next=19;break;case 18:e.t0={};case 19:return T=e.t0,e.next=22,(0,_.Z)(n,{code:"AWS_SES",projectId:c});case 22:M=e.sent,A="",C={accessKeyId:"AKIAX4BKOZ6FMGGFTZE6",secretAccessKey:"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",region:"ap-south-1"},M&&(R=M.setting,L=R.access_key,B=R.access_secret,j=R.region,U=R.from_email,N=R.from_name,L=(0,b.LO)(L,h),B=(0,b.LO)(B,h),j=(0,b.LO)(j,h),U=(0,b.LO)(U,h),N=(0,b.LO)(N,h),A="".concat(N," <").concat(U,">"),C={accessKeyId:L,secretAccessKey:B,region:j}),x.forEach(function(){var e=o()(u().mark((function e(r){var a,o,_,b,x,w,M,R,L,B,j,U,N,S,W,K,F,$,q,G,J;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.templateId,_=r.emailFields,b=r.sendToPropagate,e.next=3,(0,p.UC)(n,{uuid:o});case 3:if(x=e.sent,w=b?k:y,!(M=x?x.collectionId:null)||!w){e.next=12;break}return e.next=9,(0,d.ME)(n,s,c,M,w);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=null;case 13:if(R=(R=(R=e.t0)?R.data:{})||{},L=null==t||null===(a=t.headers)||void 0===a?void 0:a.origin,R.siteUrl=L,M===m.B0&&((B=(0,f._t)(R).token).startsWith("Bearer ")&&(B=B.substring(7,B.length)),R.autorizationToken=B),R.projectName=g,j={},U=!1,!((N=i?i.tenantId:[])&&N.length>0)){e.next=29;break}return e.next=27,(0,p.tx)(n,{parentTemplateId:o});case 27:e.sent.forEach((function(e){if(!U){var t=e&&e.tenants?e.tenants.map((function(e){return e.uuid})):[],r=t&&t.length&&N&&N.length?t.filter((function(e){return N.includes(e)})):[];(U=!(!r||!r.length))&&(j=e)}}));case 29:return U&&j&&(x=j),e.next=32,(0,v.GB)(n,{projectId:c,collectionName:x.collectionId});case 32:return S=e.sent,e.next=35,(0,v.GB)(n,{projectId:c,collectionName:m.B0});case 35:return W=e.sent,K=x.subject,F=O(K,R||{},T,h,S,W,D,I),$=x.content,q=O($,R||{},T,h,S,W,D,I),G=P(_,R,l,i),console.log("\n sendTo :>> ",G),e.next=44,E(C,G,F,q,A);case 44:J=e.sent,console.log(J);case 46:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(e,t,r,n){var a=[];return e.forEach((function(e){var s=JSON.parse(e),o=s.fieldFrom,c=s.fieldName,u=s.name,i="";if("collection"===o)i=I(t,c);else if("projectConstant"===o&&u){var l=r?r.find((function(e){return e.name===u})):"";i=null==l?void 0:l.value}else"session"===o&&n&&(i=I(n,c));i&&a.push(i)})),console.log(">>>>>>>>emailAddresses>>>>>>",a),a},I=function(e,t){var r="";if(t&&t.includes(".")){for(var n=t.split("."),a="",s=e||"",o=0;o<n.length;o++)a=n[o],Array.isArray(s)&&(s[a]=s.map((function(e){if(e[a])return e[a]}))),s&&!s[a]&&(s[a]=""),s=s[a];r=s||"",Array.isArray(r)&&(r=r.filter((function(){return!0})))}else r=e?e[t]:"";return r&&Array.isArray(r)&&"string"==typeof r[0]?r.join(", "):r&&"number"==typeof r?r.toString():r}},7253:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(1185),a=new(0,n.Schema)({uuid:String,url:String,headers:[Object],params:[Object],collectionName:String,query:{type:Object},projectId:String},{timestamp:!0});const s=n.model("ExternalApiMiddlewares",a)},5125:(e,t,r)=>{"use strict";r.d(t,{B:()=>u,n:()=>i});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(5828);r(7253);var u=function(){var e=a()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.uuid=(0,c.v4)(),n=t.model("ExternalApiMiddlewares"),a=new n(r),e.next=5,a.save();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.model("ExternalApiMiddlewares"),e.next=3,n.findOne(r).exec();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},7920:(e,t,r)=>{"use strict";r.d(t,{eD:()=>X,GB:()=>ne,Gp:()=>pe,fl:()=>re});var n=r(9293),a=r.n(n),s=r(8779),o=r.n(s),c=r(9591),u=r.n(c),i=r(1307),l=r.n(i),p=r(6517),_=r.n(p),d=r(5828),f=r(7060);const m=require("firebase-tools-api"),b=require("airtable-api");var v=r(4945),h=r(7714),g=r(6837),x=r(7705),y=r(8194),E=r(5125),O=r(6268),k=r(177),D=r(1457),P=r(2826),I=r(6540);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M=v.FieldTypes.createdAt,A=v.FieldTypes.isDeleted,C=v.FieldTypes.updatedAt,R=v.FieldTypes.password,L=v.FieldTypes.file,B=v.FieldTypes.object,j=v.FieldTypes.createdBy,U=["_data_source_rest_api_primary_id",M.id,A.id,C.id,R.id,L.id,B.id,j.id],N="current_session",S="current_user",W="reference_fields",K="derived_fields",F="collection_constants",$="project_constants",q="environment_variable",G="form_data_session",J="RF::",Z="DF::",H="CC::",z="PC::",V="current_user.DF::",Q=[{key:S,prefix:S},{key:N,prefix:N},{key:q,prefix:q},{key:W,prefix:J},{key:K,prefix:Z},{key:F,prefix:H},{key:$,prefix:z}],X=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u){var i,p,m,b,h,g,x,P,w,M,A,C,R,L,B,j,U,N,S,W,K,F,$,q,G,J,Z,H,z,V,Q,X,te,re,ne,ue,le,pe,me,be,ve,he,ge,xe,ye,Ee,Oe,De,Pe,Ie,we,Te,Me,Ae,Le,Be,je,Ue,Ne,Se,We,Ke,Fe,$e,qe,Ge,Je,Ze,He,ze,Ve,Qe,Xe,Ye,et,tt,rt,nt,at,st,ot,ct,ut,it,lt,pt,_t,dt,ft,mt,bt,vt,ht,gt,xt,yt,Et,Ot,kt,Dt,Pt,It,wt;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.externalApiId,p=s.data,m=s.userRole,b=s.sessionValue,h=s.sessionFormValue,e.next=3,t.collection("externalapis").findOne({uuid:i,projectId:n});case 3:if(g=e.sent){e.next=6;break}return e.abrupt("return",{status:400,responseData:{message:"External API not found."}});case 6:return x=g.setting,P=g.donotPersistResponseData,w=g.bodyDataFrom,M=g.collectionMapping,A=g.collectionName,C=g.responseDataMapping,R=g.externalApiType,L=g.isUpdateItemWithResponse,B=g.errors,j=g.timeout,U=g.requestDataJsonType,N={},S={},W={},K={},F={},$={},q=!1,Object.assign($,p),G=!1,C&&(J=C.exportResponse,Z=C.generateCSV,G=J&&"DOWNLOAD_FILE_BYTES"===Z),console.log("==> collectionName :>> ",A," bodyDataFrom :>> ",w," requestDataJsonType :>> ",U),!U&&!["noDynamicData"].includes(w)&&A&&M&&M.length&&(U="DEFAULT",g.requestDataJsonType=U,console.log("==> Updated JSON Type :>> ",U)),null!=p&&p.externalApiItem&&(H=(null!=p?p:"").externalApiItem,V=(z=null!=H?H:"").pageCollectionName,Q=z.id,q=!!V,console.log("==> pageCollectionName :>> ",V," hasPageCollection :>> ",q),a||"NON_PERSISTENT_COLLECTION"===w||(a=Q,console.log("ðŸš€ ~ file: external-api.service.js:143 ~ collectionItemId:",a)),q||H.hasOwnProperty("fromTargetElem")||H.fromTargetElem||Ce(H),Re(H,"fromTargetElem")),console.log("##############################"),(X=T({},g)).collectionName="user",e.next=26,ke(t,n,X,p,c,b,h,je,G,o,u);case 26:if(te=e.sent){e.next=29;break}return e.abrupt("return",{status:400,responseData:"User Collection not found"});case 29:re=te.derivedFields,e.t0=w,e.next="NON_PERSISTENT_COLLECTION"===e.t0?33:46;break;case 33:return console.log("*** Execute ExternalAPI Process for Non Persistent Collection..."),ae(M,p,g,A),e.next=37,ke(t,n,g,p,c,b,h,je,G,o,re);case 37:if(ne=e.sent){e.next=40;break}return e.abrupt("return",{status:400,responseData:"Non Persistent Collection item not found"});case 40:return ue=ne.sendToExternalApi,le=ne.derivedFields,pe=ne.constants,me=ne.fields,S=ue,K=le,F=pe,W=me,e.abrupt("break",59);case 46:if(console.log("*** Execute ExternalAPI Process for Collection..."),!a){e.next=58;break}return e.next=50,ee(t,r,n,g,a,o,c,u);case 50:if(be=e.sent){e.next=53;break}return e.abrupt("return",{status:400,responseData:"Collection item not found"});case 53:he=(ve=be||"").dataToSendToExternalApi,ge=ve.derivedFields,xe=ve.constants,ye=ve.fields,N=he,K=ge,F=xe,W=ye;case 58:return e.abrupt("break",59);case 59:return console.log("##############################"),console.log("==> externalApi.setting.url #2 :>> ",x.url),Ee=x.headers.find((function(e){return e.key&&"content-type"===e.key.toLowerCase()&&"application/x-www-form-urlencoded"===e.value})),Oe=!!Ee,console.log("ðŸš€ ~ file: external-api.service.js:231 ~ isUrlEncoded:",Oe),"FORM_URL_ENCODED"!==U||Oe||x.headers.push({key:"Content-Type",value:"application/x-www-form-urlencoded",id:x.headers.length+1}),console.log("ðŸš€ ~ file: external-api.service.js:239 ~ setting.headers:",x.headers),De=x.headers.find((function(e){return e.key&&"content-type"===e.key.toLowerCase()&&"multipart/form-data"===e.value})),Pe=x.params.find((function(e){return"file"===e.key})),(Ie=!!De)&&(we=Pe&&Pe.value?Pe.value.split(","):"",x.isMultipart=Ie,x.files=we),Te=!1,p&&p.externalApiItem&&(Me=p.externalApiItem,Ae=(Me||"").exportNonPersistentReponse,Te=Ae||!1),ce(p),oe(g,p),Le=(p||{}).externalApiItem,Be=(Be=(Le||"").totalRecordsPath)?Be.trim():"",je=(u||"").constants,Ue={collectionItemId:a,formData:$,dataToSendToExternalApi:N,collectionFields:W,collectionConstants:F,collectionDerivedFields:K,projectConstants:o,environment:u},Ne=T({},p),"RAW_JSON"!==w&&U&&["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(U)?de(p,g,b,c,Ue,h,U,re):"RAW_JSON"===w&&_e(p,g,b,c,{projectConstants:o,environment:u},h,re),Se=0,We="",j&&j.limit?(Se=j.limit,We=j.message):C&&C.timeoutLimit&&(Se=C.timeoutLimit,We=C.timeoutMsg),Ke={},se(p),Fe=fe(x.url,Ne,b,c,Ue,h,re),"RAW_JSON"!==w&&["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(U)?(Ke=T(T({},p),S),N&&($e=T({},N),q&&a&&($e=T(T({},{id:a,collectionItemId:a}),$e)),Fe=(0,f.replaceDataValueIntoExpression)(x.url,$e,c,b,je,h))):Ke=T(T(T({},N),p),S),x.url=Fe,qe=S?T(T({},p),S):p,Ge=a?Ke:qe,console.log("==> BEFORE CALL Final Data :>> ",Ge),e.next=94,(0,v.callCurlRequest)(x,c,Ge,b,Se,We,je,h,G,U);case 94:if((Je=e.sent)&&0!==Object.keys(Je).length){e.next=97;break}return e.abrupt("return",{status:400,responseData:{message:"We did'n receive any response"}});case 97:if(Ze=Je.data,He=Je.status?Je.status:400,He=Je.success?He:400,console.log("resultStatus :>> ",He),C){e.next=104;break}return I.Z.info("Returning because don't have response data mapping",{label:"EXTERNAL_API"}),e.abrupt("return",{status:Je.status?Je.status:400,responseData:Ze});case 104:return I.Z.info("Checking Error Mapping",{label:"EXTERNAL_API"}),console.log("result.success",Je.success),e.next=108,(0,f.checkForError)(Ze,B||[],C,He);case 108:if(ze=e.sent,console.log("afterErrorCheck",ze),ze.noError){e.next=114;break}return I.Z.info("afterErrorCheck: ".concat(ze),{label:"EXTERNAL_API"}),delete ze.noError,e.abrupt("return",ze);case 114:if(Je.success){e.next=116;break}return e.abrupt("return",{status:He,responseData:Ze});case 116:if(Ve=C.statusPath,Qe=C.selectedCollectionName,Xe=C.itemsPath,Ye=C.selectedMapping,et=C.customPrimaryKey,tt=C.currentUserItemsPath,rt=C.enableAuthorization,nt=C.currentUserSelectedMapping,at=C.currentUserPrimaryKey,st=C.exportFileName,ot=C.exportResponse,ct=C.exportItemsPath,ut=C.generateCSV,it="",!Qe||!Ye){e.next=129;break}if(lt={},c&&(lt.createdBy=c.uuid),P){e.next=129;break}return e.next=124,(0,O.r)(t,r,null,Qe,R,Ye,n,Xe,L?T(T({},Ze),{},{uuid:a}):Ze,b,L?"uuid":et,lt);case 124:return pt=e.sent,I.Z.info("primaryKeyQuery ".concat(pt),{label:"EXTERNAL_API"}),e.next=128,(0,E.B)(r,{query:pt,collectionName:Qe});case 128:it=e.sent.uuid;case 129:if(_t=!1,!rt){e.next=156;break}if(!(dt=tt?_().get(Je.data,tt):Je.data)){e.next=156;break}if(ft=null,at&&(ft=_().get(dt,at)),!ft){e.next=156;break}return e.next=138,(0,y.ME)(t,r,n,k.B0,null,{userName:ft});case 138:if(mt=e.sent,bt=mt.data,console.log(" ********** existUsers",bt),bt&&0!==bt.length){e.next=155;break}return console.log("executeExternalApiAndProcess 13"),_t=!0,vt={},nt&&Object.keys(nt).length>0&&Object.keys(nt).map((function(e){vt[e]=dt[nt[e]]})),vt.userName=ft,vt.userRoles=m,vt.uuid=(0,d.v4)(),e.next=151,(0,D.JR)(t,r,n,vt);case 151:(ht=e.sent)&&201===ht.code&&(c=ht.data),e.next=156;break;case 155:c=bt;case 156:if(_t){e.next=161;break}return e.next=159,Y(r,c,nt,tt,Je.data);case 159:(gt=e.sent)&&(c=gt);case 161:if(!rt){e.next=163;break}return e.abrupt("return",{status:c?200:401,responseData:c,success:!c||Object.keys(c).length>0});case 163:if(I.Z.info("itemsPath :>> ".concat(Xe),{label:"EXTERNAL_API"}),xt=Ve?_().get(Je,Ve):Je.status,yt=T(T({},yt=Xe?_().get(Je.data,Xe):Je.data),{},{externalApiMiddlewareId:it}),Et=Be?_().get(Je.data,Be):"",!ot){e.next=195;break}if(!P){e.next=187;break}if(!Te){e.next=180;break}return Ot=ct?_().get(Je.data,ct):Je.data,e.next=174,ie(Qe,Ye,Ot,t,n);case 174:return kt=e.sent,Dt=kt.finalData,Pt=kt.headerColumns,e.abrupt("return",{body:Dt,exportFile:ot,exportFileName:st,generateCSV:ut,headerColumns:Pt,donotPersistResponseData:P});case 180:if(!Et){e.next=184;break}return e.abrupt("return",{responseData:yt,status:xt,donotPersistResponseData:P,totalRecords:Et});case 184:return e.abrupt("return",{responseData:yt,status:xt,donotPersistResponseData:P});case 185:e.next=193;break;case 187:if(ut&&"DOWNLOAD_FILE_BYTES"!==ut){e.next=191;break}return It=Je.headers,Object.keys(It).length>0&&(It={"content-type":It["content-type"],"content-disposition":It["content-disposition"]}),e.abrupt("return",{body:Je.data,headers:It,success:Je.success,generateCSV:ut,exportFile:ot,exportFileName:st});case 191:return wt=ct?_().get(Je.data,ct):Je.data,e.abrupt("return",{body:wt,exportFile:ot,exportFileName:st,generateCSV:ut});case 193:e.next=200;break;case 195:if(!Et){e.next=199;break}return e.abrupt("return",{responseData:yt,status:xt,donotPersistResponseData:P,totalRecords:Et});case 199:return e.abrupt("return",{responseData:yt,status:xt,donotPersistResponseData:P});case 200:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u){return e.apply(this,arguments)}}(),Y=function(){var e=u()(l().mark((function e(t,r,n,a,s){var o,c,u,i,p,d,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r&&n&&Object.keys(r).length>0&&Object.keys(n).length>0)){e.next=18;break}if(o=null,c=r.uuid,a&&(o=_().get(s,a)),u={},!o){e.next=18;break}return Object.keys(n).map((function(e){u[e]=o[n[e]]})),i={uuid:c},p={$set:u},e.next=11,t.collection(k.B0);case 11:return d=e.sent,e.next=14,d.findOneAndUpdate(i,p,{new:!0});case 14:if((f=e.sent)&&(!f.lastErrorObject||f.lastErrorObject.updatedExisting)){e.next=17;break}return e.abrupt("return",null);case 17:return e.abrupt("return",f.value);case 18:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),ee=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u){var i,p,_,d,f,m,b,v,h,g,x,E;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.collectionName,p=a.collectionMapping,_=a.bodyDataFrom,d=a.requestDataJsonType,e.next=3,(0,y.ME)(t,r,n,i,s,null);case 3:if((f=e.sent)&&f.data){e.next=6;break}return e.abrupt("return");case 6:return m=f.data,e.next=9,t.collection("collections").findOne({collectionName:i});case 9:if(b=e.sent,v=b?b.utilities:null,h=b?b.fields:null,g=b?b.constants:null,x=(u||"").constants,"RAW_JSON"===_||!d||["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(d)){e.next=20;break}return e.next=17,te(m,p,v,h,g,o,c,x);case 17:e.t0=e.sent,e.next=21;break;case 20:e.t0=m;case 21:return E=e.t0,e.abrupt("return",{dataToSendToExternalApi:E,collectionDataOfItemId:m,derivedFields:v,constants:g,fields:h});case 23:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u){return e.apply(this,arguments)}}(),te=function(){var e=u()(l().mark((function e(){var t,r,n,a,s,o,c,i,p,_=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_.length>0&&void 0!==_[0]?_[0]:{},n=_.length>2&&void 0!==_[2]?_[2]:[],a=_.length>3&&void 0!==_[3]?_[3]:[],s=_.length>4&&void 0!==_[4]?_[4]:[],o=_.length>5&&void 0!==_[5]?_[5]:[],c=_.length>6&&void 0!==_[6]?_[6]:{},i=_.length>7&&void 0!==_[7]?_[7]:[],p={},(r=_.length>1&&void 0!==_[1]?_[1]:[]).length){e.next=12;break}return delete t._id,e.abrupt("return",t);case 12:return e.next=14,Promise.all(r.map(function(){var e=u()(l().mark((function e(r){var u,_,d,f,m,b,v,y,E,O,k,D;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=r.type,_=r.value,d=r.key,"reference-field"!==u){e.next=6;break}return f=(0,g.UB)(t,_),console.log("referenceFieldValue",f),p[d]=Array.isArray(f)?f.join(","):f,e.abrupt("return");case 6:if("derived-field"!==u){e.next=10;break}if(!(m=n.find((function(e){return e.name===_})))){e.next=10;break}return e.abrupt("return",p[d]=(0,h.B$)(m,t,c,i));case 10:if("collection-constant"!==u){e.next=14;break}if(!(b=s.find((function(e){return e.name===_})))){e.next=14;break}return e.abrupt("return",p[d]=b.value);case 14:if("project-constant"!==u){e.next=18;break}if(!(v=o.find((function(e){return e.name===_})))){e.next=18;break}return e.abrupt("return",p[d]=v.value);case 18:if("collection-field"!==u){e.next=44;break}if("image"!==(y=a.find((function(e){return e.fieldName===_}))||{}).type&&"file"!==y.type){e.next=29;break}if(!(E=t[_].key)){e.next=28;break}return e.next=25,(0,x.lU)(t[_].originalName,E);case 25:(O=e.sent)&&(p[d]=O),p["".concat(d,"_url")]="".concat(process.env.AWS_S3_IMAGE_URL_PREFIX).concat(E);case 28:return e.abrupt("return");case 29:if("multi_image"!==y.type){e.next=33;break}return(k=t[_].map((function(e){return"".concat(process.env.AWS_S3_IMAGE_URL_PREFIX).concat(e.key)})))&&(p[d]=k),e.abrupt("return");case 33:if(!["reference","belongsTo"].includes(y.type)){e.next=37;break}return D=t[_]&&t[_].length>0?t[_].map((function(e){return e.uuid})):[],p[d]=D,e.abrupt("return");case 37:if(!["static_option","reference","dynamic_option"].includes(y.type)){e.next=40;break}return p[d]=t[_]&&1===t[_].length?t[_][0]:t[_],e.abrupt("return");case 40:return t[_]&&(p[d]=t[_]),e.abrupt("return");case 44:return e.abrupt("return",p[d]=_);case 45:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:return e.abrupt("return",p);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c){var u,i,p,_,d,h,g,x,y,E,O,k,D,P,I;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("externalapis").findOne({uuid:a});case 2:if(u=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(i=u.setting,(p=u.externalApiType)!==v.FIREBASE_CLOUD_FIRESTORE&&p!==v.FIREBASE_REALTIME_DATABASE){e.next=16;break}return _=ee(t,r,n,u,s,o,c),d=_.dataToSendToExternalApi,h=i,p===v.FIREBASE_CLOUD_FIRESTORE&&(h.dbType="firestore",d=(0,f.convertItemToArray)(d)),g=new m.Firebase,e.next=13,g.saveData(d,h);case 13:return e.abrupt("return",e.sent);case 16:if(p!==v.AIRTABLE){e.next=32;break}if(x=i.apiKey,y=i.baseId,E=i.tableName,"PUT"!==i.methodType){e.next=30;break}return e.next=21,ee(t,r,n,u,s,o,c);case 21:if(O=e.sent){e.next=24;break}return e.abrupt("return");case 24:return k=O.dataToSendToExternalApi,D=O.collectionDataOfItemId,P=[{id:D._data_source_airtbale_primary_id,fields:k}],console.log(">>>>>>>>>>>>>airtableRecordToUpdate>>>>>",P),I=new b.Airtable({apiKey:x,baseId:y}),e.next=30,I.updateRecord(E,P);case 30:e.next=33;break;case 32:console.log(">>>>>>>>>>>>>>");case 33:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),ne=function(){var e=u()(l().mark((function e(t,r,n){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("externalapis").findOne({uuid:n,projectId:r});case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return",{status:400,data:{message:"External API not found."}});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),ae=function(e,t,r,n){if(t&&t.externalApiItem&&r.setting.url.includes("{{")){var a=[];n&&e&&e.length&&e.forEach((function(e){var r={key:"{{".concat(e.key,"}}"),value:["_data_source_rest_api_primary_id","uuid"].includes(e.value)?t.externalApiItem[e.key]:t[e.value]};a.push(r)}));var s={};t.externalApiItem.hasOwnProperty("uniqueKey")&&t.externalApiItem.uniqueKey?(s={key:"{{".concat(t.externalApiItem.uniqueKey,"}}"),value:t.externalApiItem.id},a.push(s)):t.externalApiItem.hasOwnProperty("id")&&t.externalApiItem.id&&(s={key:"{{id}}",value:t.externalApiItem.id},a.push(s)),t.externalApiItem.hasOwnProperty("_data_source_rest_api_primary_id")&&t.externalApiItem._data_source_rest_api_primary_id&&a.push({key:"{{_data_source_rest_api_primary_id}}",value:t.externalApiItem._data_source_rest_api_primary_id}),console.log("==> doProcessForNonPersistentCollection needlesArr :>> ",a),a.forEach((function(e){var t=new RegExp(e.key,"ig"),n=e.value?e.value:"";r.setting.url=r.setting.url.replace(t,n)}))}ue(n,e,t,r)},se=function(e){e&&e.externalApiItem&&delete e.externalApiItem},oe=function(e,t){if(t&&t.externalApiItem){var r=t.externalApiItem,n=(e||"").setting;r&&r.searchString&&(n.url.includes("?")?n.url+="&".concat(r.searchString):n.url+="?".concat(r.searchString))}},ce=function(e){if(e&&e.externalApiItem){var t=e.externalApiItem||"",r=t.recordsLimit,n=t.recordsOffset,a=t.pageOffset,s=r||"",o=s.limitKey,c=s.limitValue;if(o&&c){var u=n||"",i=u.offsetKey,l=u.offsetValue;i&&l&&l>=0&&(e[i]=l);var p=a||"",_=p.pageOffsetKey,d=p.pageOffsetValue;_&&d&&d>=0&&(e[_]=d),e[o]=c}}},ue=function(e,t,r,n){var a=(n||"").sendFormData,s=[];e&&t&&t.length?(t.forEach((function(e){var t=e.key,n=e.value;if(r&&r.hasOwnProperty(n)){var a=r[n];r[t]=a,s.push(t)}})),a||r&&Object.keys(r).length>0&&Object.keys(r).map((function(e){s.includes(e)||"externalApiItem"!==e&&delete r[e]}))):a||r&&Object.keys(r).length>0&&Object.keys(r).map((function(e){"externalApiItem"!==e&&delete r[e]}))},ie=function(){var e=u()(l().mark((function e(t,r,n,a,s){var o,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],c=[],n&&!Array.isArray(n)&&(n=[n]),e.next=5,le(r,a,t,s,o,c);case 5:return u=[],n&&n.forEach((function(e){var t={};c.forEach((function(r){var n=r.key,a=r.fieldName,s=e[n];t[a]=s&&"undefined"!==s?s:""})),u.push(t)})),e.abrupt("return",{finalData:u,headerColumns:o});case 8:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),le=function(){var e=u()(l().mark((function e(t,r,n,a,s,o){var c,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&Object.keys(t).length>=0)){e.next=6;break}return e.next=3,(0,P.GB)(r,{collectionName:n,projectId:a});case 3:c=e.sent,i=(c||"").fields,Object.keys(t).map(function(){var e=u()(l().mark((function e(r){var n,a,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r,a=_().get(t,r),U.includes(n)||(c=i?i.find((function(e){return e.fieldName===n})):"",u=(c||"").fieldTitle,s.push({key:n,header:u?u.en:n}),o.push({key:a,fieldName:n}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),pe=function(e,t,r,n){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(a){var s={body:e,header:t,url:r,response:arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,method:n,status:arguments.length>7&&void 0!==arguments[7]?arguments[7]:400,error:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,type:"EXTERNAL_API",token:arguments.length>8&&void 0!==arguments[8]?arguments[8]:null};(0,f.dbLogger)(s,a)}},_e=function(e,t,r,n,a,s){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},c=(e||{}).externalApiItem;se(e);var u=a||"",i=u.projectConstants,l=u.environment,p=(t||"").bodyRawJSON,_="";console.log("==> processbodyRawJson bodyRawJSON :>> ",p);var d=r?{current_session:r}:"";console.log("==> processbodyRawJson sessionData :>> ",d);var f=s?{form_data_session:s}:"";console.log("==> processbodyRawJson currentFormSession :>> ",f);var m=n?{current_user:n}:"";if(console.log("==> processbodyRawJson currentUserData :>> ",m),p){p&&p.includes("'")?(_=p.replaceAll("'",'"'),_=JSON.stringify(_)):_=JSON.stringify(p);var b=_?(0,h.uO)(_):"";if(console.log("==> processbodyRawJson rawBodyJsonObj :>> ",b),b){var v,x=null===(v=b.match(/{{(.*?)}}/g))||void 0===v?void 0:v.map((function(e){return e.replace(/{{(.*?)}}/g,"$1")}));console.log("==> processbodyRawJson needleList :>> ",x);var y=b,E={};e&&Object.keys(e).length>0&&Object.keys(e).map((function(t){E[t]=e[t]})),c&&Object.keys(c).length>0&&Object.keys(c).map((function(e){E[e]=c[e]})),E&&Object.keys(E).length>0&&(null==x||x.forEach((function(e){var t="{{".concat(e,"}}"),r=(0,g.UB)(E,e);y=(0,g.fm)(t,r,y)}))),y=he(_,d,x,y,N),y=he(_,f,x,y,G),y=he(_,m,x,y,S,o),y=Oe(i,x,y,$);var O=(y=he(_,l,x,y,q))?(0,h.uO)(y):{};be(e),ve(O,e)}}},de=function(e,t,r,n,a,s,o){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},u=(e||{}).externalApiItem;se(e);var i=a||"",l=i.collectionItemId,p=i.formData,_=i.dataToSendToExternalApi,d=i.collectionFields,f=i.collectionConstants,m=i.collectionDerivedFields,b=i.projectConstants,v=i.environment,g=(v||"").constants;p.hasOwnProperty("externalApiItem")&&delete p.externalApiItem;var x="",y=(t||"").bodyDataFrom;if(console.log("ðŸš€ ~ file: external-api.service.js:1198 ~ processRequestBodyJson requestDataType:",o),"CUSTOM"===o){var E=(t||"").bodyCustomJSON;x=null!=E?E:""}else if(["FORM_DATA","FORM_URL_ENCODED"].includes(o)){var O=(t||"").bodyCollectionMapping,k={};O&&O.length&&(O.map((function(e){k[e.key]=e.value})),x=k?JSON.stringify(k):"")}console.log("ðŸš€ ~ file: external-api.service.js:1215 ~ jsonString:",x);var D="",P=r?{current_session:r}:"";console.log("==> processRequestBodyJson sessionData :>> ",P);var I=s?{form_data_session:s}:"";console.log("==> processRequestBodyJson currentFormSession :>> ",I);var w=n?{current_user:n}:"";if(console.log("==> processRequestBodyJson currentUserData :>> ",w),x){x&&x.includes("'")?(D=x.replaceAll("'",'"'),D=JSON.stringify(D)):D=JSON.stringify(x);var T=D?(0,h.uO)(D):"";if(console.log("==> processRequestBodyJson customBodyJsonObj :>> ",T),T){var M,A=null===(M=T.match(/{{(.*?)}}/g))||void 0===M?void 0:M.map((function(e){return e.replace(/{{(.*?)}}/g,"$1")}));console.log("==> processRequestBodyJson needleList :>> ",A);var C=T,R={};e&&Object.keys(e).length>0&&Object.keys(e).map((function(t){R[t]=e[t]})),u&&Object.keys(u).length>0&&(Object.keys(u).map((function(e){R[e]=u[e],"id"===e&&(R.uuid=u[e])})),p&&Object.assign(R,p)),l&&_&&Object.assign(R,_),R&&Object.keys(R).length>0&&A&&(C=ye(R,d,A,C),"NON_PERSISTENT_COLLECTION"!==y&&(C=xe(R,A,C,W)),C=Ee(m,R,n,g,A,C,K)),C=Oe(f,A,C,F),C=Oe(b,A,C,$),C=he(D,P,A,C,N),C=he(D,I,A,C,G),C=he(D,w,A,C,S,c);var L=(C=he(D,v,A,C,q))?(0,h.uO)(C):{};be(e),ve(L,e)}}},fe=function(e,t,r,n,a,s){var o,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},u=e,i=(t||{}).externalApiItem,l=a||"",p=l.collectionItemId,_=l.formData,d=l.dataToSendToExternalApi,f=l.collectionFields,m=l.collectionConstants,b=l.collectionDerivedFields,v=l.projectConstants,h=l.environment,g=r?{current_session:r}:"";console.log("==> processRequestBodyJson sessionData :>> ",g);var x=s?{form_data_session:s}:"";console.log("==> processRequestBodyJson currentFormSession :>> ",x);var y=n?{current_user:n}:"";console.log("==> processRequestBodyJson currentUserData :>> ",y);var E=null===(o=e.match(/{{(.*?)}}/g))||void 0===o?void 0:o.map((function(e){return e.replace(/{{(.*?)}}/g,"$1")}));console.log("==> processRequestBodyJson needleList :>> ",E);var O={};return t&&Object.keys(t).length>0&&Object.keys(t).map((function(e){O[e]=t[e]})),i&&Object.keys(i).length>0&&(Object.keys(i).map((function(e){O[e]=i[e],"id"===e&&(O.uuid=i[e])})),_&&Object.assign(O,_)),p&&d&&Object.assign(O,d),O&&Object.keys(O).length>0&&E&&(u=ye(O,f,E,u,void 0,!0),u=xe(O,E,u,W),u=Ee(b,O,n,h.constants,E,u,K)),u=Oe(m,E,u,F),u=Oe(v,E,u,$),u=he(u,g,E,u,N),u=he(u,x,E,u,G),u=he(u,y,E,u,S,c),he(u,h,E,u,q)},me=function(e,t){return t.some((function(t){return e.startsWith(t)}))},be=function(e){e&&Object.keys(e).length>0&&Object.keys(e).map((function(t){delete e[t]}))},ve=function(e,t){e&&Object.keys(e).length>0&&Object.keys(e).map((function(r){t[r]=e[r]}))},he=function(e,t,r,n,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(e.includes(a)&&t&&Object.keys(t).length>0){var o,c=[];switch(a){case N:c=[N];break;case G:c=[G];break;case S:c=[S];break;case q:c=[q]}r&&(null==r||null===(o=r.filter((function(e){return me(e,c)})))||void 0===o||o.forEach((function(e){if(e.startsWith(a)){var o="{{".concat(e,"}}");n=ge(a,e,o,t,n,s,r)}})))}return n},ge=function(e,t,r,n,a,s,o){if(r.includes(V))a=a.replace(V,Z),o=o.map((function(e){return e.includes(V)&&(e=e.replace(V,Z)),e})),a=Ee(s,n.current_user,n.current_user,{},o,a,K);else{var c=e===q?(0,h.LO)(t,n):_().get(n,t);a=(0,g.fm)(r,c?c.toString():"",a)}return a},xe=function(e,t,r,n){var a;return e&&Object.keys(e).length>0&&t&&(console.log("==> processNeedleDataForReferenceFields :>> ",n),null==t||null===(a=t.filter((function(e){return me(e,[J])})))||void 0===a||a.forEach((function(t){if(t.startsWith(J)){var n=t.replace(J,""),a="{{".concat(t,"}}"),s=(0,g.UB)(e,n);s=Array.isArray(s)?s.join(","):s,r=(0,g.fm)(a,s?s.toString():"",r)}}))),r},ye=function(e,t,r,n,a){var s,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return e&&Object.keys(e).length>0&&(console.log("==> processNeedleDataForCollectionFields currentDataKey :>> ",a),r&&(null==r||null===(s=r.filter((function(e){return!me(e,[S,N,G,q,J,Z,H,z])})))||void 0===s||s.forEach((function(r){var a="{{".concat(r,"}}"),s=t&&Object.keys(t).length>0&&t.find((function(e){return e.fieldName===r}))||{},c="";if(s)switch(s.type){case"image":case"file":var u=e[r].key;u&&(c="".concat(process.env.AWS_S3_IMAGE_URL_PREFIX).concat(u));break;case"multi_image":var i=e[r].map((function(e){return"".concat(process.env.AWS_S3_IMAGE_URL_PREFIX).concat(e.key)}));i&&(c=i);break;default:c=_().get(e,r)}o&&!c&&(c=a),n=(0,g.fm)(a,c?c.toString():"",n)})))),n},Ee=function(e,t,r,n,a,s,o){var c;return e&&Object.keys(e).length>0&&(console.log("==> processNeedleDataForDerivedFields currentDataKey :>> ",o),a&&(null==a||null===(c=a.filter((function(e){return me(e,[Z])})))||void 0===c||c.forEach((function(a){var o="{{".concat(a,"}}"),c=a.replace(Z,""),u="",i=e.find((function(e){return e.name===c}));i&&(u=(0,h.B$)(i,t,r,n)),s=(0,g.fm)(o,u?u.toString():"",s)})))),s},Oe=function(e,t,r,n){if(e&&Object.keys(e).length>0){console.log("==> processNeedleDataForConstants currentDataKey :>> ",n);var a,s=Q.find((function(e){return e.key===n})),o=s?s.prefix:"",c=[];switch(n){case F:case $:c=[o]}t&&(null==t||null===(a=t.filter((function(e){return me(e,c)})))||void 0===a||a.forEach((function(t){var n="{{".concat(t,"}}"),a=t.replace(o,""),s="",c=e.find((function(e){return e.name===a}));c&&(s=c.value),r=(0,g.fm)(n,s?s.toString():"",r)})))}return r},ke=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u,i,p,_){var d,f,m,b,v,h,g,x,y,E,O=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=O.length>11&&void 0!==O[11]?O[11]:{},f=n.collectionName,m={},e.next=5,t.collection("collections").findOne({collectionName:f,projectId:r});case 5:if(b=e.sent,v=b?b.utilities:null,h=b?b.fields:null,g=b?b.constants:null,!(null!=(x=a.externalApiItem)?x:"").pageCollectionName){e.next=19;break}return e.next=14,Ae(m,b,n,a,s,o,c,u,i,p,_,d);case 14:return y=e.sent,E=(null!=y?y:"").sendToExternalApi,e.abrupt("return",{derivedFields:v,fields:h,constants:g,sendToExternalApi:E});case 19:return e.abrupt("return",{derivedFields:v,fields:h,constants:g,sendToExternalApi:m});case 20:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u,i,l,p){return e.apply(this,arguments)}}(),De=function(e,t){return e.map((function(e){return t.map((function(t){var r=t[e.value.replace(/{{(.*?)}}/g,"$1")];r&&(e.value=e.value.replace(e.value,r))})),e}))},Pe=function(e,t){return e.map((function(e){return t.forEach((function(t){e.value.includes(t.value)&&(e.value=e.value.replace(t.value,t.key))})),e}))},Ie=function(e){var t=e.setting,r=e.bodyCustomJSON,n=e.collectionMapping,a=e.requestDataJsonType,s=t.params,o=t.headers,c=we(o);console.log("==> nonPersistentDataCallRequest headerHasOnlyScopedFields :>> ",c);var u=we(s);console.log("==> nonPersistentDataCallRequest paramHasOnlyScopedFields :>> ",u);var i=we("CUSTOM"===a?r:n);return console.log("==> nonPersistentDataCallRequest collectionDataMappingHasOnlyScopedFields :>> ",i),c&&u&&i},we=function(e){var t=!0,r=Array.isArray(e)&&e.length>0,n="object"===a()(e)&&!Array.isArray(e)&&null!==e&&Object.keys(e).length>0,s="string"==typeof e;if(r)e.map((function(e){var t=e.value.split(/{{(.*?)}}/g),r=(t=t&&t.filter((function(e){return!!e})))&&t.filter((function(e){return["_data_source_rest_api_primary_id","id"].includes(e)||e.startsWith(S)||e.startsWith(N)||e.startsWith(G)||e.startsWith(q)||e.startsWith(z)}));return!!(r&&r.length>0)&&r.every((function(e){return e.startsWith("_data_source_rest_api_primary_id")||e.startsWith("id")||e.startsWith(S)||e.startsWith(N)||e.startsWith(G)||e.startsWith(q)||e.startsWith(z)}))})).every((function(e){return!!e}))||(t=!1);else if(n)Object.keys(e).map((function(t){var r=e[t].split(/{{(.*?)}}/g),n=(r=r&&r.filter((function(e){return!!e})))&&r.filter((function(e){return["_data_source_rest_api_primary_id","id"].includes(e)||e.startsWith(S)||e.startsWith(N)||e.startsWith(G)||e.startsWith(q)||e.startsWith(z)}));return!!(n&&n.length>0)&&n.every((function(e){return e.startsWith("_data_source_rest_api_primary_id")||e.startsWith("id")||e.startsWith(S)||e.startsWith(N)||e.startsWith(G)||e.startsWith(q)||e.startsWith(z)}))})).every((function(e){return!!e}))||(t=!1);else if(s){var o;(null===(o=e.match(/{{(.*?)}}/g))||void 0===o?void 0:o.map((function(e){var t=e.split(/{{(.*?)}}/g),r=(t=t&&t.filter((function(e){return!!e})))&&t.filter((function(e){return["_data_source_rest_api_primary_id","id"].includes(e)||e.startsWith(S)||e.startsWith(N)||e.startsWith(G)||e.startsWith(q)||e.startsWith(z)}));return!!(r&&r.length>0)&&r.every((function(e){return e.startsWith("_data_source_rest_api_primary_id")||e.startsWith("id")||e.startsWith(S)||e.startsWith(N)||e.startsWith(G)||e.startsWith(q)||e.startsWith(z)}))}))).every((function(e){return!!e}))||(t=!1)}return t},Te=function(e){var t=!1,r=Array.isArray(e)&&e.length>0,n="object"===a()(e)&&!Array.isArray(e)&&null!==e&&Object.keys(e).length>0,s="string"==typeof e;return console.log("==> containsDynamicFields isArray :>> ",r," isObject :>> ",n," isString :>> ",s),n&&Object.keys(e).map((function(t){var r=e[t].split(/{{(.*?)}}/g),n=(r=r&&r.filter((function(e){return!!e})))&&r.filter((function(e){return e.startsWith("{{")}));return!!(n&&n.length>0)&&n.some((function(e){return e.startsWith("{{")}))})).some((function(e){return!!e}))&&(t=!0),t},Me=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u,i,p,d){var f,m,b,h,g,x,y,E,O,k,D,P,I,w,M,A,C,R,L,B,j,U,N,S,W=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=W.length>11&&void 0!==W[11]?W[11]:{},m=n.setting,b=n.responseDataMapping,h=n.collectionMapping,g=n.requestDataJsonType,x=n.bodyDataFrom,y=a.externalApiItem,E=r?r.utilities:null,O=r?r.fields:null,k=r?r.constants:null,m.params=De(m.params,[y]),m.headers=De(m.headers,[y]),D=b.timeoutLimit,P=b.timeoutMsg,I=b.selectedMapping,w=b.itemsPath,M=0,A="",b&&D&&(M=D,A=P),C=T({},a),se(C),R=!!(C&&Object.keys(C).length>0)&&Te(C),console.log("==> preExternalApiCallForNonPersistentData collectionDataHasDynamicFields :>> ",R),console.log("*** Pre-Call to fetch Non-Persistent Item Data... "),console.log("=================================== "),e.prev=18,e.next=21,(0,v.callCurlRequest)(m,s,C,o,M,A,u,c,i,g);case 21:if((L=e.sent)&&0!==Object.keys(L).length){e.next=24;break}return e.abrupt("return",{status:400,responseData:{message:"No Record Found"}});case 24:return B=L.data,w&&(B=_().get(B,w)),j=I&&Object.keys(I).map((function(e){return{key:e,value:I[e],type:"collection-field"}})),e.next=29,te(B,j,E,O,k,p,s,u);case 29:B=e.sent,m.params=De(m.params,[B]),m.headers=De(m.headers,[B]),"RAW_JSON"!==x&&("DEFAULT"===g?B=Pe(h,[B]):g&&["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(g)&&(U={collectionItemId:y.id,formData:{},dataToSendToExternalApi:B,collectionFields:O,collectionConstants:k,collectionDerivedFields:E,projectConstants:p,environment:d},de(B,n,o,s,U,c,g,f)),t=["DEFAULT","CUSTOM"].includes(g)?B:{}),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(18),console.log("==> preExternalApiCallForNonPersistentData error :>> ",e.t0);case 38:return console.log("=================================== "),"RAW_JSON"===x&&(N={projectConstants:p,environment:d},S=T({},a),_e(S,n,o,s,N,c,f),t=T({},S)),e.abrupt("return",t);case 41:case"end":return e.stop()}}),e,null,[[18,35]])})));return function(t,r,n,a,s,o,c,u,i,l,p){return e.apply(this,arguments)}}(),Ae=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u,i,p,_){var d,f,m,b,v,h,g,x,y,E,O,k=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=k.length>11&&void 0!==k[11]?k[11]:{},f=n.setting,m=n.collectionMapping,b=n.bodyDataFrom,v=a.externalApiItem,h=r?r.utilities:null,g=r?r.fields:null,x=r?r.constants:null,y=Ie(n),console.log("==> processNonPersistentRequestDataForDetailsPage hasNonPersistentDataToReplace :>> ",y),!y){e.next=21;break}if(f.params=De(f.params,[v]),f.headers=De(f.headers,[v]),!(m&&m.length>0)){e.next=17;break}return e.next=14,te(v,m,h,g,x,p,s,u);case 14:t=e.sent,e.next=18;break;case 17:"RAW_JSON"===b&&(E={projectConstants:p,environment:_},O=T({},a),_e(O,n,o,s,E,c,d),t=T({},O));case 18:return e.abrupt("return",{derivedFields:h,fields:g,constants:x,sendToExternalApi:t});case 21:return console.log("==> processNonPersistentRequestDataForDetailsPage ELSE hasNonPersistentDataToReplace :>> ",y),e.next=24,Me(t,r,n,a,s,o,c,u,i,p,_,d);case 24:return t=e.sent,e.abrupt("return",{derivedFields:h,fields:g,constants:x,sendToExternalApi:t});case 26:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u,i,l,p){return e.apply(this,arguments)}}(),Ce=function(e){e.hasOwnProperty("id")&&e.id&&(e.id=""),e.hasOwnProperty("_data_source_rest_api_primary_id")&&e._data_source_rest_api_primary_id&&(e._data_source_rest_api_primary_id=""),e.hasOwnProperty("nonPersistentCollectionItemId")&&e.nonPersistentCollectionItemId&&(e.nonPersistentCollectionItemId="")},Re=function(e,t){e.hasOwnProperty(t)&&(delete e[t],console.log("==> resetExternalApiItemIds sourceObj :>> ",e))}},8027:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c,x:()=>u});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("plugins"),e.next=3,n.findOne(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),u=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("plugins"),e.next=3,n.find({projectId:r}).toArray();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},5147:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C2:()=>addMultiReferenceBuilder,CB:()=>executeFinderBuilder,F6:()=>saveItemsImportedFromCSVForBuilderService,FP:()=>executeLastRecordBuilder,JB:()=>deleteFieldRecordFromItemsService,NH:()=>addReferenceBuilder,Pb:()=>executeQueryBuilder,Pr:()=>findItemForBuilder,XT:()=>updatePlaidItemForBuilder,_Z:()=>findItemForBuilderByRegex,cs:()=>findItemForBuilderByEval,iS:()=>updateItemForBuilder,mL:()=>findItemForBuilderByQuery,o5:()=>removeReferenceBuilder,pJ:()=>executeUpdatedQueryBuilder,vo:()=>removeItemBuilder,xD:()=>createItemFromBuilder,yV:()=>listForBuilder});var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8779),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(353),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9591),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1307),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3__),moment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2245),moment__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_4__);__webpack_require__(7253);var listForBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n,a,s){var o,c,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:if(o=e.sent,!a){e.next=15;break}return a=+a,s=+s||20,e.next=8,o.aggregate(n).sort({_id:-1}).skip(s*a).limit(s).toArray();case 8:return c=e.sent,e.next=11,o.estimatedDocumentCount({});case 11:return u=e.sent,e.abrupt("return",{content:c,totalPages:Math.ceil(u/s),totalItems:u});case 15:return console.log("I will get all items"),e.next=18,o.aggregate(n).toArray();case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),createItemFromBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,n&&(n.createdAt=new Date,n.updatedAt=new Date),e.next=6,a.insertOne(n);case 6:if(!(s=e.sent)||!s.insertedCount){e.next=11;break}return e.abrupt("return",s.ops[0]);case 11:throw new Error("Failed to save data");case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),findItemForBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.next=5,a.findOne({uuid:n});case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),findItemForBuilderByQuery=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.next=5,a.findOne(n);case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),findItemForBuilderByEval=function(){var _ref5=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function _callee5(db,data){var req,result;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return req={db},_context5.next=3,eval(data.query);case 3:return result=_context5.sent,_context5.abrupt("return",result);case 5:case"end":return _context5.stop()}}),_callee5)})));return function(e,t){return _ref5.apply(this,arguments)}}(),findItemForBuilderByRegex=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s,o,c;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new RegExp(n.regex),s={pageComponents:a},e.next=4,t.collection(r);case 4:return o=e.sent,e.next=7,o.find(s).toArray();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),updateItemForBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n,a){var s,o;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return s=e.sent,a.$set&&(a.$set.updatedAt=new Date),e.next=6,s.findOneAndUpdate({uuid:n},a,{new:!0});case 6:return o=e.sent,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),updatePlaidItemForBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n,a){var s,o;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return s=e.sent,e.next=5,s.findOneAndUpdate({plaid_item_id:n},a,{new:!0});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),executeQueryBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.next=5,a.aggregate(n).toArray();case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeUpdatedQueryBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s,o,c,u,i;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(n,1),null!=(c=o[0])&&null!==(a=c.$match)&&void 0!==a&&null!==(s=a.updatedAt)&&void 0!==s&&s.$gte&&(c.$match.updatedAt.$gte=new Date(moment__WEBPACK_IMPORTED_MODULE_4___default().utc(c.$match.updatedAt.$gte))),e.next=4,t.collection(r);case 4:return u=e.sent,e.next=7,u.aggregate(n).toArray();case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeLastRecordBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r){var n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return n=e.sent,e.next=5,n.find().sort({_id:-1}).limit(1).toArray();case 5:return a=e.sent,console.log("result executeLastRecordBuilder",a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),executeFinderBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.next=5,a.aggregate(n).toArray();case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),executeFindBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.next=5,a.aggregate(n).toArray();case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),removeItemBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.next=5,a.deleteOne({uuid:n});case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),removeReferenceBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s,o,c,u,i,l;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.belongsToItemId,s=n.collectionField,o=n.recordId,c=n.isMultiSelect,e.next=3,t.collection(r);case 3:if(u=e.sent,!c){e.next=11;break}return e.next=7,u.findOneAndUpdate({uuid:a},{$pull:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({},s,o)});case 7:return i=e.sent,e.abrupt("return",i);case 11:return e.next=13,u.findOneAndUpdate(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({uuid:a},s,{$size:0}),{$pull:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({},s,o)});case 13:return l=e.sent,e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),addMultiReferenceBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s,o,c,u,i;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("data",n),a=n.fieldName,s=n.finderItemUuids,o=n.isMultiSelect,c=n.refItemUuid,e.next=4,t.collection(r);case 4:if(u=e.sent,i=null,!o){e.next=12;break}return e.next=9,u.updateMany({uuid:{$in:s}},{$push:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({},a,c)});case 9:i=e.sent,e.next=15;break;case 12:return e.next=14,u.updateMany({uuid:{$in:s}},{$set:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({},a,c)});case 14:i=e.sent;case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),addReferenceBuilder=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a,s,o,c,u,i,l;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.belongsToItemId,s=n.collectionField,o=n.recordId,c=n.isMultiSelect,e.next=3,t.collection(r);case 3:if(u=e.sent,!c){e.next=11;break}return e.next=7,u.findOneAndUpdate({uuid:a},{$push:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({},s,o)});case 7:return i=e.sent,e.abrupt("return",i);case 11:return e.next=13,u.findOneAndUpdate(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({uuid:a},s,{$size:0}),{$push:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({},s,o)});case 13:return l=e.sent,e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),saveItemsImportedFromCSVForBuilderService=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r);case 2:return a=e.sent,e.abrupt("return",a.insertMany(n));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),deleteFieldRecordFromItemsService=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().mark((function e(t,r,n){var a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a={})[n]=1,e.next=4,t.collection(r).updateMany({},{$unset:a});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},8194:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{AZ:()=>addToItemFieldById,CH:()=>convertSingleItemToList,Ji:()=>importItemFromCSV,K5:()=>saveBulkDataInDb,LQ:()=>findOneItemByQuery,ME:()=>findItemById,MZ:()=>innerFilterResult,NL:()=>findOneByEqualFieldValueAndUpdate,Nq:()=>validateItemCollection,OK:()=>saveItem,Qo:()=>removeItemById,gv:()=>checkUniqueValidationFromCollection,ks:()=>updateItemById,nc:()=>convertStringDataToObject,nr:()=>modifiedList,ny:()=>convertPasswordTypeFields,o5:()=>refCollectionResult,oq:()=>convertAutoGenerateTypeFields,pb:()=>list,r1:()=>filterItemService,uC:()=>getItemsByQueryWithPagination,uM:()=>removeFromItemFieldById});var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6958),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8779),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(353),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9591),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1307),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4__),uuid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5828),uuid__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(uuid__WEBPACK_IMPORTED_MODULE_5__),moment__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(2245),moment__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_6__),external_api_util__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(4945),external_api_util__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(external_api_util__WEBPACK_IMPORTED_MODULE_7__),drapcode_utility__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(7060),drapcode_utility__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(drapcode_utility__WEBPACK_IMPORTED_MODULE_8__),_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(2826),_loginPlugin_loginUtils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(177),_utils_appUtils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(7714),_loginPlugin_jwtUtils__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(4554),_collection_form_collectionForm_util__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6966),_utils_utils__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(4786),_item_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(2827),_developer_developer_service__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(1758),_loginPlugin_user_service__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(1457),_email_email_service__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(6837),lodash__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(6517),lodash__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_19__);function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw s}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var BulkHasOperations=function(e){return e&&e.s&&e.s.currentBatch&&e.s.currentBatch.operations&&e.s.currentBatch.operations.length>0},reference=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.reference,belongsTo=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.belongsTo,password=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.password,image=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.image,multi_image=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.multi_image,file=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.file,multi_reference=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.multi_reference,createdBy=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.createdBy,dynamic_option=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.dynamic_option,static_option=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.static_option,custom_uuid=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.custom_uuid,text=external_api_util__WEBPACK_IMPORTED_MODULE_7__.FieldTypes.text,USER_COLLECTION="user",checkUniqueValidationFromCollection=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n){var a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r.toString().toLowerCase(),e.next=3,t.collection(r);case 3:return a=e.sent,e.next=6,a.findOne(n);case 6:if(null!==e.sent){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),saveItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,O,k=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=k.length>5&&void 0!==k[5]?k[5]:null,u=k.length>6&&void 0!==k[6]?k[6]:{},i=k.length>7&&void 0!==k[7]?k[7]:{},e.next=5,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 5:if(l=e.sent){e.next=8;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 8:if(p=l.constructors,_=l.fields,d=null!==(o=s)&&void 0!==o?o:"",f=d.constructorMetaObj,s&&s.hasOwnProperty("constructorMetaObj")&&delete s.constructorMetaObj,c&&(console.log("****** I have constructor Id"),(m=p.find((function(e){return c&&e.uuid===c})))&&(b=m.constructorData,v=f.ipAddress,h=f.navigator,g=f.previousActionResponse,x=f.previousActionFormData,console.log("\n constructorData 1 :>> ",b),b&&Object.entries(b).map((function(e){var t=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_2___default()(e,2),r=t[0],n=t[1];if(n&&"string"==typeof n&&n.startsWith("{{")){var a=n.replace(/{{(.*?)}}/g,"$1");if("CURRENT_DATE_TIME"===a)b[r]=new Date;else if("TIMESTAMP_IN_SEC"===a)b[r]=Math.round(Date.now()/1e3);else if("TIMESTAMP_IN_MILLISEC"===a)b[r]=Date.now();else if("USER_AGENT"===a){var s;b[r]=null!==(s=i["user-agent"])&&void 0!==s?s:""}else if("IP_ADDRESS"===a)b[r]=null!=v?v:"";else if("PLATFORM"===a){var o=(0,_item_utils__WEBPACK_IMPORTED_MODULE_15__.Xf)(h);b[r]=null!=o?o:""}else if(a.includes("current_user.")){var c=a.split(".")[1];b[r]=u?(0,_email_email_service__WEBPACK_IMPORTED_MODULE_18__.UB)(u,c):""}else if(a.includes("current_session.")){var l=a.replace("current_session.","");b[r]=(0,_email_email_service__WEBPACK_IMPORTED_MODULE_18__.UB)(g,l)}else if(a.includes("form_data_session.")){var p=a.replace("form_data_session.","");b[r]=(0,_email_email_service__WEBPACK_IMPORTED_MODULE_18__.UB)(x,p)}}})),console.log("\n constructorData 2 :>> ",b),s=(0,_collection_form_collectionForm_util__WEBPACK_IMPORTED_MODULE_13__.J)(b,s),console.log("ðŸš€ ~ file: item.service.js:97 ~ saveItem ~ itemData:",s))),y=[],_.map((function(e){var t=e.type,r=e.refCollection;r&&"undefined"!==r&&t===reference.id&&"innerForm"===r.displayType&&y.push(e)})),E=null,!(y.length>0)){e.next=18;break}return e.next=18,Promise.all(y.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var o;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,saveItem(t,r,n,a.refCollection.collectionName,s[a.fieldName],null,u);case 2:201===(o=e.sent).code?s[a.fieldName]=o.data.uuid:E=o;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:if(console.log("errorResponse out reference :>> ",E),!E){e.next=21;break}return e.abrupt("return",E);case 21:return a&&a===USER_COLLECTION&&(console.log("==> User item data :>> ",s),(0,_loginPlugin_user_service__WEBPACK_IMPORTED_MODULE_17__.ow)(l,s),console.log("==> Validate and update User item data :>> ",s)),e.next=24,saveCollectionItem(t,r,n,a,l,s,u,i);case 24:return O=e.sent,console.log("saveItemResponse :>> ",O),e.abrupt("return",O);case 27:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),saveCollectionItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o){var c,u,i,l,p,_,d,f,m,b,v,h=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=h.length>6&&void 0!==h[6]?h[6]:{},u=h.length>7?h[7]:void 0,e.next=4,validateItemCollection(r,s,o);case 4:if(i=e.sent,console.log("errorJson saveCollectionItem",i),0===Object.keys(i).length){e.next=12;break}if(l=i.field,p=i.isExist,0!==l){e.next=10;break}return e.abrupt("return",{code:500,data:"".concat(p," field does not exist."),message:{}});case 10:if(!l){e.next=12;break}return e.abrupt("return",{code:409,message:"Validation Failed",data:l});case 12:return _=(s||"").fields,d=!!_&&!!_.find((function(e){return"tenantId"===e.fieldName})),console.log("ðŸš€ ~ file: item.service.js:231 ~ hasTenantIdField:",d),e.next=17,convertAutoGenerateTypeFields(t,r,n,s,o);case 17:return o=e.sent,e.next=20,convertPasswordTypeFields(t,r,n,s,o);case 20:return o=e.sent,e.next=23,convertStringDataToObject(s,o);case 23:return o=e.sent,e.next=26,convertSingleItemToList(s,o);case 26:return(o=e.sent).createdAt=new Date,o.updatedAt=new Date,o.createdBy=c.uuid,d&&c.tenantId&&(f=u["x-tenant-id"],o.tenantId=f||(c.tenantId?[c.tenantId[0]]:"")),o.uuid=(0,uuid__WEBPACK_IMPORTED_MODULE_5__.v4)(),a=a.toString().toLowerCase(),e.next=35,r.collection(a);case 35:return m=e.sent,e.next=38,m.insertOne(o);case 38:return b=e.sent,e.next=41,saveBelongsToField(t,r,n,s,o,b.ops[0].uuid);case 41:if(!(v=e.sent)||!v[0]||null!==v[0].value){e.next=46;break}return e.next=45,removeItemById(r,a,b.ops[0].uuid);case 45:return e.abrupt("return",{code:400,message:"Can't save more than one if refrence field is not multi selectd",data:"Can't save more than one item if Child Of field Reference field is not multi select"});case 46:return e.abrupt("return",{code:201,message:"Item Created Successfully",data:b?b.ops[0]:{}});case 47:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),convertSingleItemToList=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.fields.filter((function(e){var t=e.type;return t===static_option.id||t===dynamic_option.id||t===reference.id})),a=Object.keys(r),!(n.length>0)){e.next=5;break}return e.next=5,Promise.all(n.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.includes(t.fieldName)&&(r[t.fieldName]=r[t.fieldName]?(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_8__.convertItemToArray)(r[t.fieldName]):[]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),saveBelongsToField=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o){var c;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=a.fields.filter((function(e){return e.type===belongsTo.id})))&&0!==c.length){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,Promise.all(c.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var c,u,i,l;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a.refCollection.collectionName,u=a.refCollection.parentCollectionField,!(i=s[a.fieldName])){e.next=8;break}return e.next=6,addItemToReferenceItemField(t,r,n,i,o,c,u);case 6:return l=e.sent,e.abrupt("return",l);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),addItemToReferenceItemField=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i,l,p,_;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,o);case 2:if(u=e.sent){e.next=5;break}return e.abrupt("return",{code:422,data:"Collection not found with provided name"});case 5:return i=u.fields.find((function(e){return e.fieldName===c})),o=o.toString(),e.next=9,r.collection(o);case 9:if(l=e.sent,!i.isMultiSelect){e.next=17;break}return e.next=13,l.findOneAndUpdate({uuid:a},{$push:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},c,s)});case 13:return p=e.sent,e.abrupt("return",p);case 17:return e.next=19,l.findOneAndUpdate(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({uuid:a},c,{$size:0}),{$push:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},c,s)});case 19:return _=e.sent,e.abrupt("return",_);case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),convertAutoGenerateTypeFields=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c,u,i,l,p,_=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=_.length>5&&void 0!==_[5]?_[5]:null,c=a.fields,u=a.collectionName,(i=c.filter((function(e){return e.type===custom_uuid.id})))&&0!==i.length){e.next=5;break}return e.abrupt("return",s);case 5:if(l=null,!o){e.next=11;break}return e.next=9,findItemById(t,r,n,u,o);case 9:l="success"===(l=e.sent).message?l.data:null;case 11:return e.next=13,findLastItem(r,u);case 13:return p=e.sent,console.log("lastItem",p),console.log("existingItem",l),i.forEach((function(e){var t=e.extraFieldSetting,r=e.fieldName;if(!l||!l[r]||0===l[r].length){console.log("I am inside");var n="",a="",o="",c=1;t instanceof Map?(console.log("I am map"),n=t.get("algorithm"),a=t.get("prepend"),o=t.get("append"),c=t.get("minLength")):(console.log("I am JSON"),n=t.algorithm,a=t.prepend,o=t.append,c=t.minLength),["randomAlphanumeric","randomNumeric","randomAlphabet"].includes(n)?s[r]=(0,_utils_utils__WEBPACK_IMPORTED_MODULE_14__.NZ)(a,c,o,n):s[r]=(0,_utils_utils__WEBPACK_IMPORTED_MODULE_14__.It)(p&&p[r]?p[r]:"",a,c,o,n)}})),e.abrupt("return",s);case 18:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),convertPasswordTypeFields=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c,u=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=u.length>5&&void 0!==u[5]?u[5]:null,!((c=a.fields.filter((function(e){return e.type===password.id}))).length>0)){e.next=5;break}return e.next=5,Promise.all(c.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(c){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=10;break}return e.next=3,findItemById(t,r,n,a.collectionName,o);case 3:if(e.sent[c.fieldName]===s[c.fieldName]){e.next=8;break}return e.next=7,(0,_loginPlugin_loginUtils__WEBPACK_IMPORTED_MODULE_10__.nu)(s[c.fieldName]);case 7:s[c.fieldName]=e.sent;case 8:e.next=13;break;case 10:return e.next=12,(0,_loginPlugin_loginUtils__WEBPACK_IMPORTED_MODULE_10__.nu)(s[c.fieldName]);case 12:s[c.fieldName]=e.sent;case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),convertStringDataToObject=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=t.fields.filter((function(e){return e.type===image.id||e.type===file.id||e.type===multi_image.id}))).length>0)){e.next=4;break}return e.next=4,Promise.all(n.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t){var n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=r[t.fieldName])&&"string"==typeof n&&(r[t.fieldName]=(0,_utils_appUtils__WEBPACK_IMPORTED_MODULE_11__.uO)(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();function filter(e,t){return _filter.apply(this,arguments)}function _filter(){return _filter=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Symbol(),e.next=3,Promise.all(t.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(t);case 2:if(!e.sent){e.next=6;break}e.t0=t,e.next=7;break;case 6:e.t0=n;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",e.sent.filter((function(e){return e!==n})));case 4:case"end":return e.stop()}}),e)}))),_filter.apply(this,arguments)}var validateUniqueFieldsKeyData=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a){var s,o,c,u,i;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.fields,o=r.collectionName,c={},u=s.filter((function(e){return e.unique})),e.next=5,filter(u,function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(r){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,countByQueryOther(t,o,r.fieldName,n[[r.fieldName]],a);case 2:return e.t0=e.sent,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return i=e.sent,console.log("**************ERROR*******************"),console.log("errors",i),i.some((function(e){if(e)return console.log("field.fieldTitle",e.fieldTitle),console.log("Object.keys(field.fieldTitle)",Object.keys(e.fieldTitle)),c.message="This ".concat(e&&e.fieldTitle?e.fieldTitle.en:e," already exists"),!0})),console.log("errorJson",c),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),validateItemCollection=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.length>3&&void 0!==y[3]?y[3]:null,s=!(y.length>4&&void 0!==y[4])||y[4],o=y.length>5&&void 0!==y[5]&&y[5],c=r.fields,u=Object.keys(n),i=!1,!s){e.next=23;break}l=_createForOfIteratorHelper(u),e.prev=8,_=_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(){var t,r;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=p.value,r=c.find((function(e){return e.fieldName===t})),r||delete n[t];case 3:case"end":return e.stop()}}),e)})),l.s();case 11:if((p=l.n()).done){e.next=15;break}return e.delegateYield(_(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),l.e(e.t1);case 20:return e.prev=20,l.f(),e.finish(20);case 23:if(!i){e.next=25;break}return e.abrupt("return",{field:0,isExist:i});case 25:if(d=c.filter((function(e){return e.required})),!o){e.next=46;break}f=_createForOfIteratorHelper(d),e.prev=28,f.s();case 30:if((m=f.n()).done){e.next=36;break}if(b=m.value,!Object.prototype.hasOwnProperty.call(n,"".concat(b.fieldName))||n["".concat(b.fieldName)]){e.next=34;break}return e.abrupt("return",{field:b.fieldTitle.en+" field is required"});case 34:e.next=30;break;case 36:e.next=41;break;case 38:e.prev=38,e.t2=e.catch(28),f.e(e.t2);case 41:return e.prev=41,f.f(),e.finish(41);case 44:e.next=63;break;case 46:v=_createForOfIteratorHelper(d),e.prev=47,v.s();case 49:if((h=v.n()).done){e.next=55;break}if(g=h.value,n["".concat(g.fieldName)]){e.next=53;break}return e.abrupt("return",{field:"".concat(g.fieldTitle.en," field is required")});case 53:e.next=49;break;case 55:e.next=60;break;case 57:e.prev=57,e.t3=e.catch(47),v.e(e.t3);case 60:return e.prev=60,v.f(),e.finish(60);case 63:return e.next=65,validateUniqueFieldsKeyData(t,r,n,a);case 65:if(x=e.sent,!(0,_utils_appUtils__WEBPACK_IMPORTED_MODULE_11__.Qr)(x)){e.next=70;break}return e.next=69,validateCompositeKeyData(t,r,n,a);case 69:x=e.sent;case 70:return e.abrupt("return",(0,_utils_appUtils__WEBPACK_IMPORTED_MODULE_11__.Qr)(x)?{}:{field:x?x.message:x});case 71:case"end":return e.stop()}}),e,null,[[8,17,20,23],[28,38,41,44],[47,57,60,63]])})));return function(t,r,n){return e.apply(this,arguments)}}(),list=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a){var s,o,c,u,i,l,p,_=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=_.length>4&&void 0!==_[4]?_[4]:null,o=_.length>5&&void 0!==_[5]?_[5]:{},console.log("list 1"),e.next=5,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 5:if(c=e.sent){e.next=8;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 8:if(u=[],s&&(Array.isArray(s)||(s=[s]),u.push({$match:{uuid:{$in:s}}})),console.log("list 4"),i=c.fields,u=[].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(u),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()((0,_developer_developer_service__WEBPACK_IMPORTED_MODULE_16__._H)(o,i))),!i.length){e.next=16;break}return e.next=16,Promise.all(i.map((function(e){if(e.type===reference.id||e.type===multi_reference.id){var t=e.refCollection?e.refCollection.collectionName:null;t&&u.push({$lookup:{from:"".concat(t),localField:e.fieldName,foreignField:"uuid",as:e.fieldName}})}})));case 16:return a=a.toString().toLowerCase(),e.next=19,r.collection(a);case 19:return l=e.sent,e.next=22,l.aggregate(u).toArray();case 22:return p=e.sent,console.log("result",p),e.abrupt("return",p);case 25:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),modifiedList=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a){var s,o,c,u,i,l,p,_=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=_.length>4&&void 0!==_[4]?_[4]:null,o=_.length>5&&void 0!==_[5]?_[5]:{},e.next=4,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 4:if(c=e.sent){e.next=7;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 7:if(u=[],s&&(Array.isArray(s)||(s=[s]),u.push({$match:{uuid:{$in:s}}})),!(i=c.fields).length){e.next=13;break}return e.next=13,Promise.all(i.map((function(e){if(e.type===reference.id||e.type===multi_reference.id){var t=e.refCollection?e.refCollection.collectionName:null;t&&u.push({$lookup:{from:"".concat(t),localField:e.fieldName,foreignField:"uuid",as:e.fieldName}})}})));case 13:return null!=o&&o.date&&u.push({$match:{updatedAt:{$gte:o.date}}},{$sort:{updatedAt:1}}),null!=o&&o.offset&&u.push({$skip:parseInt(o.offset)||0}),null!=o&&o.max&&u.push({$limit:parseInt(o.max)||100}),a=a.toString().toLowerCase(),e.next=19,r.collection(a);case 19:return l=e.sent,e.next=22,l.aggregate(u).toArray();case 22:return p=e.sent,console.log("result",p),e.abrupt("return",p);case 25:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),updateCollectionItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o){var c,u,i,l,p,_,d;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 3:if(c=e.sent){e.next=6;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 6:return u=filterFieldsToBeSaved(c,o),o=u.itemData,e.next=10,validateItemCollection(r,c,o,s,!0,!0);case 10:if(i=e.sent,0===Object.keys(i).length){e.next=18;break}if(0!==i.field){e.next=14;break}return e.abrupt("return",{code:404,message:"".concat(i.isExist," field does not exist."),data:{}});case 14:if(!i.field){e.next=16;break}return e.abrupt("return",{code:409,message:"validation failed",data:i.field});case 16:e.next=46;break;case 18:return delete o.uuid,e.next=21,convertAutoGenerateTypeFields(t,r,n,c,o,s);case 21:return o=e.sent,e.next=24,convertPasswordTypeFields(t,r,n,c,o,s);case 24:return o=e.sent,e.next=27,convertStringDataToObject(c,o);case 27:return o=e.sent,e.next=30,convertSingleItemToList(c,o);case 30:return(o=e.sent).updatedAt=new Date,l={uuid:s},p={$set:o},u&&Object.keys(u.fieldsToBeDeleted).length>0&&(p.$unset=u.fieldsToBeDeleted),a=a.toString().toLowerCase(),e.next=38,r.collection(a);case 38:return _=e.sent,e.next=41,_.findOneAndUpdate(l,p,{new:!0});case 41:if((d=e.sent)&&(!d.lastErrorObject||d.lastErrorObject.updatedExisting)){e.next=44;break}return e.abrupt("return",{code:404,message:"Item not found with provided id",data:{}});case 44:return o.uuid=s,e.abrupt("return",{code:200,message:"Item Updated Successfully",data:Object.assign(null==d?void 0:d.value,o)});case 46:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),updateItemById=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o){var c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,O,k=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=k.length>6&&void 0!==k[6]?k[6]:{},i=k.length>7&&void 0!==k[7]?k[7]:{},e.next=4,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 4:if(l=e.sent){e.next=7;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 7:if(p=l.constructors,_=l.fields,d=null!==(c=o)&&void 0!==c?c:"",f=d.constructorMetaObj,o&&o.hasOwnProperty("constructorMetaObj")&&delete o.constructorMetaObj,f&&Object.keys(f).length&&(m=f.constructorId,b=f.ipAddress,v=f.navigator,h=f.previousActionResponse,g=f.previousActionFormData,(x=p.find((function(e){return m&&e.uuid===m})))&&(y=x.constructorData,console.log("\n constructorData 1 :>> ",y),y&&Object.entries(y).map((function(e){var t=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_2___default()(e,2),r=t[0],n=t[1];if(n&&"string"==typeof n&&n.startsWith("{{")){var a=n.replace(/{{(.*?)}}/g,"$1");if("CURRENT_DATE_TIME"===a)y[r]=new Date;else if("TIMESTAMP_IN_SEC"===a)y[r]=Math.round(Date.now()/1e3);else if("TIMESTAMP_IN_MILLISEC"===a)y[r]=Date.now();else if("USER_AGENT"===a){var s;y[r]=null!==(s=i["user-agent"])&&void 0!==s?s:""}else if("IP_ADDRESS"===a)y[r]=null!=b?b:"";else if("PLATFORM"===a){var o=(0,_item_utils__WEBPACK_IMPORTED_MODULE_15__.Xf)(v);y[r]=null!=o?o:""}else if(a.includes("current_user.")){var c=a.split(".")[1];y[r]=u?(0,_email_email_service__WEBPACK_IMPORTED_MODULE_18__.UB)(u,c):""}else if(a.includes("current_session.")){var l=a.replace("current_session.","");y[r]=(0,_email_email_service__WEBPACK_IMPORTED_MODULE_18__.UB)(h,l)}else if(a.includes("form_data_session.")){var p=a.replace("form_data_session.","");y[r]=(0,_email_email_service__WEBPACK_IMPORTED_MODULE_18__.UB)(g,p)}}})),console.log("\n constructorData 2 :>> ",y),o=(0,_collection_form_collectionForm_util__WEBPACK_IMPORTED_MODULE_13__.J)(y,o),console.log("ðŸš€ ~ file: item.service.js:795 ~ updateItemById ~ itemData:",o))),E=_.filter((function(e){return e.type===reference.id&&"innerForm"===e.refCollection.displayType})),O=null,!(E.length>0)){e.next=16;break}return e.next=16,Promise.all(E.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,updateItemById(t,r,n,a.refCollection.collectionName,o[a.fieldName].uuid,o[a.fieldName]);case 2:200===(s=e.sent).code?o[a.fieldName]=s.data.uuid:O=s;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:if(!O){e.next=18;break}return e.abrupt("return",O);case 18:return e.next=20,updateCollectionItem(t,r,n,a,s,o,u);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),findItemById=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c,u,i=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.length>5&&void 0!==i[5]?i[5]:null,e.next=3,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 3:if(c=e.sent){e.next=6;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 6:return e.next=8,findItemByIdAfterCollection(r,c,s,o);case 8:return u=e.sent,console.log("*** ***PRODUCTION *** *** result",u),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),findItemByIdAfterCollection=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a){var s,o,c,u,i;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[{$match:a||{uuid:n}}],o=r.fields,c=r.collectionName,!o.length){e.next=5;break}return e.next=5,Promise.all(o.map((function(e){if(e.type===reference.id||e.type===multi_reference.id){var t=e.refCollection?e.refCollection.collectionName:null;t&&s.push({$lookup:{from:"".concat(t),let:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},"".concat(e.fieldName),"$".concat(e.fieldName)),pipeline:[{$match:{$expr:{$in:["$uuid",{$cond:{if:{$in:["$$".concat(e.fieldName),["",null]]},then:[],else:{$ifNull:["$$".concat(e.fieldName),[]]}}}]}}},{$lookup:{from:_loginPlugin_loginUtils__WEBPACK_IMPORTED_MODULE_10__.B0,let:{createdBy:"$createdBy"},pipeline:[{$match:{$expr:{$eq:["$uuid","$$createdBy"]}}},{$project:{_id:0,password:0}}],as:"createdBy"}}],as:e.fieldName}})}if(e.type===belongsTo.id){var r=e.refCollection?e.refCollection.collectionName:null;r&&s.push({$lookup:{from:"".concat(r),localField:e.fieldName,foreignField:"uuid",as:e.fieldName}})}e.type===createdBy.id&&s.push({$lookup:{from:"user",let:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},"".concat(e.fieldName),"$".concat(e.fieldName)),pipeline:[{$match:{$expr:{$eq:["$uuid","$$".concat(e.fieldName)]}}},{$project:{_id:0,password:0}}],as:e.fieldName}})})));case 5:return e.next=7,t.collection(c);case 7:return u=e.sent,e.next=10,u.aggregate(s).toArray();case 10:if((i=e.sent).length){e.next=13;break}return e.abrupt("return",{code:404,message:"Item not found with provided id"});case 13:return e.abrupt("return",{code:200,message:"success",data:i[0]});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),findOneItemByQuery=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r.toString().toLowerCase(),e.next=3,t.collection(r);case 3:return a=e.sent,e.next=6,a.findOne(n);case 6:return s=e.sent,e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),findLastItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("collectionName",r),e.next=3,t.collection(r);case 3:return n=e.sent,e.next=6,n.find().sort({_id:-1}).limit(1).toArray();case 6:return a=e.sent,console.log("res",a),e.abrupt("return",a[0]);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),validateCompositeKeyData=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a){var s,o,c,u,i,l,p;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},o=r.fields,c=r.constraints,!(u=c.find((function(e){return"COMPOSITE"===e.constraintType})))){e.next=19;break}return i=u.fields.map((function(e){return e.value})),l={project:{},match:{}},a&&(l.project.uuid="$uuid",l.match.uuid={$ne:a}),i.map((function(e){var t=o.find((function(t){return t.fieldName===e})),r=n[e];t.type===reference.id||t.type===static_option.id||t.type===dynamic_option.id?(Array.isArray(r)||(r=[r]),l.project[e]="$".concat(e),l.match[e]={$in:r||[]}):(l.project[e]=1,t.type===text.id?l.match[e]={$regex:"^".concat(r,"$"),$options:"i"}:l.match[e]={$eq:r})})),e.prev=8,e.next=11,countByMultipleQuery(t,r.collectionName,l);case 11:p=e.sent,console.log("countResponse->>>",p),p>0&&(s.message="Already present data of these "+u.fields.map((function(e){return e.label})).join(", ")+" fields."),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),console.log("errr",e.t0);case 19:return e.abrupt("return",s);case 20:case"end":return e.stop()}}),e,null,[[8,16]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),countByMultipleQuery=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n){var a,s,o;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r.toString().toLowerCase(),e.next=3,t.collection(r);case 3:return a=e.sent,s=[{$project:n.project},{$match:n.match},{$group:{_id:null,count:{$sum:1}}}],e.next=7,a.aggregate(s).toArray();case 7:if(!(o=e.sent).length){e.next=10;break}return e.abrupt("return",o[0].count);case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),countByQueryOther=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c,u,i;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return r=r.toString().toLowerCase(),e.next=5,t.collection(r);case 5:return c=e.sent,u=[{$project:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},n,{$toLower:"$".concat(n)})},{$match:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},n,{$eq:a?a.toString().toLowerCase():a})},{$group:{_id:null,count:{$sum:1}}}],s&&(u=[{$project:(o={},_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()(o,n,{$toLower:"$".concat(n)}),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()(o,"uuid","$uuid"),o)},{$match:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({uuid:{$ne:s}},n,{$eq:a?a.toString().toLowerCase():a})},{$group:{_id:null,count:{$sum:1}}}]),e.next=10,c.aggregate(u).toArray();case 10:if(!(i=e.sent).length){e.next=13;break}return e.abrupt("return",i[0].count);case 13:return e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),removeItemById=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n){var a,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r.toString().toLowerCase(),e.next=3,t.collection(r);case 3:return a=e.sent,e.next=6,a.deleteOne({uuid:n});case 6:if((s=e.sent)&&(!s.result||s.result.n)){e.next=9;break}return e.abrupt("return",{code:404,message:"Item not found with provided id",data:{}});case 9:return e.abrupt("return",{code:200,message:"Item Deleted Successfully",data:{}});case 10:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),findAllItems=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n,a,s,o,c,u,i=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},r=r.toString().toLowerCase(),a=+n.skip||0,s=+n.limit||100,e.next=6,t.collection(r);case 6:if(c=e.sent,!n.sortBy){e.next=13;break}return e.next=10,c.find({},{_id:0}).skip(a).limit(s).collation({locale:"en"}).sort(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},n.sortBy,n.orderBy||1)).toArray();case 10:o=e.sent,e.next=14;break;case 13:o=c.find({},{_id:0}).skip(a).limit(s).toArray();case 14:return e.next=16,getItemCount(t,r);case 16:return u=e.sent,e.abrupt("return",{code:200,message:"success",data:o,totalCount:u.data||0});case 18:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),getItemCount=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n,a,s,o=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{},r=r.toString().toLowerCase(),e.next=4,t.collection(r);case 4:return a=e.sent,e.next=7,a.countDocuments(n);case 7:return s=e.sent,e.abrupt("return",{code:200,message:"success",data:s});case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),innerFilterResult=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o){var c,u,i,l,p,_,d,f,m=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=m.length>7?m[7]:void 0,u=m.length>8?m[8]:void 0,i=m.length>9?m[9]:void 0,(m.length>6&&void 0!==m[6]?m[6]:{}).pagination="false",e.next=7,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.Jp)(t,a,s,o);case 7:if((l=e.sent)&&l.length){e.next=10;break}return e.abrupt("return",[]);case 10:return console.log("dbConnection------------",r),e.next=13,filterItemService(t,r,n,a,l[0],o,{},c,u,i,0,0,!0);case 13:if(p=e.sent,_=[],!p||200!=p.code){e.next=24;break}if(d=p.count,f=p.result,!d){e.next=21;break}_=[p],e.next=24;break;case 21:return e.next=23,f.map((function(e){return e.uuid}));case 23:_=e.sent;case 24:return e.abrupt("return",_);case 25:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),refCollectionResult=function(){var _ref42=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function _callee34(dbConnection,perconaDb,refCollection){var finder,queryData,constants,currentUser,timezone,condition,refField,req,condArr,mongoQuery,result,_args35=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function _callee34$(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:if(finder=_args35.length>3&&void 0!==_args35[3]?_args35[3]:{},queryData=_args35.length>4&&void 0!==_args35[4]?_args35[4]:{},constants=_args35.length>5?_args35[5]:void 0,currentUser=_args35.length>6?_args35[6]:void 0,timezone=_args35.length>7?_args35[7]:void 0,condition=_args35.length>8&&void 0!==_args35[8]?_args35[8]:{},refField=_args35.length>9?_args35[9]:void 0,condition.query){_context35.next=9;break}return _context35.abrupt("return",[]);case 9:return req={db:dbConnection},console.log(req,"eslint -disable no unused"),condition.query.field=refField,finder.conditions&&finder.conditions.length>1?(condArr=[],finder.conditions.map((function(e){e._id===condition._id?condArr.push(condition):condArr.push(e),finder.conditions=condArr}))):finder.conditions=[condition],finder.finder="FIND_ALL",queryData.pagination="false",_context35.prev=15,_context35.next=18,(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_8__.queryParser)(refCollection,finder,constants,queryData,currentUser,timezone,null);case 18:return mongoQuery=_context35.sent,_context35.next=21,eval(mongoQuery);case 21:return result=_context35.sent,queryData.pagination=!0,_context35.next=25,result.map((function(e){return e.uuid}));case 25:return _context35.abrupt("return",_context35.sent);case 28:return _context35.prev=28,_context35.t0=_context35.catch(15),console.log("error refCollectionResult :>> ",_context35.t0),_context35.abrupt("return",[]);case 32:case"end":return _context35.stop()}}),_callee34,null,[[15,28]])})));return function(e,t,r){return _ref42.apply(this,arguments)}}(),filterItemService=function(){var _ref44=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function _callee36(builderDB,dbConnection,perconaDb,projectId,collection,filterId){var queryData,headerToken,timezone,headers,count,search,stopNestedFilter,collectionName,isPrivate,constants,externalParams,finder,noOfExternalParams,refCollectionFields,fields,isInMemory,req,currentUser,isValidToken,reqQueryParams,searchObj,serachQueryTypeObj,refCollectionFieldsInItems,query,result,_args37=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function _callee36$(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(queryData=_args37.length>6&&void 0!==_args37[6]?_args37[6]:{},headerToken=_args37.length>7?_args37[7]:void 0,timezone=_args37.length>8?_args37[8]:void 0,headers=_args37.length>9?_args37[9]:void 0,count=_args37.length>10&&void 0!==_args37[10]?_args37[10]:0,search=_args37.length>11&&void 0!==_args37[11]?_args37[11]:0,stopNestedFilter=_args37.length>12&&void 0!==_args37[12]&&_args37[12],console.log("****** $$$$$$$ %%%%%%%%% $$$$$$$$$ ********"),collectionName=collection.collectionName,isPrivate=collection.isPrivate,constants=collection.constants,externalParams=collection.externalParams,finder=collection.finder,noOfExternalParams=collection.noOfExternalParams,refCollectionFields=collection.refCollectionFields,fields=collection.fields,isInMemory=collection.isInMemory,req=null,req=isInMemory&&perconaDb?{db:perconaDb}:{db:dbConnection},isPrivate="".concat(isPrivate),console.log("filterItemService 3"),console.log("Current User checking 3 ".concat(moment__WEBPACK_IMPORTED_MODULE_6___default().now())),"true"!=isPrivate){_context37.next=29;break}if(headerToken){_context37.next=18;break}return _context37.abrupt("return",{code:401,message:"No Token Provided",result:count?"0":[],count});case 18:return _context37.next=20,(0,_loginPlugin_jwtUtils__WEBPACK_IMPORTED_MODULE_12__.WX)(headerToken);case 20:if(isValidToken=_context37.sent,isValidToken&&0!==Object.keys(isValidToken).length&&Object.keys(isValidToken).includes("sub")){_context37.next=23;break}return _context37.abrupt("return",{code:401,message:"Invalid Token",result:count?"0":[],count});case 23:return _context37.next=25,findItemById(builderDB,dbConnection,projectId,_loginPlugin_loginUtils__WEBPACK_IMPORTED_MODULE_10__.B0,null,{$or:[{email:isValidToken.sub},{userName:isValidToken.sub}]});case 25:if(currentUser=_context37.sent,currentUser=currentUser.data,currentUser){_context37.next=29;break}return _context37.abrupt("return",{code:401,message:"Invalid Token",result:count?"0":[],count});case 29:if(stopNestedFilter&&(finder.fieldsInclude=["uuid"]),count&&(finder.finder="COUNT"),0==noOfExternalParams){_context37.next=37;break}if(externalParams=externalParams.map((function(e){return e.split("---")})),externalParams=externalParams.flat(),reqQueryParams=Object.keys(queryData),externalParams.every((function(e){return reqQueryParams.includes(e)}))){_context37.next=37;break}return _context37.abrupt("return",{code:422,message:"External params should be in [".concat(externalParams,"]"),result:[],count});case 37:if(searchObj=null,serachQueryTypeObj={},console.log("filterItemService 6"),search&&(searchObj=Object.assign({},queryData),delete searchObj.offset,delete searchObj.limit,externalParams.length&&externalParams.forEach((function(e){delete searchObj[e]})),Object.keys(searchObj).forEach((function(e){var t=fields.find((function(t){if(t.fieldName===e)return t;if(e.startsWith("start_")||e.startsWith("end_")){var r=e.replace("start_","");if((r=r.replace("end_",""))===t.fieldName)return t}}));t||delete searchObj[e],t&&(serachQueryTypeObj[e]=t.type)}))),console.log("Finder Calculation 4 ".concat(moment__WEBPACK_IMPORTED_MODULE_6___default().now())),!finder||!finder.conditions.length){_context37.next=45;break}return _context37.next=45,Promise.all(finder.conditions.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t){var r,n,a,s,o,c,u,i,l,p;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.query){e.next=2;break}return e.abrupt("return");case 2:if(r=t.query,n=r.fieldType,a=r.refCollection,s=r.refField,o=r.isFilter,c=r.field,u=r.value,"reference"!==n&&"belongsTo"!==n){e.next=38;break}if(a){e.next=6;break}return e.abrupt("return");case 6:if(i=[],!o||stopNestedFilter){e.next=13;break}return e.next=10,innerFilterResult(builderDB,dbConnection,perconaDb,projectId,a,u,queryData,headerToken,timezone,headers);case 10:i=e.sent,e.next=32;break;case 13:if(!u.startsWith("ENTITY::")){e.next=19;break}l=u.replace("ENTITY::",""),i=queryData[l]?queryData[l]:"",delete searchObj[l],e.next=32;break;case 19:if("CURRENT_USER"!==a){e.next=28;break}console.log(">>>>>>>>>>>>CURRENT_USER>>>>>>>>>>>>>>"),console.log("refField",s),p=headers["x-tenant-id"],i=s&&"tenantId"===s&&p?p:currentUser[s]&&currentUser[s].length?currentUser[s][0].uuid:"",console.log("ðŸš€ ~ file: item.service.js:1338 ~ finder.conditions.map ~ value#1:",i),currentUser&&!i&&lodash__WEBPACK_IMPORTED_MODULE_19___default().get(currentUser,s)&&(i=currentUser.uuid,console.log("ðŸš€ ~ file: item.service.js:1353 ~ finder.conditions.map ~ value#2:",i)),e.next=31;break;case 28:return e.next=30,refCollectionResult(dbConnection,perconaDb,a,finder,queryData,constants,currentUser,timezone,t,s);case 30:i=e.sent;case 31:t.query.field=c;case 32:console.log("ðŸš€ ~ file: item.service.js:1364 ~ finder.conditions.map ~ value:",i),"undefined"!==i&&"null"!==i&&null!=i&&""!==i||(i="random_string_since_field_not_present_".concat(moment__WEBPACK_IMPORTED_MODULE_6___default()(1318874398806).valueOf()),t.query.value=i),console.log("******** $$$$$$$ *****"),console.log("value",i),console.log("******** $$$$$$$ *****"),(Array.isArray(i)&&i.length||!Array.isArray(i)&&!i.startsWith("random_string_since_field_not_present_"))&&(t.query.value=i,t.requiredExternal=!1);case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 45:if(count&&(finder.finder="COUNT"),console.log(")))))))))))))))))))))))))))))))))"),_context37.prev=47,refCollectionFieldsInItems=refCollectionFields&&refCollectionFields.length?refCollectionFields:null,console.log(">>>>>>>>>> searchObj 5 :>> ",searchObj,moment__WEBPACK_IMPORTED_MODULE_6___default().now()),query="",!["SUM","AVG","MIN","MAX"].includes(finder.finder)){_context37.next=57;break}return _context37.next=54,(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_8__.queryParserNew)(collectionName,finder,constants,queryData,currentUser,timezone,searchObj,refCollectionFieldsInItems,serachQueryTypeObj);case 54:query=_context37.sent,_context37.next=62;break;case 57:return console.log("ðŸš€ ~ file: item.service.js:1426 ~ finder:",JSON.stringify(finder)),console.log("ðŸš€ ~ file: item.service.js:1426 ~ finder.conditions:",finder.conditions),_context37.next=61,(0,drapcode_utility__WEBPACK_IMPORTED_MODULE_8__.queryParser)(collectionName,finder,constants,queryData,currentUser,timezone,searchObj,refCollectionFieldsInItems,serachQueryTypeObj);case 61:query=_context37.sent;case 62:return console.log("query $$$$$$$$$$$",query),_context37.next=65,eval(query);case 65:return result=_context37.sent,console.log(":::::::::result"),"COUNT"==finder.finder?result="".concat(result&&result.length?result[0].count:0):"SUM"==finder.finder?result="".concat(result&&result.length?result[0].total:0):"AVG"==finder.finder?result="".concat(result&&result.length?result[0].average:0):"MIN"==finder.finder?result="".concat(result&&result.length?result[0].minimum:0):"MAX"==finder.finder&&(result="".concat(result&&result.length?result[0].maximum:0)),_context37.abrupt("return",{code:200,message:"success",result,count});case 71:return _context37.prev=71,_context37.t0=_context37.catch(47),console.log("error filterItemService :>> ",_context37.t0),_context37.abrupt("return",{code:400,message:_context37.t0.message});case 75:case"end":return _context37.stop()}}),_callee36,null,[[47,71]])})));return function(e,t,r,n,a,s){return _ref44.apply(this,arguments)}}(),addItemToField=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.fields.filter((function(e){return e.type===reference.id})),c=a.collectionName,e.next=4,Promise.all(o.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var o,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=a.fieldName,(u=s[a.fieldName])&&u.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,addItemToReferenceItemField(t,r,n,s.itemId,a,c,o);case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),addToCollectionItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i,l,p,_=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=_.length>7&&void 0!==_[7]?_[7]:{},e.next=3,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 6:return delete c.uuid,e.next=9,convertPasswordTypeFields(t,r,n,i,c,s);case 9:return c=e.sent,e.next=12,convertStringDataToObject(i,c);case 12:return c=e.sent,e.next=15,convertSingleItemToList(i,c);case 15:return(c=e.sent).updatedAt=new Date,!c.createdBy&&u&&(c.createdBy=u.uuid),e.next=20,addItemToField(t,r,n,i,c,o,s);case 20:if(!(l=e.sent)||!l[0]||null!==l[0].value){e.next=25;break}return e.next=24,removeItemById(r,a,o);case 24:return e.abrupt("return",{code:400,message:"Can't save more than one if refrence field is not multi selectd",data:"Can't save more than one item if Child Of field Reference field is not multi select"});case 25:return e.next=27,findItemById(t,r,n,a,s);case 27:return 200===(p=e.sent).code&&(c.itemData=p.data),c.uuid=s,e.abrupt("return",{code:200,message:"Added Successfully",data:c});case 31:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),addToItemFieldById=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=i.length>7&&void 0!==i[7]?i[7]:{},!c||c.dataItemId){e.next=3;break}return e.abrupt("return",{code:404,data:{error:"Collection item not found!"}});case 3:return e.next=5,addToCollectionItem(t,r,n,a,s,o,c,u);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),removeItemFromField=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.fields.filter((function(e){return e.type===reference.id})),c=a.collectionName,e.next=4,Promise.all(o.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var o,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=a.fieldName,(u=s[a.fieldName])&&u.map(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(a){var u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,removeItemFromReferenceItemField(t,r,n,s.itemId,a,c,o);case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),getItemForUpdate=function(e,t){return delete e[t],e},saveBulkDataInDb=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_,d=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>2&&void 0!==d[2]?d[2]:[],a=r.collectionName,s=r.connectorType,o=r.customPrimaryKey,console.log("**************************************"),console.log("*****************saveBulkDataInDb******START***************"),console.log("**************************************"),console.log("customPrimaryKey",o),c=o||(0,external_api_util__WEBPACK_IMPORTED_MODULE_7__.getPrimaryFieldNameOfDataSource)(s),Array.isArray(n)||(n=[n]),e.next=10,t.collection(a);case 10:if(u=e.sent,i=u.initializeUnorderedBulkOp(),console.log("primaryKey",c),l=[],p=n.map((function(e){var t=e.uuid?e.uuid:(0,uuid__WEBPACK_IMPORTED_MODULE_5__.v4)();console.log("itemUuid",t),e[c]=e[c]?e[c]:(0,uuid__WEBPACK_IMPORTED_MODULE_5__.v4)(),console.log("item[primaryKey]",e[c]);var r=(0,external_api_util__WEBPACK_IMPORTED_MODULE_7__.getFindQuery)(s,e,o);console.log("findQuery",r),l.push(r[c]),console.log("finalFindQuery",l);var n=getItemForUpdate(e,"uuid");return console.log("itemsToUpdate",n),i.find(r).upsert().updateOne({$set:n,$setOnInsert:{uuid:t}}),e[c]})),_=[],!BulkHasOperations(i)){e.next=23;break}return e.next=19,i.execute();case 19:return e.next=21,u.find(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},c,{$in:l})).toArray();case 21:_=(_=e.sent).map((function(e){return e.uuid}));case 23:return console.log("**************************************"),console.log("*****************saveBulkDataInDb******END***************"),console.log("**************************************"),e.abrupt("return",{primaryKey:c,itemsPrimaryKeyValues:p,itemsUuid:_});case 27:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),removeItemFromReferenceItemField=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i,l,p,_;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,o);case 2:if(u=e.sent){e.next=5;break}return e.abrupt("return",{code:422,data:{error:"Collection not found with provided name"}});case 5:return i=u.fields.find((function(e){return e.fieldName===c})),o=o.toString(),e.next=9,r.collection(o);case 9:if(l=e.sent,!i.isMultiSelect){e.next=17;break}return e.next=13,l.findOneAndUpdate({uuid:a},{$pull:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},c,s)});case 13:return p=e.sent,e.abrupt("return",p);case 17:return e.next=19,l.findOneAndUpdate(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({uuid:a},c,{$size:0}),{$pull:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},c,s)});case 19:return _=e.sent,e.abrupt("return",_);case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),findOneByEqualFieldValueAndUpdate=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(r).findOneAndUpdate(n,{$push:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},a,s)},{new:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),removeFromCollectionItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i,l,p,_=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=_.length>7&&void 0!==_[7]?_[7]:{},e.next=3,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",{code:404,data:{error:"Collection not found with provided name"}});case 6:return delete c.uuid,e.next=9,convertPasswordTypeFields(t,r,n,i,c,s);case 9:return c=e.sent,e.next=12,convertStringDataToObject(i,c);case 12:return c=e.sent,e.next=15,convertSingleItemToList(i,c);case 15:return(c=e.sent).updatedAt=new Date,!c.createdBy&&u&&(c.createdBy=u.uuid),e.next=20,removeItemFromField(t,r,n,i,c);case 20:if(!(l=e.sent)||!l[0]||null!==l[0].value){e.next=25;break}return e.next=24,removeItemById(r,a,o);case 24:return e.abrupt("return",{code:400,message:"Can't save more than one if refrence field is not multi selectd",data:"Can't save more than one item if Child Of field Reference field is not multi select"});case 25:return e.next=27,findItemById(t,r,n,a,s);case 27:return 200===(p=e.sent).code&&(c.itemData=p.data),c.uuid=s,e.abrupt("return",{code:200,message:"Removed Successfully",data:c});case 31:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),removeFromItemFieldById=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=i.length>7&&void 0!==i[7]?i[7]:{},!c||c.dataItemId){e.next=3;break}return e.abrupt("return",{code:404,data:{error:"Collection item not found!"}});case 3:return e.next=5,removeFromCollectionItem(t,r,n,a,s,o,c,u);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),getItemsByQueryWithPagination=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o,c){var u,i,l,p,_;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,a,n);case 2:if(u=e.sent){e.next=5;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 5:if(i=[{$match:s||{}}],!(l=u.fields).length){e.next=10;break}return e.next=10,Promise.all(l.map((function(e){if(e.type===reference.id||e.type===multi_reference.id){var t=e.refCollection?e.refCollection.collectionName:null;t&&i.push({$lookup:{from:"".concat(t),let:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},"".concat(e.fieldName),"$".concat(e.fieldName)),pipeline:[{$match:{$expr:{$in:["$uuid",{$cond:{if:{$in:["$$".concat(e.fieldName),["",null]]},then:[],else:{$ifNull:["$$".concat(e.fieldName),[]]}}}]}}},{$lookup:{from:_loginPlugin_loginUtils__WEBPACK_IMPORTED_MODULE_10__.B0,let:{createdBy:"$createdBy"},pipeline:[{$match:{$expr:{$eq:["$uuid","$$createdBy"]}}},{$project:{_id:0,password:0}}],as:"createdBy"}}],as:e.fieldName}})}if(e.type===belongsTo.id){var r=e.refCollection?e.refCollection.collectionName:null;r&&i.push({$lookup:{from:"".concat(r),localField:e.fieldName,foreignField:"uuid",as:e.fieldName}})}e.type===createdBy.id&&i.push({$lookup:{from:"user",let:_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},"".concat(e.fieldName),"$".concat(e.fieldName)),pipeline:[{$match:{$expr:{$eq:["$uuid","$$".concat(e.fieldName)]}}},{$project:{_id:0,password:0}}],as:e.fieldName}})})));case 10:return n=n.toString().toLowerCase(),e.next=13,r.collection(n);case 13:return p=e.sent,o&&c&&(i.push({$sort:{_id:-1}}),i.push({$skip:c*o},{$limit:+c})),e.next=17,p.aggregate(i).toArray();case 17:if((_=e.sent).length){e.next=20;break}return e.abrupt("return",{code:404,message:"Item not found with provided id"});case 20:return e.abrupt("return",{code:200,message:"success",data:_});case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),importItemFromCSV=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s,o){var c,u,i,l,p,_,d,f,m,b,v,h,g,x,y;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=o.fields,u=o.items,e.next=3,(0,_collection_collection_service__WEBPACK_IMPORTED_MODULE_9__.n6)(t,n,a);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 6:l=i.fields,l=(0,_item_utils__WEBPACK_IMPORTED_MODULE_15__._6)(l),p=l.map((function(e){return e.fieldName})),p=c.length>p.length?p.filter((function(e){return c.includes(e)})):c.filter((function(e){return p.includes(e)})),console.log("allowedCollectionFieldList",p),_=u.map((function(e){var t={};return p.forEach((function(r){return t[r]=e[r]})),t})),d=[],f=[],m=_createForOfIteratorHelper(_),e.prev=15,m.s();case 17:if((b=m.n()).done){e.next=26;break}return v=b.value,"user"===a&&(v.password||(v.password=(0,uuid__WEBPACK_IMPORTED_MODULE_5__.v4)())),e.next=22,prepareCSVItem(t,r,n,i,v);case 22:(h=e.sent).error?f.push(h.message):h.itemData&&Object.keys(h.itemData).length>0&&d.push(h.itemData);case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(15),m.e(e.t0);case 31:return e.prev=31,m.f(),e.finish(31);case 34:if(f&&f.length>0&&(f=(f=(g=[]).concat.apply(g,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(f))).filter((function(e,t){return f.indexOf(e)===t})),console.log("errors",f)),!(d.length>0)){e.next=46;break}return console.log("finalItems",_),e.next=39,r.collection(a);case 39:return x=e.sent,e.next=42,x.insertMany(_);case 42:return y=e.sent,e.abrupt("return",{status:200,data:y,errors:f});case 46:return e.abrupt("return",{status:422,msg:"Failed to import CSV",errors:f});case 47:case"end":return e.stop()}}),e,null,[[15,28,31,34]])})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),prepareCSVItem=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().mark((function e(t,r,n,a,s){var o,c,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_4___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,convertSingleItemToList(a,s);case 2:return o=e.sent,e.next=5,validateItemCollection(r,a,o);case 5:if(c=e.sent,0===Object.keys(c).length){e.next=9;break}return u=Object.keys(c).map((function(e){return"".concat(e,":").concat(c[e])})),e.abrupt("return",{error:!0,message:u});case 9:return e.next=11,convertStringDataToObject(a,o);case 11:return o=e.sent,e.next=14,convertPasswordTypeFields(t,r,n,a,o);case 14:return(o=e.sent).createdAt=new Date,o.updatedAt=new Date,o.uuid=(0,uuid__WEBPACK_IMPORTED_MODULE_5__.v4)(),e.abrupt("return",{error:!1,itemData:o});case 19:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),filterFieldsToBeSaved=function(e,t){for(var r=e.fields,n=Object.keys(t),a={},s=function(){var e=c[o],t=r.find((function(t){return t.fieldName===e}));t||(a[e]=1)},o=0,c=n;o<c.length;o++)s();if(Object.keys(a).length>0)for(var u in a)delete t[u];return{fieldsToBeDeleted:a,itemData:t}}},2827:(e,t,r)=>{"use strict";r.d(t,{Rh:()=>k,Xf:()=>P,_6:()=>D});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(4945),u=c.FieldTypes.createdAt,i=c.FieldTypes.isDeleted,l=c.FieldTypes.updatedAt,p=c.FieldTypes.password,_=c.FieldTypes.file,d=c.FieldTypes.object,f=c.FieldTypes.createdBy,m=c.FieldTypes.multi_reference,b=c.FieldTypes.reference,v=c.FieldTypes.belongsTo,h=c.FieldTypes.uuid,g=c.FieldTypes.image,x=c.FieldTypes.multi_image,y=[u.id,i.id,l.id,p.id,_.id,d.id,f.id],E=[f.id,u.id,l.id,h.id,i.id,g.id,x.id,p.id],O=[b.id,m.id,v.id],k=function(){var e=a()(o().mark((function e(t,r,n){var a,s,c,u,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Array.isArray(n)||(n=[n]),a=[],s=t.fields,(c=t.finder)&&1!==c.fieldsInclude.length&&(a=c.fieldsInclude),a&&0!==a.length||s.forEach((function(e){var t=e.type;y.includes(t)||a.push(e.fieldName)})),u=[],i=[],a.forEach((function(e){var t=s.find((function(t){return t.fieldName===e}));if(t){var r=t.fieldTitle,n=t.fieldName,a=t.type,o=t.refCollection;u.push({key:e,header:r.en}),i.push({key:e,fieldName:n,type:a,refCollectionField:o?o.collectionField:""})}})),l=[],n.forEach((function(e){var t={};i.forEach((function(r){var n=r.key,a=r.fieldName,s=r.type,o=r.refCollectionField,c=e[a];c&&"undefined"!==c?O.includes(s)?Array.isArray(c)?t[n]=c.map((function(e){return e[o]})).join(","):t[n]=c[o]:Array.isArray(c)?t[n]=c.join(","):t[n]=c:t[n]=""})),l.push(t)})),e.abrupt("return",{finalData:l,headerColumns:u});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),D=function(e){return e.filter((function(e){return!E.includes(e.type)}))},P=function(e){var t=null!=e?e:"",r=t.platform,n=t.userAgent,a=t.userAgentData,s="",o=a?a.platform:r;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K","macOS"].indexOf(o)?s="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(o)?s="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(o)?s="Windows":/Android/.test(n)?s="Android":!s&&/Linux/.test(o)&&(s="Linux"),s}},7079:(e,t,r)=>{"use strict";r.d(t,{C0:()=>b,Ct:()=>v,FT:()=>f,US:()=>m,ag:()=>g,l5:()=>x,tW:()=>y});var n=r(8779),a=r.n(n),s=r(9591),o=r.n(s),c=r(1307),u=r.n(c),i=r(2167),l=r.n(i),p=r(7714);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f={BACKENDLESS:"backendless",XANO:"xano",FIREBASE:"firebase"},m=function(){var e=o()(u().mark((function e(t,r,n){var a,s,o,c,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.api_url,s=r.app_key,a=(0,p.LO)(a,t),s=(0,p.LO)(s,t),o="".concat(a,":signUp?key=").concat(s),e.prev=4,e.next=7,l().post(o,n);case 7:return c=e.sent,i=c.data,e.abrupt("return",{success:!0,data:i});case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",E(e.t0,!0));case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),b=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,_;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api_url,o=r.app_key,s=(0,p.LO)(s,t),o=(0,p.LO)(o,t),c="".concat(s,":signInWithPassword?key=").concat(o),e.prev=4,e.next=7,l().post(c,{email:n,password:a,returnSecureToken:!0});case 7:return i=e.sent,_=i.data,e.abrupt("return",{success:!0,data:_});case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",E(e.t0,!0));case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),v=function(){var e=o()(u().mark((function e(t,r,n){var a,s,o,c,i,_;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.api_url,s=r.app_id,a=(0,p.LO)(a,t),s=(0,p.LO)(s,t),o="".concat(a,":").concat(s,"/auth/signup"),e.prev=4,e.next=7,l().post(o,n);case 7:return c=e.sent,i=c.data,e.next=11,h(t,r,i.authToken);case 11:return _=e.sent,e.abrupt("return",{success:!0,data:d(d({},i),_.data)});case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",E(e.t0));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t,r,n){return e.apply(this,arguments)}}(),h=function(){var e=o()(u().mark((function e(t,r,n){var a,s,o,c,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.api_url,s=r.app_id,a=(0,p.LO)(a,t),s=(0,p.LO)(s,t),o="".concat(a,":").concat(s,"/auth/me"),e.prev=4,e.next=7,l().get(o,{headers:{Authorization:n}});case 7:return c=e.sent,i=c.data,e.abrupt("return",{success:!0,data:i});case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",E(e.t0));case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),g=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,_,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api_url,o=r.app_id,s=(0,p.LO)(s,t),o=(0,p.LO)(o,t),c="".concat(s,":").concat(o,"/auth/login"),e.prev=4,e.next=7,l().post(c,{email:n,password:a});case 7:return i=e.sent,_=i.data,e.next=11,h(r,_.authToken);case 11:return f=e.sent,e.abrupt("return",{success:!0,data:d(d({},_),f.data)});case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",E(e.t0));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),x=function(){var e=o()(u().mark((function e(t,r,n){var a,s,o,c,i,_;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.api_url,s=r.app_id,o=r.rest_api_id,a=(0,p.LO)(a,t),s=(0,p.LO)(s,t),o=(0,p.LO)(o,t),c="".concat(a).concat(s,"/").concat(o,"/users/register"),e.prev=5,e.next=8,l().post(c,n);case 8:return i=e.sent,_=i.data,e.abrupt("return",{success:!0,data:_});case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",E(e.t0));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),y=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,_,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api_url,o=r.app_id,c=r.rest_api_id,s=(0,p.LO)(s,t),o=(0,p.LO)(o,t),c=(0,p.LO)(c,t),i="".concat(s).concat(o,"/").concat(c,"/users/login"),e.prev=5,e.next=8,l().post(i,{login:n,password:a},{headers:{"Content-Type":"application/json"}});case 8:return _=e.sent,d=_.data,e.abrupt("return",{success:!0,data:d});case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",E(e.t0));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),E=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return{status:400,message:"Error",success:!1};var r=e.response;if(!r)return{status:400,message:"Error",success:!1};var n=r.data,a=r.status;if(!n)return{status:a||400,message:"Error",success:!1};if(t){var s=n.error,o=s.code,c=s.message,u=s.errors;return console.log("errors :>> ",u),{status:o,message:c,success:!1}}var i=n.message,l=n.payload,p="";return l&&(p=l.param),{success:!1,status:a||400,message:"".concat(void 0!==p&&p?"".concat(p," :"):"").concat(i)}}},4554:(e,t,r)=>{"use strict";r.d(t,{_t:()=>v,$v:()=>g,EI:()=>y,WX:()=>h});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(7060);const u=require("jsonwebtoken");var i=r.n(u),l=r(3511),p=r.n(l),_=r(8027),d=r(8194),f=r(177),m="addjsonwebtokensecretherelikeQuiscustodietipsoscustodes",b={expiresIn:"30m",algorithm:"HS256"},v=function(e){var t={sub:e.username||e.userName||e.email,iat:Date.now()};return{token:"Bearer "+i().sign(t,m,b),expires:b.expiresIn}},h=function(e){try{return e.startsWith("Bearer ")&&(e=e.substring(7,e.length)),i().verify(e,m,b)}catch(e){return console.log("e: verify token ",e),null}};function g(e,t,r){return x.apply(this,arguments)}function x(){return x=a()(o().mark((function e(t,r,n){var s,u,i,l,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Verifying JWT Authentication for secure: >> 1"),!t.originalUrl.includes("finder")){e.next=3;break}return e.abrupt("return",n());case 3:if(!(s=t.get("origin"))||!s.includes("admin")){e.next=6;break}return e.abrupt("return",n());case 6:return u=t.headers,i=t.builderDB,l=t.db,m=t.projectId,e.next=9,(0,_.Z)(i,{code:c.pluginCode.LOGIN,projectId:m});case 9:if(e.sent){e.next=12;break}return e.abrupt("return",n());case 12:if(console.log("I have installed login plugin: >>2"),u.authorization){e.next=15;break}return e.abrupt("return",r.status(401).send({code:401,message:"No token provided."}));case 15:p().authenticate("jwt",{session:!1},function(){var e=a()(o().mark((function e(a,s,c){var u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=2;break}return e.abrupt("return",n(a));case 2:if(s){e.next=5;break}return c.code=403,e.abrupt("return",r.status(403).send(c));case 5:return e.next=7,(0,d.LQ)(l,f.B0,{userName:s.sub});case 7:if(u=e.sent){e.next=10;break}return e.abrupt("return",r.status(401).send({code:403,message:"Invalid token."}));case 10:t.user=u,n();case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())(t,r,n);case 16:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function y(e,t,r){return E.apply(this,arguments)}function E(){return E=a()(o().mark((function e(t,r,n){var s,c,u,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Verifying JWT Authentication for Open: >> 1"),s=t.headers,c=t.db,!(u=s.authorization)){e.next=19;break}return i=u.split(" ")[1],e.prev=5,e.next=8,h(i);case 8:l=e.sent,t.user=l,p().authenticate("jwt",{session:!1},function(){var e=a()(o().mark((function e(a,s,u){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=2;break}return e.abrupt("return",n(a));case 2:if(s){e.next=5;break}return u.code=403,e.abrupt("return",r.status(403).send(u));case 5:return e.next=7,(0,d.LQ)(c,f.B0,{userName:s.sub});case 7:if(i=e.sent){e.next=10;break}return e.abrupt("return",r.status(401).send({code:403,message:"Invalid token."}));case 10:t.user=i,n();case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())(t,r,n),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),console.log("verifyJwtForOpen errrrrrrrrrrrrrrrrrrrrrrrrr",e.t0),new Error(e.t0);case 17:e.next=20;break;case 19:n();case 20:case"end":return e.stop()}}),e,null,[[5,13]])}))),E.apply(this,arguments)}},177:(e,t,r)=>{"use strict";r.d(t,{B0:()=>a,lc:()=>s,mp:()=>u,nu:()=>c});var n=r(7714),a="user",s="role",o=r(7096),c=function(e){return o.hash(e,n.pS)},u=function(e,t){return o.compare(e,t)}},2707:(e,t,r)=>{"use strict";r.r(t),r.d(t,{githubAuth:()=>j});var n=r(8779),a=r.n(n),s=r(9591),o=r.n(s),c=r(1307),u=r.n(c),i=r(3511),l=r.n(i),p=r(7060),_=r(8194),d=r(177),f=r(1457),m=r(8027),b=r(2167),v=r.n(b),h=r(7079),g=r(4786),x=r(7920);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=new(r(306)),k=r(7055).Strategy,D=r(136).Strategy,P={jwtFromRequest:r(136).ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:"addjsonwebtokensecretherelikeQuiscustodietipsoscustodes",algorithms:["HS256"]},I={usernameField:"userName",passwordField:"password",passReqToCallback:!0},w=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,l,p,b,v,h,g,x,y,k,D,P,I,w,T,M,A;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.builderDB,o=t.db,c=t.projectId,i=t.body,l=t.query,p=i.provider,b=l.authType,!p||"Github"!==p){e.next=8;break}return e.next=6,j(i);case 6:(v=e.sent)&&(r=v.login,t.body=v);case 8:return h=r,i.email&&(h=i.email),console.log("==> authenticateUser emailFieldValue: ",h),g={},g=i.email?i.queryType&&"OR"===i.queryType?{$or:[{email:h},{userName:r}]}:{$and:[{email:h},{userName:r}]}:{$or:[{email:h},{userName:r}]},console.log("==> authenticateUser query: ",g),e.next=16,(0,_.ME)(s,o,c,d.B0,null,g);case 16:if(x=e.sent,y=x.data,console.log("user login:>> ",y),e.prev=19,!["Facebook","Google","Github","Twitter","Linkedin"].includes(p)){e.next=33;break}if(k=null,y){e.next=28;break}return e.next=25,(0,f.JR)(s,o,c,i);case 25:k=e.sent,e.next=31;break;case 28:return e.next=30,(0,f.gM)(o,i,y.uuid);case 30:k=e.sent;case 31:return y=k.data,e.abrupt("return",a(null,y));case 33:if(y){e.next=35;break}return e.abrupt("return",a(null,!1,{message:"This user does not exists.",status:404}));case 35:return e.next=37,(0,m.Z)(s,{code:"LOGIN",projectId:c});case 37:if(!(D=e.sent)||!D.setting){e.next=44;break}if(P=D.setting,I=P.is_email_verified,w=P.is_enabled,!I||y.is_email_verified){e.next=42;break}return e.abrupt("return",a(null,!1,{message:"Please verify email first.",status:401}));case 42:if(!w||y.is_enabled){e.next=44;break}return e.abrupt("return",a(null,!1,{message:"Account is not active.",status:401}));case 44:return e.next=46,(0,d.mp)(n,y.password);case 46:if(e.sent){e.next=49;break}return e.abrupt("return",a(null,!1,{message:"Username or password does not match. Please try again",status:401}));case 49:if(!b||"anonymous"!==b){e.next=60;break}return e.next=52,(0,d.nu)(O.string({length:10}));case 52:return y.password=e.sent,y._id&&delete y._id,T={$set:y},e.next=57,o.collection(d.B0);case 57:return M=e.sent,e.next=60,M.findOneAndUpdate(g,T,{new:!0});case 60:if(A="",!(y.userRoles&&y.userRoles.length>0)){e.next=65;break}return e.next=64,(0,_.LQ)(o,d.lc,{name:y.userRoles[0]});case 64:A=e.sent;case 65:if(A&&0!==A.length){e.next=67;break}return e.abrupt("return",a(null,!1,{message:"The provided role does not exist. Please verify and try again.",status:401}));case 67:return e.abrupt("return",a(null,E(E({},y),{},{role:A.uuid})));case 70:e.prev=70,e.t0=e.catch(19),console.log("error passport :>> ",e.t0),a(e.t0);case 74:case"end":return e.stop()}}),e,null,[[19,70]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),T=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,l,b,v,x,y,k,D,P,I,w,T,M,A,C,R,L,B,j,U,N,S,W,K,F,$,q;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.builderDB,o=t.db,c=t.projectId,i=t.params,l=t.environment,b=i.provider,console.log("userName",r,"password :>> ",n,"provider: >>",b),v="",e.t0=b,e.next=e.t0===h.FT.FIREBASE?7:e.t0===h.FT.XANO?9:e.t0===h.FT.BACKENDLESS?11:13;break;case 7:return v=p.pluginCode.LOGIN_WITH_FIREBASE,e.abrupt("break",14);case 9:return v=p.pluginCode.LOGIN_WITH_XANO,e.abrupt("break",14);case 11:return v=p.pluginCode.LOGIN_WITH_BACKENDLESS,e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:return e.next=16,(0,m.Z)(s,{code:v,projectId:c});case 16:if(x=e.sent){e.next=19;break}return e.abrupt("return",a({success:!1,status:401,message:"No valid provider plugin install"}));case 19:if(y=null,b!==h.FT.FIREBASE){e.next=26;break}return e.next=23,(0,h.C0)(l,x.setting,r,n);case 23:y=e.sent,e.next=36;break;case 26:if(b!==h.FT.XANO){e.next=32;break}return e.next=29,(0,h.ag)(l,x.setting,r,n);case 29:y=e.sent,e.next=36;break;case 32:if(b!==h.FT.BACKENDLESS){e.next=36;break}return e.next=35,(0,h.tW)(l,x.setting,r,n);case 35:y=e.sent;case 36:if(console.log("authFirebase :>> ",y),D=(k=y).success,P=k.data,D){e.next=40;break}return e.abrupt("return",a(y));case 40:return I="",w="",T={},b===h.FT.FIREBASE?(M=P.idToken,A=P.email,C=P.refreshToken,R=P.expiresIn,L=P.localId,I=A,w=L,T={token:M,refreshToken:C,expiresIn:R}):b===h.FT.XANO?(B=P.authToken,j=P.email,U=P.id,I=j,w=U,T={token:B}):b===h.FT.BACKENDLESS&&(N=P.ownerId,S=P.email,I=S,w=N,T={token:P["user-token"]}),W={$or:[{email:I},{userName:I}]},e.prev=45,e.next=48,(0,_.LQ)(o,d.B0,W);case 48:if(K=e.sent){e.next=56;break}return F={email:(0,g.oH)(I)?I:"",userName:I,uuid:w,password:O.string({length:10}),userRoles:"User"},console.log("newUser :>> ",F),e.next=54,(0,f.JR)(s,o,c,F);case 54:$=e.sent,K=$.data;case 56:if(console.log("user this is what looking",K),q="",!(K.userRoles&&K.userRoles.length>0)){e.next=62;break}return e.next=61,(0,_.LQ)(o,d.lc,{name:K.userRoles[0]});case 61:q=e.sent;case 62:return e.abrupt("return",a(null,E(E({user:K},T),{},{role:q?q.uuid:""})));case 65:e.prev=65,e.t1=e.catch(45),console.log("error :>> ",e.t1),a(e.t1);case 69:case"end":return e.stop()}}),e,null,[[45,65]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),M=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,l,p,f,m,b,v,h,g,y;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("authenticateUserWithExternalAPI",JSON.stringify({userName:r,password:n})),s=t.builderDB,o=t.projectId,c=t.db,i=t.params,l=t.body,p=t.projectConstants,f=t.environment,m=i.collectionItemId,e.prev=3,console.log("authenticateUserWithExternalAPI before"),e.next=7,(0,x.eD)(s,c,o,m,l,p,null,f);case 7:if(b=e.sent,console.log("response authenticateUserWithExternalAPI",b),v=b.success,h=b.responseData,v){e.next=12;break}return e.abrupt("return",a(b));case 12:if(g=h,console.log("user this is what looking authenticateUserWithExternalAPI",g),y="",!(g.userRoles&&g.userRoles.length>0)){e.next=19;break}return e.next=18,(0,_.LQ)(c,d.lc,{name:g.userRoles[0]});case 18:y=e.sent;case 19:return e.abrupt("return",a(null,{user:g,role:y?y.uuid:"",projectId:o}));case 22:e.prev=22,e.t0=e.catch(3),console.log("error authenticateUserWithExternalAPI :>> ",e.t0),a(e.t0);case 26:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),A=function(){var e=o()(u().mark((function e(t,r,n){var a,s,o,c,i,l,p,f,b,v,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("*** ***PRODUCTION *** *** jwt_payload",r),a=t.builderDB,s=t.db,o=t.projectId,c={userName:r.sub},e.next=6,(0,_.ME)(a,s,o,d.B0,null,c);case 6:return i=e.sent,l=i.data,e.next=10,(0,m.Z)(a,{code:"LOGIN",projectId:o});case 10:if(p=e.sent,f=p&&p.setting?p.setting:{},b=f.is_email_verified,v=f.is_enabled,!l){e.next=27;break}if(h="",!(l.userRoles&&l.userRoles.length>0)){e.next=18;break}return e.next=17,(0,_.LQ)(s,d.lc,{name:l.userRoles[0]});case 17:h=e.sent;case 18:if(h&&0!==h.length){e.next=20;break}return e.abrupt("return",n(null,!1,{message:"The provided role does not exist. Please verify and try again.",status:401}));case 20:if(!b||l.is_email_verified){e.next=22;break}return e.abrupt("return",n(null,!1,{message:"Please verify email first.",status:401}));case 22:if(!v||l.is_enabled){e.next=24;break}return e.abrupt("return",n(null,!1,{message:"Account is not active.",status:401}));case 24:return e.abrupt("return",n(null,E(E({},l),{},{role:h.uuid})));case 27:return e.abrupt("return",n(null,!1,{message:"Invalid Token.",status:404}));case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(0),n(e.t0);case 33:case"end":return e.stop()}}),e,null,[[0,30]])})));return function(t,r,n){return e.apply(this,arguments)}}(),C=new k(I,w),R=new k(I,T),L=new k(I,M),B=new D(E(E({},P),{},{passReqToCallback:!0}),A);l().use("login",C),l().use("auth-provider",R),l().use("external-api-login",L),l().use("jwt-login",B),l().use("jwt",new D(P,function(){var e=o()(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",r(null,t));case 4:e.prev=4,e.t0=e.catch(0),r(e.t0);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t,r){return e.apply(this,arguments)}}()));var j=function(){var e=o()(u().mark((function e(){var t,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.abrupt("return",new Promise((function(e,r){var n=t.cred||{},a=n.code,s=n.client_id,o=n.client_secret,c=n.redirect_uri;v().post("https://github.com/login/oauth/access_token",{code:a,client_id:s,client_secret:o,redirect_uri:c}).then((function(t){t=t.data;var r=new URLSearchParams(t).get("access_token");v().get("https://api.github.com/user",{headers:{Authorization:"token ".concat(r)}}).then((function(t){e(t.data)}))})).catch((function(e){r(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},1457:(e,t,r)=>{"use strict";r.d(t,{ml:()=>k,JR:()=>E,wY:()=>O,gM:()=>P,ow:()=>I});var n=r(8779),a=r.n(n),s=r(9591),o=r.n(s),c=r(1307),u=r.n(c),i=r(7060);const l=require("unique-username-generator");var p=r(2826),_=r(8194),d=r(5828),f=r(177),m=r(7079),b=r(8027),v=r(6517);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y=new(r(306)),E=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.n6)(t,n,f.B0);case 2:if(s=e.sent,console.log("collectionData saveUser",s),s){e.next=6;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 6:return I(s,a),a.password=a.password?a.password:y.string({length:10}),console.log("==> saveUser userData :>> ",a),e.next=11,(0,_.Nq)(r,s,a,null,!1);case 11:if(o=e.sent,console.log("errorJson saveUser",o),0===Object.keys(o).length){e.next=18;break}if(!o.field){e.next=16;break}return e.abrupt("return",{code:409,message:"Validation Failed",data:o.field});case 16:e.next=40;break;case 18:return e.next=20,(0,_.oq)(t,r,n,s,a);case 20:return a=e.sent,e.next=23,(0,_.ny)(t,r,n,s,a);case 23:return a=e.sent,e.next=26,(0,_.CH)(s,a);case 26:return a=e.sent,e.next=29,(0,_.nc)(s,a);case 29:return(a=e.sent).createdAt=new Date,a.updatedAt=new Date,a.uuid=(0,d.v4)(),e.next=35,r.collection(f.B0);case 35:return c=e.sent,e.next=38,c.insertOne(a);case 38:return i=e.sent,e.abrupt("return",{code:201,message:"Item Created Successfully",data:i?i.ops[0]:{}});case 40:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),O=function(){var e=o()(u().mark((function e(t,r,n,a,s,o){var c,i,l,b,h,g,E,O,k,P,w,T,M,A,C,R,L,B,j,U;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.n6)(t,n,f.B0);case 2:if(c=e.sent){e.next=5;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 5:return I(c,a),a.password=a.password?a.password:y.string({length:10}),console.log("==> saveUserWithProvider userData :>> ",a),e.next=10,(0,_.Nq)(r,c,a,null,!1);case 10:if(i=e.sent,console.log("errorJson",i),0===Object.keys(i).length||!i.field){e.next=14;break}return e.abrupt("return",{code:409,message:"Validation Failed",data:i.field});case 14:if(l="",!(a.userRoles&&a.userRoles.length>0)){e.next=22;break}return console.log("==> saveUserWithProvider userData.userRoles :>> ",a.userRoles),console.log("==> saveUserWithProvider isArray(userData.userRoles) :>> ",(0,v.isArray)(a.userRoles)),b=(0,v.isArray)(a.userRoles)?a.userRoles[0]:a.userRoles,e.next=21,(0,_.LQ)(r,f.lc,{name:b});case 21:l=e.sent;case 22:if(console.log("==> saveUserWithProvider userData role :>> ",l),l&&0!==l.length){e.next=25;break}return e.abrupt("return",{code:409,message:"Validation Failed",data:"The provided role does not exist. Please verify and try again."});case 25:if(h={},g="",!s){e.next=37;break}return e.next=30,D(t,n,s,a,o);case 30:if((E=e.sent).success){e.next=34;break}return console.log("Sending Sending"),e.abrupt("return",{code:E.status,message:E.message,data:E.message});case 34:s===m.FT.FIREBASE?(O=E.data,k=O.localId,P=O.idToken,h={idToken:P},g=k):s===m.FT.XANO?(w=E.data,T=w.authToken,M=w.id,A=w.name,h={authToken:T},A&&(h=x(x({},h),{},{name:A})),g=M):s===m.FT.BACKENDLESS&&(C=E.data,R=C.authToken,L=C.ownerId,B=C.name,h={authToken:R},B&&(h=x(x({},h),{},{name:B})),g=L),e.next=38;break;case 37:g=(0,d.v4)();case 38:return e.next=40,(0,_.oq)(t,r,n,c,a);case 40:return a=e.sent,e.next=43,(0,_.ny)(t,r,n,c,a);case 43:return a=e.sent,e.next=46,(0,_.CH)(c,a);case 46:return a=e.sent,e.next=49,(0,_.nc)(c,a);case 49:return(a=e.sent).createdAt=new Date,a.updatedAt=new Date,a.uuid=g,a=x(x({},a),h),console.log("userData",a),e.next=57,r.collection(f.B0);case 57:return j=e.sent,e.next=60,j.insertOne(a);case 60:return U=e.sent,e.abrupt("return",{code:201,message:"Item Created Successfully",data:U?U.ops[0]:{}});case 62:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),k=function(){var e=o()(u().mark((function e(t,r,n,a){var s,o,c,i,m,b,h,g;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.n6)(t,n,f.B0);case 2:if(s=e.sent){e.next=5;break}return e.abrupt("return",{code:404,data:"Collection not found with provided name"});case 5:return a.userName&&"anonymous-user-login"!==a.userName||(a.userName=(0,l.generateUsername)("",4)),I(s,a),a.password=a.password?a.password:y.string({length:10}),console.log("==> saveAnonymousUser userData :>> ",a),e.next=11,(0,_.Nq)(r,s,a,null,!1);case 11:if(o=e.sent,console.log("errorJson",o),0===Object.keys(o).length||!o.field){e.next=15;break}return e.abrupt("return",{code:409,message:"Validation Failed",data:o.field});case 15:if(c="",!(a.userRoles&&a.userRoles.length>0)){e.next=23;break}return console.log("==> saveAnonymousUser userData.userRoles :>> ",a.userRoles),console.log("==> saveAnonymousUser isArray :>> ",(0,v.isArray)(a.userRoles)),i=(0,v.isArray)(a.userRoles)?a.userRoles[0]:a.userRoles,e.next=22,(0,_.LQ)(r,f.lc,{name:i});case 22:c=e.sent;case 23:if(console.log("==> saveUserWithProvider userData role :>> ",c),c&&0!==c.length){e.next=26;break}return e.abrupt("return",{code:409,message:"Validation Failed",data:"The provided role does not exist. Please verify and try again."});case 26:return m={},b=(0,d.v4)(),e.next=30,(0,_.oq)(t,r,n,s,a);case 30:return a=e.sent,e.next=33,(0,_.ny)(t,r,n,s,a);case 33:return a=e.sent,e.next=36,(0,_.CH)(s,a);case 36:return a=e.sent,e.next=39,(0,_.nc)(s,a);case 39:return(a=e.sent).createdAt=new Date,a.updatedAt=new Date,a.uuid=b,a=x(x({},a),m),console.log("userData",a),e.next=47,r.collection(f.B0);case 47:return h=e.sent,e.next=50,h.insertOne(a);case 50:return g=e.sent,e.abrupt("return",{code:201,message:"Item Created Successfully",data:g?g.ops[0]:{}});case 52:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),D=function(){var e=o()(u().mark((function e(t,r,n,a,s){var o,c,l,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=null,c=null,l="",e.t0=n,e.next=e.t0===m.FT.FIREBASE?6:e.t0===m.FT.XANO?8:e.t0===m.FT.BACKENDLESS?10:12;break;case 6:return l=i.pluginCode.LOGIN_WITH_FIREBASE,e.abrupt("break",14);case 8:return l=i.pluginCode.LOGIN_WITH_XANO,e.abrupt("break",14);case 10:return l=i.pluginCode.LOGIN_WITH_BACKENDLESS,e.abrupt("break",14);case 12:return l="",e.abrupt("break",14);case 14:if(l){e.next=16;break}return e.abrupt("return",{success:!1,status:405,message:"No provider found"});case 16:return e.next=18,(0,b.Z)(t,{code:l,projectId:r});case 18:if(p=e.sent){e.next=21;break}return e.abrupt("return",{success:!1,status:405,message:"Provider Plugin is not installed"});case 21:if(n!==m.FT.FIREBASE){e.next=28;break}return o={email:a.userName,password:a.password,returnSecureToken:!0},e.next=25,(0,m.US)(s,p.setting,o);case 25:c=e.sent,e.next=40;break;case 28:if(n!==m.FT.XANO){e.next=35;break}return o={email:a.userName,password:a.password},e.next=32,(0,m.Ct)(s,p.setting,o);case 32:c=e.sent,e.next=40;break;case 35:if(n!==m.FT.BACKENDLESS){e.next=40;break}return o={email:a.userName,password:a.password},e.next=39,(0,m.l5)(s,p.setting,o);case 39:c=e.sent;case 40:return e.abrupt("return",c);case 41:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),P=function(){var e=o()(u().mark((function e(t,r,n){var a,s,o,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete r.password,r.updatedAt=new Date,a={uuid:n},s={$set:r},e.next=6,t.collection(f.B0);case 6:return o=e.sent,e.next=9,o.findOneAndUpdate(a,s,{new:!0});case 9:if((c=e.sent)&&(!c.lastErrorObject||c.lastErrorObject.updatedExisting)){e.next=12;break}return e.abrupt("return",{code:404,message:"Item not found with provided id",data:{}});case 12:return r.uuid=n,e.abrupt("return",{code:200,message:"Item Updated Successfully",data:r});case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),I=function(e,t){var r,n=(e||"").fields,a=n?n.filter((function(e){return e.required})):[],s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw s}}}}(a);try{for(s.s();!(r=s.n()).done;){var o=r.value;if(!t["".concat(o.fieldName)])if(console.log("==> validateUserData field is required :>> ",o.fieldTitle.en),"userName"===o.fieldName){if(t&&t.email&&!t.userName){var c=t.email;t.email.includes("@")&&(c=t.email.split("@")[0]),t.userName=c}}else if("email"===o.fieldName&&t&&t.userName&&!t.email){var u=t.userName;t.userName.includes("@")||(u+="@email.com"),t.email=u}}}catch(e){s.e(e)}finally{s.f()}}},1421:(e,t,r)=>{"use strict";r.d(t,{ML:()=>p,NJ:()=>m,Nw:()=>g,O_:()=>v,UG:()=>x,Yw:()=>E,j8:()=>f,kw:()=>d,mh:()=>b,nN:()=>k,ok:()=>_,z4:()=>y,zv:()=>h});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(2167),u=r.n(c),i=r(6540),l="http://localhost:5000/api/",p=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"projects/").concat(t),e.next=3,O(r,t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"pages/builder/").concat(t,"/project"),e.next=3,O(r,t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"plugins/"),e.next=3,O(r,t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"collections/").concat(t,"/project/all"),e.next=3,O(r,t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"projects/").concat(t,"/snippets"),e.next=3,O(r,t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"projects/").concat(t,"/templates"),e.next=3,O(r,t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"events/all/project"),e.next=3,O(r,t);case 3:if((n=e.sent)&&"undefined"!==n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"external-api/all/project"),e.next=3,O(r,t);case 3:if((n=e.sent)&&"undefined"!==n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"webhooks/all/project"),e.next=3,O(r,t);case 3:if((n=e.sent)&&"undefined"!==n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"data-connector/all/project"),e.next=3,O(r,t);case 3:if((n=e.sent)&&"undefined"!==n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"conditions/all/project"),e.next=3,O(r,t);case 3:if((n=e.sent)&&"undefined"!==n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=a()(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(l,"localization"),e.next=3,O(r,t);case 3:if((n=e.sent)&&"undefined"!==n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=a()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.Z.info("Sending Request to ".concat(t)),n={headers:{"Content-Type":"application/json","x-project-id":r}},e.prev=2,e.next=5,u().get(t,n);case 5:return a=e.sent,e.abrupt("return",a.data);case 9:return e.prev=9,e.t0=e.catch(2),console.log("error makeGetApiCall :>> ",e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=a()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{"Content-Type":"application/json"}},e.prev=1,e.next=4,u().post(t,r,n);case 4:return a=e.sent,e.abrupt("return",a.data);case 8:return e.prev=8,e.t0=e.catch(1),console.log("error makePostApiCall :>> ",e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()},1359:(e,t,r)=>{"use strict";r.d(t,{$F:()=>m,AP:()=>D,AR:()=>k,BP:()=>b,ET:()=>E,T3:()=>d,Tr:()=>x,UR:()=>g,c3:()=>h,gS:()=>y,gW:()=>v,uC:()=>f,x4:()=>w,xv:()=>O});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(1421),u=r(1185),i=r.n(u),l=r(6540),p="localhost",_="27017";p=p||"localhost",_=_||27017;var d=function(){var e=a()(o().mark((function e(t,r){var n,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("projects"),e.next=3,n.findOne(r);case 3:if(!(a=e.sent)){e.next=6;break}return e.abrupt("return",a);case 6:return l.Z.info("query findProjectByQuery :>>  ".concat(r)),s="".concat("http://localhost:5000/api/","projects/query/exchange"),e.next=10,(0,c.nN)(s,r);case 10:if(!(u=e.sent)){e.next=25;break}return e.next=14,n.deleteOne({uuid:u.uuid});case 14:return e.prev=14,e.next=17,n.insertOne(u);case 17:case 25:return e.abrupt("return",u);case 20:return e.prev=20,e.t0=e.catch(14),console.log("error :>> ",e.t0),console.log("Failed to save project in project_detail db"),e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=a()(o().mark((function e(t,r){var n,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"projects");case 2:return e.next=4,(0,c.ML)(r);case 4:if(!(n=e.sent)){e.next=21;break}return e.next=8,T(p,"project_detail",_);case 8:return a=e.sent,s={uuid:r},e.next=12,d(a,s);case 12:if(!e.sent){e.next=17;break}return u=a.collection("projects"),e.next=17,u.deleteOne(s);case 17:return a.close(),n.apiDomainName&&"undefined"!==n.apiDomainName&&"null"!==n.apiDomainName||(n.apiDomainName=""),e.next=21,P(t,"projects",n,!1);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"collections");case 2:return e.next=4,(0,c.j8)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=8;break}return e.next=8,P(t,"collections",n,!0);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"conditions");case 2:return e.next=4,(0,c.z4)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=9;break}return e.next=8,P(t,"conditions",n,!0);case 8:return e.abrupt("return",n);case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"events");case 2:return e.next=4,(0,c.O_)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=9;break}return e.next=8,P(t,"events",n,!0);case 8:return e.abrupt("return",n);case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"dataconnectors");case 2:return e.next=4,I(t,"datasources");case 4:return e.next=6,(0,c.UG)(r);case 6:if(!((n=e.sent)&&n.length>0)){e.next=11;break}return e.next=10,P(t,"datasources",n,!0);case 10:return e.abrupt("return",n);case 11:return e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"externalapis");case 2:return e.next=4,(0,c.zv)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=9;break}return e.next=8,P(t,"externalapis",n,!0);case 8:return e.abrupt("return",n);case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"webhooks");case 2:return e.next=4,(0,c.Nw)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=9;break}return e.next=8,P(t,"webhooks",n,!0);case 8:return e.abrupt("return",n);case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"pages");case 2:return e.next=4,(0,c.ok)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=8;break}return e.next=8,P(t,"pages",n,!0);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"localization");case 2:return e.next=4,(0,c.Yw)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=8;break}return e.next=8,P(t,"localization",n,!0);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),O=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"plugins");case 2:return e.next=4,(0,c.kw)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=8;break}return e.next=8,P(t,"plugins",n,!0);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"templates");case 2:return e.next=4,(0,c.mh)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=8;break}return e.next=8,P(t,"templates",n,!0);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),D=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,"snippets");case 2:return e.next=4,(0,c.NJ)(r);case 4:if(!((n=e.sent)&&n.length>0)){e.next=8;break}return e.next=8,P(t,"snippets",n,!0);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),P=function(){var e=a()(o().mark((function e(t,r,n,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.collection(r),!a){e.next=7;break}return e.next=5,s.insertMany(n);case 5:e.next=9;break;case 7:return e.next=9,s.insertOne(n);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log("error saveDataInDB :>> ",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),I=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.collection(r);case 3:return n=e.sent,e.next=6,n.drop();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),l.Z.error("error clearDataInDB :>> ".concat(e.t0),{label:r});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=a()(o().mark((function e(t,r,n){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={uuid:t.projectId},e.next=4,d(t.builderDB,a);case 4:s=e.sent,r.status(200).send(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),T=function(){var e=a()(o().mark((function e(t,r){var n,a,s,c,u,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>2&&void 0!==l[2]?l[2]:27017,a=l.length>3&&void 0!==l[3]?l[3]:"",s=l.length>4&&void 0!==l[4]?l[4]:"",c="mongodb://".concat(t,":").concat(n),a&&(c="mongodb://".concat(a,":").concat(s,"@").concat(t,":").concat(n)),e.next=7,i().createConnection(c,{autoIndex:!1,maxPoolSize:1e3,socketTimeoutMS:45e3,dbName:r,useNewUrlParser:!0});case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},6268:(e,t,r)=>{"use strict";r.d(t,{r:()=>Z});var n=r(9293),a=r.n(n),s=r(8779),o=r.n(s),c=r(9591),u=r.n(c),i=r(1307),l=r.n(i),p=r(7060),_=r(4945),d=r(5828),f=r(2245),m=r.n(f),b=r(6517),v=r.n(b),h=r(2826),g=r(8194),x=r(5147),y=r(6540);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k=_.FieldTypes.text,D=_.FieldTypes.large_text,P=_.FieldTypes.number,I=_.FieldTypes.password,w=_.FieldTypes.color,T=_.FieldTypes.video_link,M=_.FieldTypes.url,A=_.FieldTypes.tel,C=_.FieldTypes.email,R=_.FieldTypes.boolean,L=_.FieldTypes.uuid,B=_.FieldTypes.static_option,j=_.FieldTypes.dynamic_option,U=_.FieldTypes.reference,N=_.FieldTypes.date,S=_.FieldTypes.belongsTo,W=_.FieldTypes.file,K=_.FieldTypes.custom_uuid,F=function(){var e=u()(l().mark((function e(t,r,n,s,c,i){var p,d,f,b,h,x,y,E,O,F,$,q,G,J,Z,H,z,V,Q=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=Q.length>6&&void 0!==Q[6]?Q[6]:{},d=Q.length>7?Q[7]:void 0,f=Q.length>8&&void 0!==Q[8]?Q[8]:{},(b=s[n])&&"undefined"!==b&&0!==Object.keys(b).length){e.next=6;break}return e.abrupt("return",v().get(t,r));case 6:if(h=b.type,x=b.extraFieldSetting,y=b.validation,E=b.refCollection,![k.id,D.id,P.id,I.id,w.id,T.id,M.id,A.id,C.id,R.id,L.id,K.id].includes(h)){e.next=13;break}if(!r.includes("current_session.")){e.next=12;break}return r=r.replace("current_session.",""),console.log("dataSourceItemKey current_session",r),e.abrupt("return",v().get(f,r));case 12:case 44:return e.abrupt("return",v().get(t,r));case 13:if(B.id!==h&&j.id!==h){e.next=15;break}return e.abrupt("return",(0,_.getItemDataForArrayFields)(t,r));case 15:if(U.id!==h){e.next=24;break}if(O=(0,_.getItemDataForArrayFields)(t,r),F=p[n].refCollectionField){e.next=20;break}return e.abrupt("return",O);case 20:return e.next=22,Promise.all(O.map(function(){var e=u()(l().mark((function e(t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.LQ)(i,E.collectionName,o()({},F,{$eq:t}));case 2:return r=e.sent,e.abrupt("return",r?r.uuid:"");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 22:return $=e.sent,e.abrupt("return",$);case 24:if(S.id!==h){e.next=34;break}if(q=(q=v().get(t,r))?Array.isArray(q)?q[0]:q:"",(G=p[n].refCollectionField)&&q){e.next=30;break}return e.abrupt("return",q);case 30:return e.next=32,(0,g.NL)(i,E.collectionName,o()({},G,{$eq:q}),E.parentCollectionField,d);case 32:return J=e.sent,e.abrupt("return",J&&J.value?J.value.uuid:"");case 34:if(N.id!==h){e.next=37;break}return Z=v().get(t,r),e.abrupt("return",Z?x&&"date"===x.dateDisplayType?m()(Z).format("YYYY-MM-DD"):m().utc(Z).format():"");case 37:if(W.id!==h){e.next=44;break}if(H=v().get(t,r),!((z=H?Array.isArray(H)?H.length>0&&"object"===a()(H[0])?H.map((function(e){return e.url})):H:[H]:[]).length<1)){e.next=42;break}return e.abrupt("return","");case 42:return V=(0,_.getFileObjectList)(z,c),e.abrupt("return",y.noAllowedFiles&&1===y.noAllowedFiles?V[0]:V);case 45:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o){return e.apply(this,arguments)}}(),$=function(){var e=u()(l().mark((function e(){var t,r,n,a,s,o,c,i,p,f,m,b,v,h,g=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(h in t=g.length>0&&void 0!==g[0]?g[0]:[],r=g.length>1&&void 0!==g[1]?g[1]:{},a=g.length>3&&void 0!==g[3]?g[3]:{},s=g.length>4?g[4]:void 0,o=g.length>5?g[5]:void 0,c=g.length>6?g[6]:void 0,i=g.length>7?g[7]:void 0,p=g.length>8?g[8]:void 0,f=g.length>9&&void 0!==g[9]?g[9]:{},m=g.length>10&&void 0!==g[10]?g[10]:{},b=[],v={},n=g.length>2?g[2]:void 0)v[h]={};return e.next=16,Promise.all(t.map(function(){var e=u()(l().mark((function e(t){var h,g,x,y,E,k;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=null,!(Object.keys(n).length>0)){e.next=6;break}return g=(0,_.getPrimaryFieldNameOfDataSource)(p),e.next=5,q(c,o,t,n,s,p,g,v,m);case 5:h=e.sent;case 6:return x={},y=!0,E=(0,d.v4)(),p===_.AIRTABLE&&(E=t._airtableRecordId),e.next=12,Promise.all(Object.keys(r).map(function(){var e=u()(l().mark((function e(n){var s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=(0,_.getMappingObjKey)(r,n))){e.next=6;break}return e.next=4,F(t,s,n,a,o,c,r,E,m);case 4:x[n]=e.sent,y=!1;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:for(k in h)x[k]=Array.isArray(h[k])?h[k]:[h[k]];y||(x.createdAt=new Date,x.updatedAt=new Date,x.uuid=t.uuid?t.uuid:E),x=O(O(O({},x),i),f),b.push(x);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:return e.abrupt("return",b);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u){var i,p,_,d,f,m,b,v,h,g,x,y,E,O,k,D,P=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=P.length>8&&void 0!==P[8]?P[8]:{},p={},e.t0=l().keys(a);case 3:if((e.t1=e.t0()).done){e.next=29;break}if(_=e.t1.value,d=a[_],!(Object.keys(d).length>0)){e.next=27;break}f=Object.keys(d)[0].split(".")[0],m=s[_],b={},v=m.fields,h=m.collectionName,g=l().mark((function e(t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=t.replace("".concat(_,"."),""),(r=v.find((function(e){return e.fieldName===t})))&&(b[r.fieldName]=r);case 3:case"end":return e.stop()}}),e)})),e.t2=l().keys(d);case 13:if((e.t3=e.t2()).done){e.next=18;break}return x=e.t3.value,e.delegateYield(g(x),"t4",16);case 16:e.next=13;break;case 18:for(O in y=n[d["".concat(f,".itemsPath")]],E={},d)O!=="".concat(f,".itemsPath")&&((k=d[O].split(".")).shift(),E[O.split(".")[1]]=k.join("."));if(!y){e.next=27;break}return Array.isArray(y)||(y=[y]),e.next=25,G(t,r,o,y,E,b,h,_,c,u,i);case 25:D=e.sent,p[_]=D;case 27:e.next=3;break;case 29:return e.abrupt("return",p);case 30:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u){return e.apply(this,arguments)}}(),G=function(){var e=u()(l().mark((function e(t,r,n){var a,s,o,c,i,p,f,m,b,v=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:[],s=v.length>4?v[4]:void 0,o=v.length>5?v[5]:void 0,c=v.length>6?v[6]:void 0,i=v.length>8?v[8]:void 0,p=v.length>10&&void 0!==v[10]?v[10]:{},f=[],m=(v.length>9?v[9]:void 0)[v.length>7?v[7]:void 0],e.next=12,Promise.all(a.map(function(){var e=u()(l().mark((function e(a){var c,b,v;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={},b=!0,e.next=4,Promise.all(Object.keys(s).map(function(){var e=u()(l().mark((function e(n){var u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(u=(0,_.getMappingObjKey)(s,n))){e.next=6;break}return e.next=4,F(a,u,n,o,r,t,s,v,p);case 4:c[n]=e.sent,b=!1;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:m[c[i]]?v=m[c[i]]:(v=(0,d.v4)(),n===_.AIRTABLE&&(v=a._airtableRecordId),m[c[i]]=v),b||(c.createdAt=new Date,c.updatedAt=new Date,c.uuid=a.uuid?a.uuid:v),f.push(c);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:return e.next=14,(0,g.K5)(t,{collectionName:c,connectorType:n,customPrimaryKey:""},f);case 14:return b=e.sent,e.abrupt("return",b.itemsUuid);case 16:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),J=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u){var i,p,_,d,f=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.length>8&&void 0!==f[8]?f[8]:{},p=f.length>9&&void 0!==f[9]?f[9]:{},_=f.length>10&&void 0!==f[10]?f[10]:{},t||i){e.next=5;break}return e.abrupt("return");case 5:return Array.isArray(t)||(t=[t]),e.next=8,$(t,r,n,a,s,o,c,p,u,_,i);case 8:return d=e.sent,e.abrupt("return",d.filter((function(e){return 0!==Object.keys(e).length})));case 10:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u){return e.apply(this,arguments)}}(),Z=function(){var e=u()(l().mark((function e(t,r,n,a,s,o,c,u,i,_){var d,f,m,b,x,E,O,k,D,P,I,w,T,M,A,C=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=C.length>10&&void 0!==C[10]?C[10]:"",f=C.length>11&&void 0!==C[11]?C[11]:{},e.prev=2,e.next=5,(0,h.iK)(t,{collectionName:a,projectId:c});case 5:if(m=e.sent){e.next=8;break}return e.abrupt("return");case 8:if(b=m.fields,x=b.filter((function(e){return e.type===U.id})),E={},O={},k={},!(x&&x.length>0)){e.next=24;break}if(x.forEach((function(e){var t={};Object.keys(o).forEach((function(r){r.includes("".concat(e.fieldName,"."))&&(t[r]=o[r],delete o[r])})),E[e.fieldName]=e.refCollection.collectionName,O[e.fieldName]=t})),!(Object.keys(O).length>0)){e.next=24;break}e.t0=l().keys(O);case 17:if((e.t1=e.t0()).done){e.next=24;break}return D=e.t1.value,e.next=21,(0,h.iK)(t,{collectionName:E[D],projectId:c});case 21:k[D]=e.sent,e.next=17;break;case 24:P={},I={},w=l().mark((function e(t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=b.find((function(e){return e.fieldName===t})))&&(P[r.fieldName]=r);case 2:case"end":return e.stop()}}),e)})),e.t2=l().keys(o);case 28:if((e.t3=e.t2()).done){e.next=33;break}return T=e.t3.value,e.delegateYield(w(T),"t4",31);case 31:e.next=28;break;case 33:if(y.Z.info("itemsPath: ".concat(u),{label:"EXTERNAL_API"}),u&&(i=v().get(i,u)),!i){e.next=46;break}return i=(0,p.restructureData)(i),e.next=39,J(i,o,O,P,k,c,r,s,_,I,f);case 39:return M=e.sent,e.next=42,H(r,c,a,k,M);case 42:return e.next=44,(0,g.K5)(r,{collectionName:a,connectorType:s,customPrimaryKey:d},M);case 44:return A=e.sent,e.abrupt("return",A);case 46:e.next=51;break;case 48:e.prev=48,e.t5=e.catch(2),console.log(e.t5);case 51:case"end":return e.stop()}}),e,null,[[2,48]])})));return function(t,r,n,a,s,o,c,u,i,l){return e.apply(this,arguments)}}(),H=function(){var e=u()(l().mark((function e(t,r,n,a,s){var o,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("replacedData",s),console.log("mainCollectionName",n),o=l().mark((function e(r){var o,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a[r].fields,c=o.find((function(e){var t,r;return console.log("field?.refCollection?.collectionName",null==e||null===(t=e.refCollection)||void 0===t?void 0:t.collectionName),(null==e||null===(r=e.refCollection)||void 0===r?void 0:r.collectionName)===n})),console.log("field",c),!c){e.next=6;break}return e.next=6,Promise.all(s.map(function(){var e=u()(l().mark((function e(n){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n[r],console.log("refItemUuids",a),!(a&&"undefined"!==a&&a.length>0)){e.next=5;break}return e.next=5,(0,x.C2)(t,r,{fieldName:c.fieldName,finderItemUuids:a,isMultiSelect:c.isMultiSelect,refItemUuid:n.uuid});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e)})),e.t0=l().keys(a);case 4:if((e.t1=e.t0()).done){e.next=9;break}return c=e.t1.value,e.delegateYield(o(c),"t2",7);case 7:e.next=4;break;case 9:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}()},1186:(e,t,r)=>{"use strict";r.r(t);const n=require("cors");var a=r.n(n);const s=require("express");var o=r.n(s),c=r(1185),u=r.n(c);const i=require("body-parser");var l=r.n(i);const p=require("response-time");var _=r.n(p);const d=require("compression");var f=r.n(d);const m=require("swagger-ui-express");var b=r.n(m);const v=require("swagger-jsdoc");var h=r.n(v),g=r(7060),x=r(9591),y=r.n(x),E=r(1307),O=r.n(E),k=r(2826),D=r(8194),P=r(7714),I=r(8779),w=r.n(I),T=r(3790);function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){w()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C=new(r.n(T)()),R=function(e){var t,r;return{userName:e?null===(t=e.data)||void 0===t?void 0:t.userName:"",user_uuid:e?null===(r=e.data)||void 0===r?void 0:r.uuid:""}},L=function(){var e=y()(O().mark((function e(t,r,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r.toString().toLowerCase(),e.next=3,t.collection(r).findOne({uuid:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),B=function(e,t,r,n,a,s){var o=function(){var o=y()(O().mark((function o(){var c,u,i;return O().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=R(e),o.next=3,C.parse(r);case 3:return u=o.sent,i=A(A({},c),{},{ip:t||null,browser:u||{},createdAt:new Date,previos:n,current:a,action:s}),o.abrupt("return",i);case 6:case"end":return o.stop()}}),o)})));return function(){return o.apply(this,arguments)}}();o()},j=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.params,o=t.db,c=t.body,u=t.user,i=t.projectId,l=t.ip,p=s.constructorId,_=s.collectionName,d=s.survey,f=!!d&&"survey"===d,e.prev=3,!(f&&c.answers&&c.answers.length)){e.next=16;break}return m=null,b=[],e.next=9,Promise.all(c.answers.map(function(){var e=y()(O().mark((function e(r){var n,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=6;break}return n={batch_id:c.batch_id,questionnaire_survey:c.questionnaire_survey,question:r.question,answer:r.answer},e.next=4,(0,D.OK)(a,o,i,_,n,p,u,t.headers);case 4:201===(s=e.sent).code?b[r.question]=s.data:m=s;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:if(!m){e.next=13;break}return e.abrupt("return",r.status(m.code).send(m.data));case 13:return e.abrupt("return",r.status(200).send(b));case 14:e.next=21;break;case 16:return e.next=18,(0,D.OK)(a,o,i,_,c,p,u,t.headers);case 18:return v=e.sent,B(u,l,t.headers["user-agent"],{},v.data,"create"),e.abrupt("return",r.status(v.code).send(v.data));case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),n(e.t0);case 26:case"end":return e.stop()}}),e,null,[[3,23]])})));return function(t,r,n){return e.apply(this,arguments)}}(),U=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.params,o=t.db,c=t.body,u=t.user,i=t.projectId,l=s.collectionName,e.prev=2,e.next=5,(0,D.Ji)(a,o,i,l,u,c);case 5:if(200!==(p=e.sent).status){e.next=10;break}r.status(p.status).json({insertedCount:p.data.insertedCount,errors:p.errors}),e.next=15;break;case 10:if(404!==p.status){e.next=14;break}return e.abrupt("return",r.status(p.status).json({message:p.msg}));case 14:return e.abrupt("return",r.status(p.status).json({message:p.msg,errors:p.errors}));case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),n(e.t0);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t,r,n){return e.apply(this,arguments)}}(),N=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.params,o=t.db,c=t.body,u=t.user,i=t.projectId,l=t.ip,p=s.collectionName,_=s.itemId,e.prev=2,e.next=5,L(o,p,_);case 5:return d=e.sent,e.next=8,(0,D.ks)(a,o,i,p,_,c,u,t.headers);case 8:return f=e.sent,B(u,l,t.headers["user-agent"],d,{uuid:_},"update"),e.abrupt("return",r.status(f.code).send(f.data));case 13:e.prev=13,e.t0=e.catch(2),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),S=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.params,o=t.db,c=t.body,u=t.user,i=t.projectId,l=s.collectionName,e.prev=2,p=c.selectedItemsIds,_=p?p.split(","):[],d=null,f={},!(_.length>0)){e.next=10;break}return e.next=10,Promise.all(_.map(function(){var e=y()(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=5;break}return e.next=3,(0,D.ks)(a,o,i,l,t,c,u);case 3:200===(r=e.sent).code?f[t]=r.data:d=r;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:if(!d){e.next=14;break}return e.abrupt("return",r.status(d.code).send(d.data));case 14:return e.abrupt("return",r.status(200).send(f));case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),n(e.t0);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t,r,n){return e.apply(this,arguments)}}(),W=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.params,o=t.db,c=t.body,u=t.user,i=t.projectId,l=s.collectionName,p=s.itemId,_=s.collectionFieldId,e.prev=2,e.next=5,(0,D.AZ)(a,o,i,l,p,_,c,u);case 5:return d=e.sent,e.abrupt("return",r.status(d.code).send(d.data));case 9:e.prev=9,e.t0=e.catch(2),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),K=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.db,o=t.params,c=t.body,u=t.user,i=t.projectId,l=o.collectionName,p=o.itemId,_=o.collectionFieldId,e.prev=2,e.next=5,(0,D.uM)(a,s,i,l,p,_,c,u);case 5:return d=e.sent,e.abrupt("return",r.status(d.code).send(d.data));case 9:e.prev=9,e.t0=e.catch(2),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),F=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,u=t.ip,i=t.user,l=o.itemId,p=o.collectionName,e.next=5,(0,k.n6)(a,c,p);case 5:if(e.sent){e.next=8;break}return e.abrupt("return",r.status(404).send(P.WS));case 8:return e.next=10,L(s,p,l);case 10:return _=e.sent,e.next=13,(0,D.Qo)(s,p,l);case 13:return d=e.sent,B(i,u,t.headers["user-agent"],_,{uuid:l},"delete"),e.abrupt("return",r.status(d.code||500).send(d));case 18:e.prev=18,e.t0=e.catch(0),n(e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,r,n){return e.apply(this,arguments)}}(),$=r(1359),q=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.body,s=t.builderDB,o=t.projectId,c=t.params.collectionName,!t.query.notEncrypt){e.next=4;break}return e.abrupt("return",n());case 4:if(!a.$set){e.next=10;break}return e.next=7,G(a.$set,s,o,c);case 7:t.body.$set=e.sent,e.next=19;break;case 10:if(!a.items){e.next=16;break}return e.next=13,G(a.items,s,o,c);case 13:t.body.items=e.sent,e.next=19;break;case 16:return e.next=18,G(a,s,o,c);case 18:t.body=e.sent;case 19:n(),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),console.log("\n Error: ",e.t0),n();case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t,r,n){return e.apply(this,arguments)}}(),G=function(){var e=y()(O().mark((function e(t,r,n,a,s){var o,c,u,i,l;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,$.T3)(r,{uuid:n});case 3:if(o=e.sent,c=o.enableEncryption,u=o.encryption,!c){e.next=14;break}return e.next=9,(0,k.GB)(r,{projectId:n,collectionName:a});case 9:return i=e.sent,l=i.fields,e.next=13,(0,g.crypt)(t,l,u,s);case 13:t=e.sent;case 14:return e.abrupt("return",t);case 17:e.prev=17,e.t0=e.catch(0),console.log("\n Error: ",e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),J=o().Router();J.post("/:collectionName/items/",g.interceptLogger,q,j),J.put("/:collectionName/items/:itemId",g.interceptLogger,q,N),J.post("/import-from-csv/:collectionName",g.interceptLogger,q,U),J.put("/:collectionName/items/bulk/update",g.interceptLogger,S),J.delete("/:collectionName/items/:itemId",g.interceptLogger,F),J.post("/:collectionName/items/constructor/:constructorId?",g.interceptLogger,q,j),J.post("/:collectionName/items/:survey/submit/constructor/:constructorId?",g.interceptLogger,q,j),J.post("/:collectionName/items/:itemId/fields/:collectionFieldId",g.interceptLogger,W),J.put("/:collectionName/items/:itemId/fields/:collectionFieldId",g.interceptLogger,K);const Z=J;var H=o().Router();H.post("/:collectionName/items",g.interceptLogger,q,j),H.post("/import-from-csv/:collectionName",g.interceptLogger,q,U),H.put("/:collectionName/items/:itemId",g.interceptLogger,q,N),H.put("/:collectionName/items/bulk/update",g.interceptLogger,S),H.delete("/:collectionName/items/:itemId",g.interceptLogger,F),H.post("/:collectionName/items/constructor/:constructorId?",g.interceptLogger,q,j),H.post("/:collectionName/items/:survey/submit/constructor/:constructorId?",g.interceptLogger,q,j),H.post("/:collectionName/items/:itemId/fields/:collectionFieldId",g.interceptLogger,W),H.put("/:collectionName/items/:itemId/fields/:collectionFieldId",g.interceptLogger,K);const z=H;var V=r(5828),Q=r(2245),X=r.n(Q),Y=r(2827),ee=r(6231),te=r(1626).stringify,re=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,u=t.body.ids||t.query.ids,e.next=5,(0,D.pb)(a,s,c,o.collectionName,u);case 5:if(i=e.sent){e.next=9;break}return r.status(200).send([]),e.abrupt("return");case 9:return e.next=11,G(i,a,c,o.collectionName,!0);case 11:return i=e.sent,e.abrupt("return",r.status(200).send(i));case 15:e.prev=15,e.t0=e.catch(0),n(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ne=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,P,I,w;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.perconaDb,c=t.params,u=t.headers,i=t.query,l=t.projectId,p=t.timezone,_=c.collectionName,d=c.filterId,f=u.authorization,e.next=6,(0,k.Jp)(a,l,_,d);case 6:if((m=e.sent)&&m.length){e.next=9;break}return e.abrupt("return",r.status(400).send("No Collection found"));case 9:return m=m[0],e.next=12,(0,D.r1)(a,s,o,l,m,d,i,f,p,u,0,1);case 12:if(b=e.sent,v=b.code,h=b.result,g=b.message,console.log("####################"),200===v){e.next=19;break}return e.abrupt("return",r.status(v).send(g));case 19:return x=(0,V.v4)(),y="/Users/vijayshukla/Downloads/",E="".concat(_,"_").concat(x,".csv"),y+=E,ee.existsSync(y)&&ee.unlinkSync(y),e.next=26,G(h,a,l,_,!0);case 26:return h=e.sent,e.next=29,(0,Y.Rh)(m,y,h);case 29:P=e.sent,I=P.finalData,w=P.headerColumns,te(I,{header:!0,columns:w},(function(e,t){r.setHeader("content-type","text/csv"),r.setHeader("content-disposition","attachment;filename=".concat(encodeURI(E))),r.status(200).end(t)})),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),n(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ae=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("******** Collection Items $$$$ ************",X().now()),a=t.builderDB,s=t.db,o=t.perconaDb,c=t.params,u=t.headers,i=t.query,l=t.projectId,p=t.timezone,_=c.collectionName,d=c.filterId,f=u.authorization,e.next=7,(0,k.Jp)(a,l,_,d);case 7:if((m=e.sent)&&m.length){e.next=10;break}return e.abrupt("return",r.status(400).send("No Collection found"));case 10:return e.next=12,(0,D.r1)(a,s,o,l,m[0],d,i,f,p,u,0,1);case 12:return b=e.sent,v=b.code,h=b.result,g=b.message,console.log("######### Collection Items ###########",X().now()),console.log("####################"),e.next=20,G(h,a,l,_,!0);case 20:return h=e.sent,x=200!=v?g:h,e.abrupt("return",r.status(v||500).send(x||[]));case 25:e.prev=25,e.t0=e.catch(0),n(e.t0);case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t,r,n){return e.apply(this,arguments)}}(),se=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.perconaDb,c=t.params,u=t.headers,i=t.query,l=t.projectId,p=t.timezone,console.log("********************"),console.log("********* Collection Items Count ***********",X().now()),console.log("timezone>>>>>>>>>>>>>>>>",p),_=c.collectionName,d=c.filterId,f=u.authorization,e.next=9,(0,k.Jp)(a,l,_,d);case 9:if((m=e.sent)&&m.length){e.next=12;break}return e.abrupt("return",r.status(200).json({code:200,message:"success",result:0,count:0}));case 12:return e.next=14,(0,D.r1)(a,s,o,l,m[0],d,i,f,p,u,1,1);case 14:b=e.sent,v=b.code,h=b.result,g=b.message,console.log("######### Collection Items Count ###########",X().now()),console.log("####################"),x=200!=v?g:h,r.status(v||500).send(x||[]),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),n(e.t0);case 27:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(t,r,n){return e.apply(this,arguments)}}(),oe=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.db,o=t.params,c=t.projectId,e.prev=1,e.next=4,(0,D.ME)(a,s,c,o.collectionName,o.itemId);case 4:if(u=e.sent){e.next=8;break}return r.status(404).send({message:"Record not found with id ".concat(t.params.itemId)}),e.abrupt("return");case 8:return e.next=10,G(u.data,a,c,o.collectionName,!0);case 10:u.data=e.sent,r.status(u.code).send(u.data),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t,r,n){return e.apply(this,arguments)}}();const ce=function(e,t,r){var n=e.projectRemoteDb,a=e.db;e.db=a||n||null,r()};var ue=o().Router();ue.get("/:collectionName/items/",g.interceptLogger,ce,re),ue.post("/:collectionName/itemList",g.interceptLogger,ce,re),ue.get("/:collectionName/item/:itemId",g.interceptLogger,ce,oe),ue.get("/:collectionName/finder/:filterId/items/",g.interceptLogger,ce,ae),ue.get("/:collectionName/finder/:filterId/items/count",g.interceptLogger,ce,se),ue.post("/:collectionName/finder/:filterId/export-data",g.interceptLogger,ce,ne);const ie=ue;var le=r(177),pe=r(3511),_e=r.n(pe),de=r(4554),fe=r(1457),me=r(7079),be=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.builderDB,o=t.body,c=t.projectId,u=t.params,i=t.environment,l=u.provider,e.next=5,(0,fe.wY)(s,a,c,o,l,i);case 5:return p=e.sent,e.abrupt("return",r.status(p.code).send(p.data));case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ve=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.builderDB,o=t.body,c=t.projectId,e.next=4,(0,fe.ml)(s,a,c,o);case 4:return u=e.sent,e.abrupt("return",r.status(u.code).send(u.data));case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),he=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.db,s=t.body,e.prev=1,o={uuid:t.user.uuid},e.next=5,(0,D.LQ)(a,le.B0,o);case 5:if(c=e.sent){e.next=8;break}return e.abrupt("return",r.status(401).json({message:"Password reset link is invalid or has expired."}));case 8:return e.next=10,(0,le.nu)(s.password);case 10:return c.password=e.sent,o={uuid:c.uuid},c._id&&delete c._id,u={$set:c},e.next=16,a.collection(le.B0);case 16:return i=e.sent,e.next=19,i.findOneAndUpdate(o,u,{new:!0});case 19:return e.abrupt("return",r.status(200).send("Password updated successfully"));case 22:e.prev=22,e.t0=e.catch(1),n(e.t0);case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ge=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.db,s=t.body,e.prev=1,o={uuid:t.user.uuid},e.next=5,(0,D.LQ)(a,le.B0,o);case 5:if(c=e.sent){e.next=8;break}return e.abrupt("return",r.status(401).json({message:"User not found!"}));case 8:return e.next=10,(0,le.mp)(s.oldPassword,c.password);case 10:if(e.sent){e.next=13;break}return e.abrupt("return",r.status(401).json({message:"Old Password does not match!"}));case 13:return e.next=15,(0,le.nu)(s.password);case 15:return c.password=e.sent,o={uuid:c.uuid},c._id&&delete c._id,u={$set:c},e.next=21,a.collection(le.B0);case 21:return i=e.sent,e.next=24,i.findOneAndUpdate(o,u,{new:!0});case 24:return e.abrupt("return",r.status(200).send("Password updated successfully!"));case 27:e.prev=27,e.t0=e.catch(1),n(e.t0);case 30:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(t,r,n){return e.apply(this,arguments)}}(),xe=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.params,s=t.projectId,o=a.provider,"",c=o?"auth-provider":"login",_e().authenticate(c,{session:!1},(function(e,n,a){return console.log("************************"),console.log("user loginUser",n,"err",e,"info",a),e?(console.log("err loginWithProvider :>> ",e),r.status(e.status).json({message:e.message})):void 0!==a?r.status(a.status||500).json({message:a.message}):void(n&&t.login(n,{session:!1},function(){var e=y()(O().mark((function e(t){var a,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("err ************ :>> ",t,n),!t){e.next=3;break}return e.abrupt("return",r.status(500).json(t));case 3:if(console.log("Final Steps after login"),a={},c=null,u=n.role,c=o?n.user:n,console.log("userDetails :>> ",c),delete c._id,delete c.createdAt,delete c.updatedAt,delete c.password,!o){e.next=17;break}o===me.FT.FIREBASE?a={auth:!0,token:n.refreshToken,expiresIn:n.expiresIn,userDetails:c,role:u,projectId:s}:(o===me.FT.XANO||o===me.FT.BACKENDLESS)&&(a={auth:!0,token:n.token,expiresIn:3600,userDetails:c,role:u,projectId:s}),e.next=22;break;case 17:return delete n.role,e.next=20,(0,de._t)(c);case 20:i=e.sent,a={auth:!0,token:i.token,expiresIn:i.expires,userDetails:c,role:u,projectId:s};case 22:return e.abrupt("return",r.status(200).json(a));case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}))(t,r,n);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),ye=function(){var e=y()(O().mark((function e(t,r,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("external-api-login going to check with passport"),_e().authenticate("external-api-login",{session:!1},(function(e,n,a){return console.log("user loginUser",JSON.stringify({user:n,err:e,info:a})),e?(console.log("err :>> ",e),r.status(e.status).json({message:e.message})):void 0!==a?r.status(a.status||500).json({message:a.message}):void(n&&t.login(n,{session:!1},function(){var e=y()(O().mark((function e(t){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("err ************ :>> ",t,n),!t){e.next=3;break}return e.abrupt("return",r.status(500).json(t));case 3:return console.log("Final Steps after login"),a={},s=n.user,o=n.role,console.log("userDetails :>> ",s),delete s._id,delete s.createdAt,delete s.updatedAt,delete s.password,delete n.role,e.next=15,(0,de._t)(s);case 15:return c=e.sent,a={auth:!0,token:c.token,expiresIn:c.expires,userDetails:s,role:o,projectId:n.projectId},console.log("finalData",a),e.abrupt("return",r.status(200).json(a));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}))(t,r,n);case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Ee=function(){var e=y()(O().mark((function e(t,r,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_e().authenticate("jwt-login",{session:!1},(function(e,n,a){return e?r.status(500).json(e):void 0!==a?r.status(a.status||500).json({message:a.message}):void(n&&t.login(n,{session:!1},function(){var e=y()(O().mark((function e(t){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",r.status(500).json(t));case 2:return delete n.password,delete n.createdAt,delete n.updatedAt,delete n._id,a=n.role,delete n.role,s=n,e.next=11,(0,de._t)(s);case 11:return o=e.sent,e.abrupt("return",r.status(200).json({auth:!0,token:o.token,expiresIn:o.expires,userDetails:s,role:a}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}))(t,r,n);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Oe=o().Router();Oe.post("/user/:provider?",g.interceptLogger,be),Oe.post("/anonymous-user",g.interceptLogger,ve),Oe.post("/login/:provider?",g.interceptLogger,xe),Oe.post("/login/otp/external-api/:collectionItemId?",g.interceptLogger,ye),Oe.post("/login-with-token",g.interceptLogger,Ee),Oe.post("/reset-password/",[g.interceptLogger,de.$v],he),Oe.post("/change-passoword/",[g.interceptLogger,de.$v],ge);const ke=Oe;var De=r(7705),Pe=r(9914),Ie=o().Router();Ie.post("/upload/:collectionId/:fieldId",ce,De.Lf),Ie.post("/multi-upload/:collectionId/:fieldId",ce,De.mh),Ie.get("/",ce,De.fo),Ie.post("/",ce,De.cn),Ie.get("/:fileId",ce,Pe.GB),Ie.post("/editor",ce,De.jJ),Ie.post("/upload/local",ce,De.M6);const we=Ie;var Te=r(5147),Me=r(6231),Ae=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.query,c=t.body,u=s.collectionName,i=o.page,l=o.size,e.next=6,(0,Te.yV)(a,u,c,i,l);case 6:if(p=e.sent){e.next=10;break}return r.status(200).send([]),e.abrupt("return");case 10:r.status(200).send(p),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ce=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.body,c=s.collectionName,e.next=5,(0,Te.mL)(a,c,o);case 5:if(u=e.sent){e.next=9;break}return r.status(200).send([]),e.abrupt("return");case 9:r.status(200).send(u),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Re=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.body,c=s.collectionName,u=o.query,i=o.parentCollectionField,l=o.itemUuid,e.next=6,(0,D.NL)(a,c,u,i,l);case 6:if(p=e.sent){e.next=10;break}return r.status(200).send([]),e.abrupt("return");case 10:r.status(200).send(p),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Le=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.body,c=s.collectionName,e.next=5,(0,Te._Z)(a,c,o);case 5:if(u=e.sent){e.next=9;break}return r.status(200).send([]),e.abrupt("return");case 9:r.status(200).send(u),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Be=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,e.next=4,(0,Te.cs)(a,s);case 4:if(o=e.sent){e.next=8;break}return r.status(200).send([]),e.abrupt("return");case 8:r.status(200).send(o),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),je=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.body,c=s.collectionName,e.next=5,(0,Te.xD)(a,c,o);case 5:u=e.sent,r.status(200).send(u),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ue=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=s.connectorData,c=s.data,e.next=5,(0,D.K5)(a,o,c);case 5:u=e.sent,r.status(200).send(u),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ne=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=s.collectionName,c=s.itemId,e.next=5,(0,Te.Pr)(a,o,c);case 5:if(u=e.sent){e.next=9;break}return r.status(404).send({message:"Record not found with id ".concat(c)}),e.abrupt("return");case 9:r.status(200).send(u),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),n(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Se=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.body,c=s.collectionName,u=s.itemId,e.next=5,(0,Te.iS)(a,c,u,o);case 5:if(i=e.sent){e.next=9;break}return r.status(404).send({message:"Record not found with id ".concat(u)}),e.abrupt("return");case 9:r.json(i),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),We=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=t.body,c=s.collectionName,u=s.itemId,e.next=5,(0,Te.XT)(a,c,u,o);case 5:if(i=e.sent){e.next=9;break}return r.status(404).send({message:"Record not found with id ".concat(u)}),e.abrupt("return");case 9:r.json(i),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ke=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=t.query,u=o.collectionName,i=c.decryptFields,e.next=6,(0,Te.Pb)(a,u,s);case 6:if(l=e.sent,!i||!l[0]){e.next=11;break}return e.next=10,G(l[0],t.builderDB,t.projectId,u,!0);case 10:l[0]=e.sent;case 11:r.json(l),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Fe=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=t.query,u=o.collectionName,i=c.decryptFields,e.next=6,(0,Te.pJ)(a,u,s);case 6:if(l=e.sent,!i||!l[0]){e.next=11;break}return e.next=10,G(l[0],t.builderDB,t.projectId,u,!0);case 10:l[0]=e.sent;case 11:r.json(l),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r,n){return e.apply(this,arguments)}}(),$e=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=s.collectionName,e.next=5,(0,Te.FP)(a,o);case 5:c=e.sent,r.json(c),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),qe=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=o.collectionName,e.next=5,(0,Te.CB)(a,c,s);case 5:u=e.sent,r.json(u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ge=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=s.collectionName,c=s.itemId,e.next=5,(0,Te.vo)(a,o,c);case 5:u=e.sent,r.json(u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Je=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=s.collectionName,e.next=5,a.dropCollection(o);case 5:r.json({msg:"Collection has been cleared"}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ze=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=o.collectionName,e.next=5,(0,Te.o5)(a,c,s);case 5:u=e.sent,r.json(u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),He=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=o.collectionName,e.next=5,(0,Te.NH)(a,c,s);case 5:u=e.sent,r.json(u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ze=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=o.collectionName,e.next=5,(0,Te.C2)(a,c,s);case 5:u=e.sent,r.json(u),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("error",e.t0),n(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ve=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,o=t.params,c=o.collectionName,e.next=5,(0,Te.F6)(a,c,s);case 5:u=e.sent,console.log("result",u),r.json(u).status(200),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),n(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Qe=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,e.next=4,(0,D.pb)(a,s,c,o.collectionName);case 4:if(u=e.sent){e.next=8;break}return r.status(200).send([]),e.abrupt("return");case 8:return e.next=10,G(u,a,c,o.collectionName,!0);case 10:u=e.sent,r.status(200).send(u),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Xe=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("***********************"),console.log("***********************"),a=t.builderDB,s=t.db,o=t.params,c=t.projectId,e.prev=3,e.next=6,(0,D.ME)(a,s,c,o.collectionName,o.itemId);case 6:if(u=e.sent){e.next=10;break}return r.status(404).send({message:"Record not found with id ".concat(o.itemId)}),e.abrupt("return");case 10:return e.next=12,G(u.data,a,c,o.collectionName,!0);case 12:u.data=e.sent,r.status(u.code).send(u.data),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n(e.t0);case 19:case"end":return e.stop()}}),e,null,[[3,16]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ye=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("******** Collection Items ************",X().now()),a=t.builderDB,s=t.db,o=t.perconaDb,c=t.params,u=t.headers,i=t.query,l=t.projectId,p=t.timezone,_=c.collectionName,d=c.finderId,f=u.authorization,e.next=7,(0,k.Jp)(a,l,_,d);case 7:if((m=e.sent)&&m.length){e.next=10;break}return e.abrupt("return",{code:200,message:"success",result:0,count:0});case 10:return e.next=12,(0,D.r1)(a,s,o,l,m[0],d,i,f,p,u,0,1);case 12:return b=e.sent,v=b.code,h=b.result,g=b.message,e.next=18,G(h,a,l,c.collectionName,!0);case 18:return h=e.sent,x=200!=v?g:h,e.abrupt("return",r.status(v||500).send(x||[]));case 23:e.prev=23,e.t0=e.catch(0),n(e.t0);case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,r,n){return e.apply(this,arguments)}}(),et=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.perconaDb,c=t.params,u=t.headers,i=t.query,l=t.projectId,p=t.timezone,_=c.collectionName,d=c.finderId,f=u.authorization,e.next=6,(0,k.Jp)(a,l,_,d);case 6:if((m=e.sent)&&m.length){e.next=9;break}return e.abrupt("return",{code:200,message:"success",result:0,count:0});case 9:return m=m[0],e.next=12,(0,D.r1)(a,s,o,l,m,d,i,f,p,u,0,1);case 12:if(b=e.sent,v=b.code,h=b.result,g=b.message,console.log("####################"),200===v){e.next=19;break}return e.abrupt("return",r.status(v).send(g));case 19:return e.next=21,G(h,a,l,c.collectionName,!0);case 21:return h=e.sent,x=(0,V.v4)(),y="/Users/vijayshukla/Downloads/",y+="".concat(_,"_").concat(x,".csv"),Me.existsSync(y)&&Me.unlinkSync(y),e.next=28,(0,Y.Rh)(m,y,h);case 28:return e.abrupt("return",r.status(200).json({msg:y}));case 31:e.prev=31,e.t0=e.catch(0),console.log("err",e.t0),n(e.t0);case 35:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,r,n){return e.apply(this,arguments)}}(),tt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,o=s.collectionName,c=s.fieldName,e.next=4,(0,Te.JB)(a,o,c);case 4:r.status(200).send({message:"".concat(c," field deleted from ").concat(o)}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r,n){return e.apply(this,arguments)}}(),rt=o().Router();rt.get("/:collectionName/collection",ce,g.interceptLogger,Qe),rt.get("/:collectionName/item/:itemId",ce,g.interceptLogger,Xe),rt.get("/builder/:collectionName/:finderId",ce,g.interceptLogger,Ye),rt.get("/builder/:collectionName/:finderId/export-data",ce,g.interceptLogger,et),rt.post("/builder/:collectionName/collection/list",ce,g.interceptLogger,Ae),rt.post("/builder/:collectionName/collection/find",ce,g.interceptLogger,Ce),rt.post("/builder/:collectionName/collection/regex",ce,g.interceptLogger,Le),rt.post("/builder/eval",ce,g.interceptLogger,Be),rt.post("/builder/:collectionName/collection",ce,g.interceptLogger,je),rt.post("/builder/bulk",ce,g.interceptLogger,Ue),rt.get("/builder/:collectionName/collection/:itemId/item",ce,g.interceptLogger,Ne),rt.put("/builder/:collectionName/collection/:itemId/item",ce,g.interceptLogger,Se),rt.put("/builder/:collectionName/collection/:itemId/item/plaid",ce,g.interceptLogger,We),rt.put("/builder/:collectionName/collection",ce,g.interceptLogger,Re),rt.post("/builder/:collectionName/collection/query",ce,g.interceptLogger,Ke),rt.post("/builder/:collectionName/collection/updated-query",ce,g.interceptLogger,Fe),rt.post("/builder/:collectionName/collection/last-record",ce,g.interceptLogger,$e),rt.post("/builder/:collectionName/collection/finder",ce,g.interceptLogger,qe),rt.delete("/builder/:collectionName/collection/:itemId/remove-item",ce,g.interceptLogger,Ge),rt.delete("/builder/:collectionName/collection/clear-collection",ce,g.interceptLogger,Je),rt.post("/builder/:collectionName/collection/remove-reference",ce,g.interceptLogger,Ze),rt.post("/builder/:collectionName/collection/add-reference",ce,g.interceptLogger,He),rt.post("/builder/:collectionName/collection/multi-add-reference",ce,g.interceptLogger,ze),rt.post("/builder/:collectionName/collection/import-from-csv",ce,g.interceptLogger,Ve),rt.delete("/builder/:collectionName/collection/:fieldName/field-record",ce,g.interceptLogger,tt);const nt=rt;var at=function(){var e=y()(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("events"),e.next=3,n.find(r).toArray();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),st=function(){var e=y()(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("events"),e.next=3,n.findOne(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),ot=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.projectId,s=t.builderDB,e.next=4,at(s,{projectId:a});case 4:o=e.sent,r.status(200).send(o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ct=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params,s=t.builderDB,e.prev=1,e.next=4,st(s,{uuid:a.eventId});case 4:return o=e.sent,e.abrupt("return",r.status(200).send(o));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",n(e.t0));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ut=o().Router();ut.get("/",g.interceptLogger,ce,ot),ut.get("/:eventId",ce,ct);const it=ut;var lt=r(6837),pt=function(){var e=y()(O().mark((function e(t,r,n){var a,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.body,e.next=4,(0,lt.Am)(a);case 4:s=e.sent,console.log("sendEmail result::",s),r.status(200).send(s),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),_t=function(){var e=y()(O().mark((function e(t,r,n){var a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,lt.BO)(t);case 3:a=e.sent,console.log("sendEmailTemplate result::",a),r.status(200).send(a),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("errror::",e.t0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),dt=function(){var e=y()(O().mark((function e(t,r,n){var a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,lt.$3)(t);case 3:a=e.sent,console.log("sendDynamicEmail result::",a),r.status(200).send(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ft=o().Router();ft.post("/send",ce,pt),ft.post("/send/:templateId",ce,_t),ft.post("/send-dynamic-mail",ce,dt);const mt=ft,bt=require("stripe");function vt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ht(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(r),!0).forEach((function(t){w()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var gt=function(){var e=y()(O().mark((function e(t,r,n,a){var s,o,c,u,i,l,p,_,d,f,m,b,v;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.productUuid,o=n.quantityField,c=n.priceField,u=n.collectionName,i=n.quantity,l=n.nameField,p=n.descriptionField,s){e.next=3;break}return e.abrupt("return",{code:200,message:"Product is Missing",status:"failed"});case 3:if(o){e.next=5;break}return e.abrupt("return",{code:200,message:"Quantity Field is Missing",status:"failed"});case 5:if(c){e.next=7;break}return e.abrupt("return",{code:200,message:"Price Field is Missing",status:"failed"});case 7:if(u){e.next=9;break}return e.abrupt("return",{code:200,message:"Collection is Missing",status:"failed"});case 9:if(i){e.next=11;break}return e.abrupt("return",{code:200,message:"Quantity is Missing",status:"failed"});case 11:if(l){e.next=13;break}return e.abrupt("return",{code:200,message:"Name Field is Missing",status:"failed"});case 13:if(p){e.next=15;break}return e.abrupt("return",{code:200,message:"Description is Missing",status:"failed"});case 15:return e.next=17,r.collection(u);case 17:return _=e.sent,e.next=20,_.findOne({uuid:s});case 20:if(d=e.sent){e.next=23;break}return e.abrupt("return",{code:200,message:"No Product found",status:"failed"});case 23:if(!(d[o]<i)){e.next=25;break}return e.abrupt("return",{code:200,message:"Product Quantity not available",status:"failed"});case 25:return f={productCollectionName:u,productQuantityField:o,productPriceField:c,productNameField:l,productDescriptionField:p,productDetail:d,price:d[c],name:d[l],description:d[p],quantity:i,totalPrice:d[c]*i,user:a?a.uuid:null,status:xt.IN_CHECKOUT,paymentFailedMessage:"",paymentId:"",paymentResponse:{},shippingAddress:"",billingAddress:"",createdAt:new Date,updatedAt:new Date,uuid:(0,V.v4)()},e.next=28,r.collection("marketplacePurchaseHistory");case 28:return m=e.sent,e.next=31,m.insertOne(f);case 31:return b=e.sent,console.log("savedProductPurchaseHistory :>> ",b.ops[0]),e.next=35,Ot(t,"MARKETPLACE_CHECKOUT");case 35:if(v=e.sent,1!==b.insertedCount){e.next=38;break}return e.abrupt("return",{code:200,status:"success",data:b.ops[0],redirectURL:v.setting.redirectURL,message:v.setting&&v.setting.message?v.setting.message:"Item Added for purchase"});case 38:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),xt={IN_CHECKOUT:"In Checkout",PAYMENT_PENDING:"Payment Pending",PAYMENT_DONE:"Payment Done",PAYMENT_CANCELLED:"Payment Cancelled",PAYMENT_FAILED:"Payment Failed",ORDER_CANCELLED_WHEN_NEW_ORDERED:"Order Cancelled when new order added"},yt=function(){var e=y()(O().mark((function e(t,r,n){var a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("marketplacePurchaseHistory");case 2:(a=e.sent).find({uuid:r},(function(e,t){t.forEach((function(e){var t={uuid:r};a.updateOne(t,{$set:ht(ht({},e),{},{sessionId:n})},{upsert:!0},(function(e,t){console.log("err addSessionToPurchaseItem :>> ",e),console.log("res :>> ",t.result)}))}))}));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Et=function(){var e=y()(O().mark((function e(t){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("marketplacePurchaseHistory");case 2:return r=e.sent,e.next=5,r.find({status:xt.IN_CHECKOUT}).toArray();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ot=function(){var e=y()(O().mark((function e(t,r){var n,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("plugins");case 2:return n=e.sent,e.next=5,n.findOne({code:r});case 5:return a=e.sent,console.log("Installed :>> ",r,a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),kt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.body,c=t.user,e.next=4,gt(a,s,o,c);case 4:u=e.sent,r.status(u.code).send(u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Dt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.environment,e.next=4,Et(s);case 4:if((c=e.sent)&&0!=c.length){e.next=7;break}return e.abrupt("return",r.json({message:"Cart is Empty"}));case 7:return e.next=9,Ot(a,"STRIPE");case 9:if(u=e.sent){e.next=12;break}return e.abrupt("return",r.json({message:"Payment Plugin not installed"}));case 12:return e.next=14,Ot(a,"MARKETPLACE_CHECKOUT");case 14:if(i=e.sent){e.next=17;break}return e.abrupt("return",r.json({message:"Marketplace Plugin not installed"}));case 17:return l=u.setting.secret_key,l=(0,P.LO)(l,o),p=new bt.Stripe(l),_=[],c.map((function(e){_.push({price_data:{currency:i.setting.currency,product_data:{name:e.name,description:e.description},unit_amount:100*e.price},quantity:e.quantity})})),console.log("JSON.stringify(lineItems) :>> ",JSON.stringify(_)),e.next=25,p.checkout.sessions.create({payment_method_types:["card"],line_items:_,mode:"payment",cancel_url:i.setting.failedURL,success_url:i.setting.successURL});case 25:d=e.sent,console.log("session :>> ",d),d&&c.map((function(e){yt(s,e.uuid,d.id)})),r.json({id:d.id}),e.next=34;break;case 31:e.prev=31,e.t0=e.catch(0),n(e.t0);case 34:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Pt=o().Router();Pt.post("/create",ce,kt),Pt.post("/process-checkout",ce,Dt);const It=Pt,wt=require("plaid");var Tt=function(){var e=y()(O().mark((function e(t,r){var n,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("plugins");case 2:return n=e.sent,e.next=5,n.findOne({code:"PLAID",projectId:r});case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Mt=function(){var e=y()(O().mark((function e(t,r,n,a,s,o,c,u){var i,l,p,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("user",a),console.log("access_token",s),console.log("item_id",o),console.log("asset_report_token",c),console.log("asset_report_id",u),o){e.next=8;break}return e.abrupt("return",{success:!1,message:"No Plaid Item ID found."});case 8:return i={plaid_item_id:o,user:{$in:[a.uuuid]}},e.next=11,r.collection("plaid_setting");case 11:return l=e.sent,e.next=14,l.findOne(i);case 14:if(!(p=e.sent)){e.next=26;break}return p.plaid_access_token=s,p.plaid_item_id=o,p.plaid_asset_report_token=c,p.plaid_asset_report_id=u,delete p.uuid,_={$set:p},e.next=24,l.findOneAndUpdate(i,_,{new:!0});case 24:return p=e.sent,e.abrupt("return",{success:!0,message:"Plaid Setting updated successfully"});case 26:return p={user:a.uuid,plaid_access_token:s,plaid_item_id:o,plaid_asset_report_token:c,plaid_asset_report_id:u},e.next=29,(0,D.OK)(t,r,n,"plaid_setting",p,"",a,{});case 29:if(400!==e.sent.code){e.next=34;break}return e.abrupt("return",{status:"failed",message:"Failed to Save"});case 34:return e.abrupt("return",{success:!0,message:"Plaid Setting created successfully"});case 35:e.next=40;break;case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",{success:!1,message:e.t0});case 40:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(t,r,n,a,s,o,c,u){return e.apply(this,arguments)}}(),At=r(6540),Ct=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.projectId,o=t.user,c=t.environment,o){e.next=3;break}return e.abrupt("return",r.status(401).send({code:403,message:"Invalid token."}));case 3:return e.prev=3,e.next=6,Tt(a,s);case 6:return u=e.sent,i=u.setting,l=i.app_name,p=i.client_id,_=i.client_secret,d=i.environment,f=i.products,m=i.country_codes,b=i.language,v=i.webhook,l=(0,P.LO)(l,c),p=(0,P.LO)(p,c),_=(0,P.LO)(_,c),d=(0,P.LO)(d,c),v=(0,P.LO)(v,c),f&&0!==f.length||(f=["transactions"]),m&&0!==m.length||(m=["US","CA"]),"",h="sandbox"===d?wt.PlaidEnvironments.sandbox:"production"===d?wt.PlaidEnvironments.production:wt.PlaidEnvironments.development,g=new wt.Configuration({basePath:h,baseOptions:{headers:{"PLAID-CLIENT-ID":p,"PLAID-SECRET":_,"Plaid-Version":"2020-09-14"}}}),x=new wt.PlaidApi(g),y={user:{client_user_id:o.uuid},client_name:l,products:f,country_codes:m,language:b||"en"},v&&(y.webhook=v),e.next=23,x.linkTokenCreate(y);case 23:E=e.sent,r.json(E.data),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),n(e.t0);case 30:case"end":return e.stop()}}),e,null,[[3,27]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Rt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,k,D,I;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.projectId,o=t.db,c=t.body,u=t.user,i=t.environment,u){e.next=3;break}return e.abrupt("return",r.status(401).send({code:403,message:"Invalid token."}));case 3:return e.prev=3,l=c.public_token,e.next=7,Tt(a,s);case 7:return p=e.sent,_=p.setting,d=_.client_id,f=_.client_secret,m=_.environment,d=(0,P.LO)(d,i),f=(0,P.LO)(f,i),m=(0,P.LO)(m,i),"",b="sandbox"===m?wt.PlaidEnvironments.sandbox:"production"===m?wt.PlaidEnvironments.production:wt.PlaidEnvironments.development,v=new wt.Configuration({basePath:b,baseOptions:{headers:{"PLAID-CLIENT-ID":d,"PLAID-SECRET":f,"Plaid-Version":"2020-09-14"}}}),h=new wt.PlaidApi(v),e.next=18,h.itemPublicTokenExchange({public_token:l});case 18:return g=e.sent,x=g.data.access_token,y=g.data.item_id,At.Z.info("accessToken: ".concat(x," <==> itemId: ").concat(y)),E="",k="",e.prev=24,e.next=27,h.assetReportCreate({access_tokens:[x],days_requested:60,options:{}});case 27:D=e.sent,E=D.data.asset_report_token,k=D.data.asset_report_id,At.Z.info("assetReportToken: ".concat(E," <==> assetReportId: ").concat(k)),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(24),console.log("error",e.t0);case 36:return e.next=38,Mt(a,o,s,u,x,y,E,k);case 38:return(I=e.sent).success?r.json({success:!0,message:"Plaid token has been updated"}).status(200):r.status(400).json({success:!1,message:I.message}),e.abrupt("return");case 43:e.prev=43,e.t1=e.catch(3),n(e.t1);case 46:case"end":return e.stop()}}),e,null,[[3,43],[24,33]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Lt=o().Router();Lt.post("/create-link-token",ce,Ct),Lt.post("/set-access-token",ce,Rt);const Bt=Lt;var jt=r(7920),Ut=r(6517),Nt=r.n(Ut);function St(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?St(Object(r),!0).forEach((function(t){w()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Kt=r(1423),Ft=r(6231),$t=r(1626).stringify,qt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,k,D;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.projectId,c=t.user,u=t.body,i=t.params,l=t.projectConstants,p=t.environment,e.next=4,Vt(c,a,s,o);case 4:return _=i.collectionItemId,console.log("==> callExternalApiAndProcess body :>> ",u),console.log("==> callExternalApiAndProcess collectionItemId :>> ",_),e.next=9,(0,jt.eD)(a,s,o,_,u,l,c,p);case 9:if(d=e.sent,console.log("******************** "),console.log("response :>> ",d),console.log("******************** "),f=(d||{}).totalRecords,!d.exportFile){e.next=55;break}if(m=d.generateCSV,b=d.donotPersistResponseData,v=d.headerColumns,h=d.body,m&&"DOWNLOAD_FILE_BYTES"!==m){e.next=23;break}return Object.keys(d.headers).forEach((function(e){var t=d.headers[e];"CONTENT-DISPOSITION"===e.toUpperCase()&&(t&&"undefined"!==t||(t='attachment; filename="'.concat(encodeURI((0,V.v4)()),'"'))),t&&"undefined"!==t&&r.setHeader(e,t)})),h.pipe(r),e.abrupt("return");case 23:if("GENERATE_CSV"!==m){e.next=34;break}return g=d.exportFileName,x=(0,V.v4)(),y="/Users/vijayshukla/Downloads/",E="".concat(x,".csv"),y+=E,Ft.existsSync(y)&&Ft.unlinkSync(y),b?$t(h,{header:!0,columns:v},(function(e,t){r.setHeader("content-type","text/csv"),r.setHeader("content-disposition",'attachment; filename="'.concat(encodeURI(g),'"')),r.status(200).end(t),Ft.existsSync(y)&&Ft.unlinkSync(y)})):$t(h,(function(e,t){r.setHeader("content-type","text/csv"),r.setHeader("content-disposition",'attachment; filename="'.concat(encodeURI(g),'"')),r.status(200).end(t),Ft.existsSync(y)&&Ft.unlinkSync(y)})),e.abrupt("return");case 34:if("DOWNLOAD_FILE_URL"!==m){e.next=53;break}if("string"!=typeof h){e.next=51;break}if(!h.startsWith("http:")&&!h.startsWith("https:")){e.next=47;break}return e.next=39,(0,Pe.kB)(h);case 39:return k=e.sent,D=Ft.createReadStream(k),r.writeHead(200,{"Content-Type":"application/octet-stream","Content-Disposition":'attachment; filename="'.concat(Kt.basename(k),'"')}),D.pipe(r),D.on("end",(function(){Ft.unlinkSync(k)})),e.abrupt("return");case 47:return(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,h,null,!0,d.status||500,null),e.abrupt("return",r.status(d.status||500).send(h));case 49:e.next=53;break;case 51:return(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,"URL received from API is not correct. Please check response path.",null,!0,500,null),e.abrupt("return",r.status(500).json({message:"URL received from API is not correct. Please check response path."}));case 53:e.next=61;break;case 55:if((0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,d.responseData,!0,d.status,null),!f){e.next=60;break}return e.abrupt("return",r.status(d.status).send(Wt(Wt({},d.responseData),{},{totalRecords:f})));case 60:return e.abrupt("return",r.status(d.status).send(d.responseData));case 61:e.next=68;break;case 63:e.prev=63,e.t0=e.catch(0),(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,e.t0,null,!0,500,null),console.log("::::::::in controller err",e.t0),n(e.t0);case 68:case"end":return e.stop()}}),e,null,[[0,63]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Gt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.builderDB,s=t.db,o=t.projectId,c=t.body,u=t.user,i=t.environment,l=c.externalApiId,p=c.itemId,l&&p){e.next=5;break}return e.abrupt("return",r.status(401).send({message:"Required Params Missing !!"}));case 5:(0,jt.fl)(a,s,o,l,p,u,i).then((function(e){e?(e.status="success"==e.status?200:e.status,r.status(e.status).send(e.data),(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,e.data,!0,e.status,null)):(r.status(200).send("Data send successfully"),(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,"Data send successfully",!0,200,null))})).catch((function(e){(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,"ExternalApi save errror",null,!0,500,null),console.log(">>>> ExternalApi save errror >>",e),n(e)})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,e.t0.message,null,!0,500,null),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Jt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a=t.body,s=a.apiResponseData,o=a.itemsPath,c=o?Nt().get(s,o):s,r.status(200).send(c),console.log("###==> processDataFromResponseJSON END :>> ")}catch(e){console.log("###==> processDataFromResponseJSON ERROR :>> ",e),n(e)}case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Zt=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.projectId,o=t.params,e.prev=1,c=o.externalApiId,e.next=5,(0,jt.GB)(a,s,c);case 5:if(!(u=e.sent)){e.next=11;break}return(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,u,!0,200,null),e.abrupt("return",r.send(u));case 11:(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,"No External API found for ".concat(c),null,!0,500,null),n(new g.AppError("No External API found for ".concat(c),500));case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,e.t0.message,null,!0,500,null),n(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ht=function(){var e=y()(O().mark((function e(t,r,n){var a,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object.keys(t.query).map((function(e){return"".concat(e,"=").concat(t.query[e])})).join("&"),At.Z.info("queryString".concat(a)),a="projectId=".concat(t.projectId,"&").concat(a),At.Z.info("queryString".concat(a)),e.next=7,(0,g.showLogger)(a);case 7:s=e.sent,r.status(200).json(s),(0,jt.Gp)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,s,!0,200,null),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),n(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),zt=function(){var e=y()(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectId,console.log("projectId :>> ",n),e.abrupt("return",r.status(400).json({success:!1,errors:{mobile:"Number is incorrect or missing"}}));case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Vt=function(){var e=y()(O().mark((function e(t,r,n,a){var s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=12;break}return o=(t||"").userName,s={$or:[{email:o},{userName:o}]},e.next=7,(0,D.ME)(r,n,a,le.B0,null,s);case 7:c=e.sent,u=c.data,Object.assign(t,u),delete t.password,delete t._id;case 12:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),Qt=o().Router();Qt.post("/send-webhook/",ce,Gt),Qt.post("/:collectionItemId?",ce,qt),Qt.post("/process/response-data/",Jt),Qt.get("/id/:externalApiId",ce,Zt),Qt.get("/show-logs/",Ht),Qt.get("/traceError/",zt);const Xt=Qt;var Yt=r(9293),er=r.n(Yt),tr=r(6958),rr=r.n(tr),nr=r(6231),ar=r.n(nr);const sr=require("hbs");var or=r.n(sr);const cr=require("node-html-parser"),ur=require("uglify-js");var ir=r.n(ur),lr=r(7745),pr=r(2167),_r=r.n(pr),dr=function(){var e=y()(O().mark((function e(){var t,r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat(process.env.ORGANIZATION_ENGINE_URL,"form-themes/builder/list/"),e.next=4,_r().get(t);case 4:return r=e.sent,e.abrupt("return",r.data);case 8:return e.prev=8,e.t0=e.catch(0),console.log(">> formTheme error:::",e.t0.message),e.abrupt("return",e.t0.response?e.t0.response.data:[]);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),fr=function(){var e=y()(O().mark((function e(t,r,n){var a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,dr();case 3:a=e.sent,r.send(a).status(200),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r,n){return e.apply(this,arguments)}}();function mr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mr(Object(r),!0).forEach((function(t){w()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var vr=process.env.BRAND_MSG||"Made with DrapCode",hr=r(1423),gr=/<script\b[^>]*>([\s\S]*?)<\/script>/gm,xr=r(7745),yr=function(){var e=y()(O().mark((function e(t,r){var n,a,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.projectId,a="".concat("/Users/vijayshukla/work-area/webconnect/","views/").concat(n),ar().rmdirSync(a,{recursive:!0}),s="".concat("/Users/vijayshukla/work-area/webconnect/","static/").concat(n),ar().rmdirSync(s,{recursive:!0}),r.status(200).json({});case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Er=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,x,E,k,D,I,w;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=t.builderDB,s=t.environment,o=n.projectId,e.next=4,(0,$.uC)(a,o);case 4:if(c=e.sent){e.next=7;break}return e.abrupt("return",r.send("No Project found with this ID").status(400));case 7:return console.log("******* Making build *****"),e.prev=8,e.next=11,(0,$.gS)(a,o);case 11:return u=e.sent,e.next=14,(0,$.ET)(a,o);case 14:return i=e.sent,e.next=17,(0,$.xv)(a,o);case 17:return l=e.sent,e.next=20,(0,$.$F)(a,o);case 20:return p=e.sent,console.log("collections :>> ",p.length),_=l.filter((function(e){return e.autoAddToBody})),console.log("pluginsAutoAddToBody :>> ",_),d=[],l.forEach((function(e){var t;g.plugins.some((function(r){if(e.code===r.code){if("FACEBOOK_LOGIN"===e.code)if(e.setting){var n=e.setting.clientId;n=(0,P.LO)(n,s),r.app_id=n}else r.app_id="";if("GOOGLE_LOGIN"===e.code)if(e.setting){var a=e.setting.clientId;a=(0,P.LO)(a,s),r.client_id=a}else r.client_id="";t=r}})),t&&d.push(t)})),f=l.find((function(e){return"GOOGLE_MAP"===e.code})),m=l.find((function(e){return"ATOM_CHAT"===e.code})),b=l.find((function(e){return"SNIPCART"===e.code})),v=l.find((function(e){return"BNG_PAYMENT"===e.code})),h=c.faviconKeyName?"".concat("https://webconnect-upload.s3.ap-south-1.amazonaws.com","/").concat(c.faviconKeyName):"https://drapcode.com/favicon.png",e.next=33,(0,$.AP)(a,o);case 33:return x=e.sent,x=Or(x),E=x.filter((function(e){return"SNIPPET"===e.snippetType})),e.next=38,(0,$.gW)(a,o);case 38:return k=e.sent,e.next=41,(0,$.BP)(a,o);case 41:return D=e.sent,e.next=44,(0,$.c3)(a,o);case 44:return e.next=46,(0,$.UR)(a,o);case 46:return I=e.sent,e.next=49,(0,$.Tr)(a,o);case 49:return e.next=51,(0,$.AR)(a,o);case 51:w=(0,g.getTimezoneOffset)(c.timezone),u.forEach(function(){var e=y()(O().mark((function e(t){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dr(t);case 2:return r=e.sent,n="",t.collectionFrom&&"EXTERNAL_API"===t.collectionFrom&&t.externalApiId&&(n=I&&I.length?I.find((function(e){return e.uuid===t.externalApiId})):"",console.log("==> Found External API in Page :>> ",t.name)),e.next=7,Ir(c,t,d,_,f,m,h,w,k,D,E,p,r,b,v,n,s,i);case 7:console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$",t.name);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.status(200).send({message:"Build Success"}),e.next=60;break;case 56:e.prev=56,e.t0=e.catch(8),console.log("error :>> ",e.t0),r.json(e.t0).status(400);case 60:case"end":return e.stop()}}),e,null,[[8,56]])})));return function(t,r){return e.apply(this,arguments)}}(),Or=function(e){var t=[];return e.forEach((function(e){var r=e.uuid,n=e.snippetType,a=e.content,s=e.name;if(a){var o=a["nocode-html"];if(o&&"undefined"!==o){var c=o.replace(gr,"");c=(0,g.replaceNbsps)(c);var u=a["nocode-css"],i=gr.exec(o);t.push({uuid:r,snippetType:n,name:s,snippetContent:c,snippetScript:i&&i.length?i[1]:"",snippetCss:u})}}})),t},kr=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.mainContent,s=n.eventName,o=[],a&&t&&(c=a)&&"undefined"!==c&&t.forEach((function(e){var t=s&&s===e.eventName;if(c.includes(e.eventName)||t){var r="async function ".concat(e.eventName,"(ev, url_params={}){\n                            let element,targetElement, formID; \n                            if(ev){\n                              element =  ev.target|| ev.srcElement ;\n                              targetElement = ev.currentTarget ;\n                              ev.preventDefault();\n                              formID = element && element.id ? $(\"#\"+element.id):'';\n                            }\n                            const ifValidToProcess = ev && ev.type === \"submit\" ? formID && formID.valid() && formID.validate().pendingRequest === 0 : true;\n                            let formSubmitBtn;\n                            let formSubmitBtnText;\n                            if(formID){\n                             formSubmitBtn = formID.find(':button[type=submit]');\n                             formSubmitBtnText = formSubmitBtn.html()\n                            }\n                if(ifValidToProcess) {\n                  formSubmitBtn && formSubmitBtn.prop('disabled', true);\n                  formSubmitBtn && formSubmitBtn.empty().append(\"<i class='fa fa-spinner fa-spin'></i>\");\n                  let response= null;\n                  try{");e.actions.filter((function(e){return!!e.step})).sort((function(e,t){return e.step>t.step?1:e.step==t.step?0:-1})).forEach((function(e){var t=e.parameters,n=e.enabledEnvironments,a=e.defaultEnabled;a=void 0===a||a,n=void 0===n?[]:n;var s={};t.forEach((function(e){s[e.name]=e.value}));var o="\n            if(response && response.status==='error' && ".concat("showAlertMessage"!==e.name,"){\n              formSubmitBtn && formSubmitBtn.prop('disabled', false);\n              formSubmitBtn && formSubmitBtn.html(formSubmitBtnText);\n                         return;\n                   }\n            response = await ").concat(e.name,"({parameters:").concat(JSON.stringify(s),",response:response?response.data:'',element:element, targetElement:targetElement, url_params:url_params,defaultEnabled:").concat(a,",enabledEnvironments:").concat(JSON.stringify(n),"});");r+="\n  ".concat(o,"\n            console.log(response);")})),r+="\n            formSubmitBtn && formSubmitBtn.prop('disabled', false);\n            formSubmitBtn && formSubmitBtn.html(formSubmitBtnText);\n          }\n          catch(error){\n            formSubmitBtn && formSubmitBtn.prop('disabled', false);\n            formSubmitBtn && formSubmitBtn.html(formSubmitBtnText);  \n              console.log(\"error\", error);  \n            }\n          } else {\n            console.log(\"I am submit event and not valid\");\n          }\n        }",r=ir().minify(r,{ie8:!0});var n=ar().readFileSync(hr.join(__dirname,"../views/event.hbs"),"utf-8"),a=or().compile(n)({eventScript:r.code});o.push(a)}})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Dr=function(e,t){var r="data-localization-key",n=(0,cr.parse)(e),a=n.querySelectorAll("[".concat(r,"]"));return a&&t&&a.forEach((function(e){var n=e.getAttribute(r),a=n?Pr(n,t):"";e.textContent=a||"",e.setAttribute("style","display:;")})),n.toString()},Pr=function(e,t){var r=t.languageKeyValues.find((function(t){return t.key===e}));return r?r.value:e},Ir=function(){var e=y()(O().mark((function e(t,r,n,a,s,o,c,u,i,l,p,_,d,f,m,b,v,h){var x;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x=Tr(n,s,r,t,d,f,m,"",v),h.forEach(function(){var e=y()(O().mark((function e(s){var l,d,m,h,y,E,k;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=Cr(n,a,gr,r,p,_,t,o,f,b,v,s),console.log(" ******  ******* ****** prepareBodySectionOfPage"),console.log("****** *** renderHeadSection *******"),d=[],!i){e.next=8;break}return e.next=7,kr(i,l,r);case 7:d=e.sent;case 8:console.log("******** addEventsScript ********"),m=[],console.log("********** addConditionsScript ********"),h=r&&r.pageDirection?r.pageDirection:"ltr","FREE"===t.projectType&&(l.brandMessage=(0,g.brandMessage)(vr)),y=ar().readFileSync(hr.join(__dirname,"../views/index.hbs"),"utf-8"),E=or().compile(y),k=E(br(br(br({},x),l),{},{faviconUrl:c,timeZone:u,eventsScript:d,conditionsScript:m,pageDirection:h})),wr(k,"".concat(t.uuid,"/").concat(s.language),"".concat(r.slug),"".concat(r.slug,".hbs"));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s,o,c,u,i,l,p,_,d,f,m,b,v,h){return e.apply(this,arguments)}}(),wr=function(e,t,r,n){var a="".concat("/Users/vijayshukla/work-area/webconnect/","views/").concat(t);ar().existsSync(a)||ar().mkdirSync(a);var s="".concat(a,"/").concat(r);ar().existsSync(s)||ar().mkdirSync(s),ar().existsSync("".concat(s,"/").concat(n))&&ar().unlinkSync("".concat(s,"/").concat(n)),ar().writeFileSync("".concat(s,"/").concat(n),e,(function(e){e&&console.error("Failed to save file ",e)}))},Tr=function(e,t,r,n,a,s,o,c,u){var i=r.name,l=r.titleTag,p=r.description,_=r.pageImage,d=r.extraMetaTag,f=r.content;console.log("name today",i);var m,b=n.loadingIconKey,v=n.notificationSetting;m=l||"".concat(i);var h=[].concat(rr()(g.defaultMetaTags),rr()(Sr(m,p,_,"".concat(c,"/").concat(r.slug,".html"),n)),[d||'<meta charset="UTF-8">']),x=[];b&&x.push("<script>\n    window.addEventListener('DOMContentLoaded', (event) => {\n      window.localStorage.setItem('loadingIconKey', '".concat(b,"')\n  });\n    <\/script>")),v&&x.push("<script>\n    window.addEventListener('DOMContentLoaded', (event) => {\n      window.localStorage.setItem('notificationSetting', '".concat(JSON.stringify(v),"')\n  });\n    <\/script>")),zr(n,x),n.toggleUnloadDefaultJS||x.push('<script type="text/javascript" src="/resources/lib/js/jquery.min.js"><\/script>');var y=[];if(Yr(n,y),x.push.apply(x,y),t){var E=t.setting.api_key;E=(0,P.LO)(E,u),x.push('<script src="https://maps.googleapis.com/maps/api/js?key='.concat(E,'&libraries=&v=weekly" defer><\/script>'))}console.log("pluginsWithCssAndJs :>> "),e&&e.forEach((function(e){e.headerJs&&e.headerJs.forEach((function(e){return x.push(e)}))}));var O=[];O.push.apply(O,rr()(g.defaultFonts));var k=[],D=[];en(n,D),k.push.apply(k,D);var I=Rr(f);if($r(I,a,k),Wr(I)&&(x.push('<script type="text/javascript" src="/resources/lib/js/summernote-bs4.min.js"><\/script>'),k.push("<link rel='stylesheet' type='text/css' href='/resources/lib/css/summernote-bs4.css'>")),Kr(I)&&(x.push('<script type="text/javascript" src="/resources/lib/js/flatpickr.min.js"><\/script>'),k.push("<link rel='stylesheet' type='text/css' href='/resources/lib/css/flatpickr.min.css'>")),Fr(I)&&(x.push('<script type="text/javascript" src="/resources/lib/intl-tel-input/intlTelInput-jquery.min.js"><\/script>'),k.push("<link rel='stylesheet' type='text/css' href='/resources/lib/intl-tel-input/intlTelInput.min.css'>")),s&&k.push("<link rel='stylesheet' href='https://cdn.snipcart.com/themes/v3.3.1/default/snipcart.css' />"),o){var w=o.setting.checkoutKey;console.log("checkoutKey",w),x.push('<script src="https://secure.bngpaymentgateway.com/token/CollectCheckout.js" data-checkout-key="'.concat(w,'">\n    <\/script>'))}if(r&&r.content&&r.content["nocode-html"]){var T=r.content["nocode-html"]?r.content["nocode-html"].replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gm,""):"";(T=(0,g.replaceNbsps)(T)).includes('data-js="data-table-dynamic"')&&(k.push('<link rel="stylesheet" href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css" />'),k.push('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />'),k.push('<link rel="stylesheet" href="https://cdn.datatables.net/1.13.2/css/dataTables.bootstrap5.min.css" />'))}return n.enablePWA&&k.push("<link rel='manifest' href='/manifest.webmanifest.json/'>"),Ar(n,k),Mr(n,k),{headerFonts:O,headerCSS:k,headerJS:x,metaTags:h,titleOfPage:m}},Mr=function(e,t){try{var r=e.content,n=e.customCSSClasses,a=r&&r.customCSS?"".concat(r.customCSS):"",s=(new xr).minify(a),o=n||[],c=(new xr).minify((0,g.formatCustomCSSClasses)(o));if(s||c){var u="".concat(e.seoName,"-custom.min.css"),i="".concat("/Users/vijayshukla/work-area/webconnect/","views");ar().existsSync(i)||ar().mkdirSync(i);var l="".concat(i,"/").concat(e.uuid);ar().existsSync(l)||ar().mkdirSync(l),ar().existsSync("".concat(l,"/").concat(u))&&ar().unlinkSync("".concat(l,"/").concat(u)),ar().writeFileSync("".concat(l,"/").concat(u),s.styles+c.styles,(function(e){e&&console.error("Failed to save file ",e)})),t.push("<link rel='stylesheet' type='text/css' href=".concat("/static/".concat(e.uuid,"/").concat(u),">"))}}catch(e){console.error(e)}},Ar=function(e,t){console.log("==> Going to add project custom css cdns...");try{var r=e.customCssCdns;r&&r.sort((0,P.IQ)("sortOrder")).map((function(e){e.urlOrTag.startsWith("<link")?t.push(e.urlOrTag):(e.urlOrTag.startsWith("http")||e.urlOrTag.startsWith("ftp"))&&t.push('<link rel="stylesheet" href=\''.concat(e.urlOrTag,"' crossorigin/>"))}))}catch(e){console.error(e)}},Cr=function(e,t,r,n,a,s,o,c,u,i,l,p){var _=n.content,d=n.eventName;if(!_||!_["nocode-html"])return console.log("************ No Page Content *********"),{mainContent:(0,g.pageNotFound)()};var f,m,b,v=[],h=[],x=Rr(_),y=Lr(s,x),E=_["nocode-html"].replace(r,"");E=(0,g.replaceNbsps)(E),f=E=Ur(E,a,v,h),(b=(m=(0,cr.parse)(f)).querySelectorAll("[data-js=data-group], [data-js=data-list], [data-row=generated]"))&&b.forEach((function(e){e.setAttribute("style","display:none;")})),E=m.toString(),E=Dr(E,p);var O=Nr(e,t,l),k=r.exec(_["nocode-html"]);if(k&&k.length&&v.push(k[1]),c&&c.code&&E.includes('id="atomchat"')){E=E.replace('<img src="https://public-webconnect.s3.amazonaws.com/atomchat.png" alt="atomchat" class="atomchat">','<div id="cometchat_embed_synergy_container" style="width:100%;height:100%;max-width:100%;overflow:hidden;"></div>');var D=c.setting,I=D.api_id,w=D.auth_key;I=(0,P.LO)(I,l),w=(0,P.LO)(w,l),O.push("<script>\n      let user = localStorage.getItem('user');\n      console.log('user :>> ', user);\n      user = JSON.parse(user);\n      if (user) {\n        const { userRoles, userName, uuid, first_name, last_name } = user;\n        var chat_appid = '".concat(I,"';\n        var chat_auth = '").concat(w,"';\n        var chat_id = user.uuid;\n        var chat_name = user.first_name + ' ' + user.last_name;\n        var chat_role = user.userRoles[0];\n  \n        var chat_js = document.createElement('script'); \n        chat_js.type = 'text/javascript'; \n        chat_js.src = 'https://fast.cometondemand.net/'+chat_appid+'x_xchatx_xcorex_xembedcode.js';\n        chat_js.onload = function() {\n          var chat_iframe = {};\n          chat_iframe.module=\"synergy\";\n          chat_iframe.style=\"min-height:100%; min-width:100%;\";\n          chat_iframe.src='https://'+chat_appid+'.cometondemand.net/cometchat_embedded.php'; \n          if(typeof(addEmbedIframe)==\"function\"){addEmbedIframe(chat_iframe);}\n        }\n        var chat_script = document.getElementsByTagName('script')[0];\n        chat_script.parentNode.insertBefore(chat_js, chat_script);\n      }\n      <\/script>"))}Hr(o,O),Vr(o,O),Jr(n,O),Zr(n,O),E.includes('data-js="data-table-dynamic"')&&O.push('<script type="text/javascript" src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"><\/script>'),E=Qr(u,E,l),E=Xr(n,E,i);var T=ir().minify(v.join(" "),{ie8:!0});if(T&&T.code?O.push("<script>".concat(T.code,"<\/script>")):O.push("<script>".concat(v.join(" "),"<\/script>")),y&&y.length>0){var M=ir().minify(y.join(" "),{ie8:!0});M&&M.code?O.push("<script>".concat(M.code,"<\/script>")):O.push("<script>".concat(y.join(" "),"<\/script>"))}d&&O.push("<script> \n                    $(window).on('load', function() {\n                      const url_params = Object.fromEntries(new URLSearchParams(window.location.search));\n\n                      setTimeout(() => {\n                        ".concat(d,"(null, url_params);\n                      }, 500)\n                    });\n              <\/script>"));var A=[];return A.push("<style>".concat(_["nocode-css"],"</style>")),h&&h.forEach((function(e){return A.push("<style>".concat(e,"</style>"))})),{mainContent:E,bodyJS:O,bodyCSS:A}},Rr=function(e){if(null==e)return[];if(void 0===e["nocode-components"]||!e["nocode-components"])return[];var t=JSON.parse(e["nocode-components"]);if(!t||0===t.length)return[];var r=[];return jr(r,t),r},Lr=function(e,t){var r=t.filter((function(e){if(e&&e.attributes)return Object.keys(e.attributes).includes("data-form-validation")}));if(!r)return[];var n=[];return r.forEach((function(t){var r=t.attributes,a=r.id,s=r["data-form-collection"],o=r["data-form-validation"],c=Br(e,s,o);if(c){var u=c.validationRules,i={},l={};u.forEach((function(e){var t=i[e.field];t?(t[e.key]=e.value,i[e.field]=t):i[e.field]=w()({},e.key,e.value);var r=l[e.field];r?(r[e.key]=e.message,l[e.field]=r):l[e.field]=w()({},e.key,e.message)}));var p={rules:i,messages:l},_='$("#'.concat(a,'").validate(').concat(JSON.stringify(p),");");n.push("".concat(_))}})),n},Br=function(e,t,r){var n=e.find((function(e){return e.collectionName===t}));return n?n.validations.find((function(e){return e.uuid===r})):null},jr=function e(t,r){r&&r.forEach((function(r){r.components&&e(t,r.components),t.push(r)}))},Ur=function(e,t,r,n){return t&&t.forEach((function(t){if(t){var a=t.uuid,s=t.snippetContent,o=t.snippetScript,c=t.snippetCss,u=(0,cr.parse)(e),i=u.querySelector("[data-snippet-id=".concat(a,"]"));if(i){var l=(0,cr.parse)(s);i.appendChild(l),e=u.toString(),o&&r.push(o),c&&n.push(c)}}})),e},Nr=function(e,t,r){var n=[];return n.push.apply(n,rr()(g.primaryBodyJS)),e&&e.forEach((function(e){e.bodyJs&&e.bodyJs.forEach((function(t){if("FACEBOOK_LOGIN"===e.code){var a=e.app_id;a=(0,P.LO)(a,r),t=t.replace("fb_app_id",a)}if("GOOGLE_LOGIN"===e.code){var s=e.client_id;s=(0,P.LO)(s,r),t=t.replace("google_client_id",s)}t.includes("/resources/action")?n.push(t):n.push(t.replace("/action","/resources/action"))}))})),t&&t.length&&t.forEach((function(e){var t=e.setting;t.code&&(t.code.includes("/resources/action")?n.push(t.code):n.push(t.code.replace("/action","/resources/action")))})),n},Sr=function(e,t,r,n,a){var s=['<meta property="og:type" content="website">'];e&&(s.push('<meta name="title" content="'.concat(e,'">')),s.push('<meta property="og:title" content="'.concat(e,'">')),s.push('<meta property="twitter:title" content="'.concat(e,'">')));var o=t||a.description;o&&(s.push('<meta name="description" content="'.concat(o,'">')),s.push('<meta property="og:description" content="'.concat(o,'">')),s.push('<meta property="twitter:description" content="'.concat(o,'">')));var c=r?"".concat("https://webconnect-upload.s3.ap-south-1.amazonaws.com","/").concat(r):a.projectLogoKeyName?"".concat("https://webconnect-upload.s3.ap-south-1.amazonaws.com","/").concat(a.projectLogoKeyName):"https://drapcode.com/img/DrapCode-Icon-Dark.png";return c&&(s.push('<meta property="og:image" content="'.concat(c,'">')),s.push('<meta property="twitter:image" content="'.concat(c,'">'))),n&&(s.push('<meta property="og:url" content="'.concat(n,'">')),s.push('<meta property="twitter:url" content="'.concat(n,'">'))),s},Wr=function(e){return e.find((function(e){return e&&"textarea"===e.tagName}))},Kr=function(e){return e.find((function(e){if(e&&e.attributes)return Object.keys(e.attributes).includes("type")&&("datetime-local"===e.attributes.type||"date"===e.attributes.type)}))},Fr=function(e){return e.find((function(e){if(e&&e.attributes)return Object.keys(e.attributes).includes("type")&&"tel"===e.attributes.type}))},$r=function(e,t,r){var n=[],a=e.filter((function(e){return"form"===e.tagName}));qr(a,n);var s=n.includes("dc-form-default");Gr(t,n,s,r)},qr=function(e,t){var r=[];e.forEach((function(e){r=[],e&&e.classes&&Array.isArray(e.classes)&&(r=e.classes.filter((function(e){return e.name.startsWith("dc-form-theme")||e.name.startsWith("dc-form-default")}))),r&&r[0]&&(t.includes(r[0].name)||t.push(r[0].name))}))},Gr=function(e,t,r,n){var a=[];if(e){e.forEach((function(e){t.includes(e.klass)&&a.push(e)}));var s=function(e,t){var r="";return t&&(r=g.formDefaultStyle),r+="\n  .sortable-asc:after {\n    font-family: 'Font Awesome 5 free';\n    content: \"\\f884\";\n    margin-left: 10px;\n    }\n  .sortable-desc:after {\n    font-family: 'Font Awesome 5 free';\n    content: \"\\f160\";\n    margin-left: 10px;\n    }\n  ",r+="\n  .dc-pagination-select:not(.search-form) .select2-container {\n    width: 100% !important;\n    outline: none;\n    display: block;\n  }\n  .dc-pagination-select .select2-container .select2-selection--single {\n    background-color: transparent;\n    border: 1px solid #ced4da;\n    border-radius: 0 .25rem .25rem 0;\n    height: 38px;\n    padding: 0 15px;\n  }\n  .dc-pagination-select .select2-container .select2-selection--single .select2-selection__rendered {\n    line-height: 38px;\n    padding-left: 0;\n    color: #808080;\n    font-size: 16px;\n    font-family: inherit;\n    font-weight: 500\n  }\n  .dc-pagination-select .select2-container .select2-selection--single .select2-selection__arrow {\n    height: 38px;\n    right: 4px;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -moz-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: center;\n    -webkit-justify-content: center;\n    -moz-box-pack: center;\n    -ms-flex-pack: center;\n    justify-content: center;\n    -webkit-box-align: center;\n    -webkit-align-items: center;\n    -moz-box-align: center;\n    -ms-flex-align: center;\n    align-items: center\n  }\n  .dc-pagination-select .select2-container .select2-selection--single .select2-selection__arrow b {\n    display: none\n  }\n  .dc-pagination-select .select2-container .select2-selection--single .select2-selection__arrow:after {\n    font-family: 'Font Awesome 5 free';\n    content: \"\f107\";\n    font-size: 18px;\n    font-weight: 700;\n    color: #ccc;\n    -webkit-transition: all 0.4s ease;\n    -o-transition: all 0.4s ease;\n    -moz-transition: all 0.4s ease;\n    transition: all 0.4s ease\n  }\n  .dc-pagination-select .select2-container.select2-container--open .select2-selection--single .select2-selection__arrow::after {\n    -webkit-transform: rotate(-180deg);\n    -moz-transform: rotate(-180deg);\n    -ms-transform: rotate(-180deg);\n    -o-transform: rotate(-180deg);\n    transform: rotate(-180deg)\n  }\n  .dc-pagination-select .select2-container--open .select2-dropdown--below {\n    border: none;\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n    border-radius: 3px;\n    -webkit-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);\n    box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);\n    border: 1px solid #e0e0e0;\n    margin-top: 5px;\n    overflow: hidden\n  }\n  ",e&&e&&e.map((function(e){r+=e.contentStyle})),(new lr).minify(r).styles}(a,r),o=s?"<style>".concat(s,"</style>"):"";o&&n.push(o)}},Jr=function(e,t){try{if(e.externalScriptURL){var r=e&&e.externalScriptURL?e.externalScriptURL.split(","):"";r&&r.forEach((function(e){t.push("<script src=".concat(e.trim()," async defer><\/script>"))}))}}catch(e){console.error(e)}},Zr=function(e,t){try{if(e.customScript){var r=e.customScript.trim(),n=r.startsWith("<script>")?r.replace("<script>",""):r;n=n.endsWith("<\/script>")?n.replace("<\/script>",""):n,t.push("<script>".concat(n.trim(),"<\/script>"))}}catch(e){console.error(e)}},Hr=function(e,t){console.log("==> Going to add project custom js cdns...");try{e.customJsCdns&&e.customJsCdns.sort((0,P.IQ)("sortOrder")).map((function(e){!e.addToHead&&e.urlOrTag.startsWith("<script")?t.push(e.urlOrTag):(!e.addToHead&&e.urlOrTag.startsWith("http")||e.urlOrTag.startsWith("ftp"))&&t.push("<script src='".concat(e.urlOrTag,"' async defer><\/script>"))}))}catch(e){console.error(e)}},zr=function(e,t){console.log("==> Going to add project custom js cdns to head...");try{e.customJsCdns&&e.customJsCdns.sort((0,P.IQ)("sortOrder")).map((function(e){e.addToHead&&e.urlOrTag.startsWith("<script")?t.push(e.urlOrTag):(e.addToHead&&e.urlOrTag.startsWith("http")||e.urlOrTag.startsWith("ftp"))&&t.push("<script src='".concat(e.urlOrTag,"' async defer><\/script>"))}))}catch(e){console.error(e)}},Vr=function(e,t){console.log("==> Going to add project custom js content...");try{var r=e.content,n=r.customJS?r.customJS:"";if(n){var a=n.trim(),s=a.startsWith("<script>")?a.replace("<script>",""):a;s=s.endsWith("<\/script>")?s.replace("<\/script>",""):s,t.push("<script>".concat(s.trim(),"<\/script>"))}}catch(e){console.error(e)}},Qr=function(e,t,r){if(e){var n=e.setting,a=n.secret_key,s=n.config_modal_style;a=(0,P.LO)(a,r),s=(0,P.LO)(s,r),t+='<div id="snipcart" data-config-modal-style="'.concat(s,'" data-api-key="').concat(a,'" data-config-add-product-behaviour="none" hidden></div>')}return t},Xr=function(e,t,r){if(e.collectionFrom&&"EXTERNAL_API"===e.collectionFrom){var n=e.externalApiId;if(n){var a='data-external-api-id="'.concat(n,'"'),s=r||"",o=s.responseDataMapping,c=s.bodyDataFrom,u=s.collectionMapping;c&&"NON_PERSISTENT_COLLECTION"===c&&(a+=' data-external-api-data-from="'.concat(c,'"'));var i=(o||"").selectedMapping;if(i){var l=i._data_source_rest_api_primary_id?i._data_source_rest_api_primary_id:"";l&&(a+=' data-external-api-unique-key="'.concat(l,'"')),a+=' data-external-api-response-mapping="'.concat(JSON.stringify(i).replace(/"/g,"'"),'"')}var p=(o||"").itemsPath;p&&(a+=' data-external-api-item-path="'.concat(p,'"')),u&&(a+=' data-external-api-request-mapping="'.concat(JSON.stringify(u).replace(/"/g,"'"),'"')),t+='<span id="project-page-external-api" style="display:none;" '.concat(a,"></span>")}}return t},Yr=function(e,t){g.defaultHeaderJS.forEach((function(r){if(r.includes("bootstrap.min.js"))switch(e.uiFrameworkVersion){case"4.5":t.push('<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"><\/script>');break;case"4.6":t.push('<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"><\/script>');break;case"5.2":t.push('<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"><\/script>');break;default:t.push(r)}else t.push(r)}))},en=function(e,t){g.defaultHeaderCSS.forEach((function(r){if(r.includes("bootstrap.min.css"))switch(e.uiFrameworkVersion){case"4.5":t.push('<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">');break;case"4.6":t.push('<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">');break;case"5.2":t.push('<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">');break;default:t.push(r)}else t.push(r)}))},tn=function(){var e=y()(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("snippets"),e.next=3,n.findOne(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),rn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.projectId,o=t.query.lang,c=t.params.templateId,e.next=4,tn(a,{uuid:c});case 4:return delete(u=e.sent).content["nocode-assets"],e.next=8,(0,$.ET)(a,s);case 8:i=e.sent,l=!o||["null","undefined"].includes(o)||["null","undefined"].includes(er()(o))?i.find((function(e){return e.isDefault})):i.find((function(e){return e.language===o})),u.content["nocode-html"]=Dr(u.content["nocode-html"],l),r.status(200).send(u.content),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r,n){return e.apply(this,arguments)}}(),nn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.projectId,o=t.query.lang,c=t.params.templateId,e.next=4,tn(a,{snippetType:"MODAL",uuid:c});case 4:return u=e.sent,e.next=7,(0,$.ET)(a,s);case 7:i=e.sent,l=!o||["null","undefined"].includes(o)||["null","undefined"].includes(er()(o))?i.find((function(e){return e.isDefault})):i.find((function(e){return e.language===o})),u.content["nocode-html"]=Dr(u.content["nocode-html"],l),r.status(200).send(u),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),an=r(8378),sn=function(){var e=y()(O().mark((function e(t,r,n){var a,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={projectId:t.projectId,templateType:"EMAIL",parentTemplateId:null},e.next=4,(0,an.tx)(t.builderDB,a);case 4:s=e.sent,r.status(200).send(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),on=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.body,o=t.user,c=t.projectId,console.log("==> saveTemplate user :>> ",o,"projectId :>> ",c),u={projectId:c,templateType:s.type?s.type.toUpperCase():"EMAIL",content:s.content,subject:s.subject,parentTemplateId:s.parent_template_id,tenants:s.tenants},console.log("==> saveTemplate data :>> ",u),e.next=7,(0,an.jg)(a,u);case 7:403!==(i=e.sent).code?r.status(200).send(i):r.status(403).send(i),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),n(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),cn=o().Router();cn.post("/build/:projectId",ce,Er),cn.delete("/deleteProject",ce,yr),cn.get("/:projectId/snippet-templates/:templateId/content",ce,rn),cn.get("/snippet-templates/:templateId",ce,nn),cn.get("/detail",ce,$.x4),cn.get("/templates",ce,sn),cn.post("/templates/create",ce,on);const un=cn;var ln=function(){var e=y()(O().mark((function e(t,r){var n,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("conditions"),e.next=3,n.find(r).toArray();case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),pn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.projectId,e.prev=1,e.next=4,ln(a,{projectId:s,enableCondition:!0});case 4:o=e.sent,r.status(200).send(o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),_n=o().Router();_n.get("/",ce,pn);const dn=_n;var fn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.projectId,o=t.params,e.prev=1,c=o.collectionName,e.next=5,(0,k.GB)(a,{collectionName:c,projectId:s});case 5:if(!(u=e.sent)){e.next=10;break}return e.abrupt("return",r.send(u));case 10:n(new g.AppError("No collection data has found for ".concat(c),500));case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),mn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.projectId,o=t.params,e.prev=1,c=o.uuid,e.next=5,(0,k.GB)(a,{uuid:c,projectId:s});case 5:if(!(u=e.sent)){e.next=10;break}return e.abrupt("return",r.send(u));case 10:n(new g.AppError("No collection data has found for ".concat(c),500));case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),bn=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query,a=t.db,s=t.params,o=s.collectionName,e.next=4,(0,D.gv)(a,o,n);case 4:c=e.sent,r.status(200).send("".concat(c));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),vn=o().Router();vn.get("/:collectionName/name",fn),vn.get("/:uuid/id",mn),vn.get("/:collectionName/items/unique-check",bn);const hn=vn;var gn=o().Router();gn.get("/",ce,fr);const xn=gn;var yn=r(5125),En=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.body,e.next=4,(0,yn.B)(a,s);case 4:o=e.sent,r.status(200).send(o),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),On=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.db,s=t.params,e.next=4,(0,yn.n)(a,{uuid:s.externalApiMiddlewareId});case 4:o=e.sent,r.status(200).send(o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),kn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.projectId,c=t.params,e.next=4,(0,yn.n)(s,{uuid:c.externalApiMiddlewareId});case 4:if(u=e.sent){e.next=7;break}throw new Error("External api midddleware not found.");case 7:return i=t.query,l=i.limit,p=i.page,_=u.query,d=u.collectionName,e.next=11,(0,D.uC)(a,s,d,o,w()({},_.primaryKey,{$in:_.itemsPrimaryKeyValues}),p,l);case 11:f=e.sent,console.log(":::result:::",f),r.status(f.code).send(f.data),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),n(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Dn=o().Router();Dn.get("/:externalApiMiddlewareId",ce,On),Dn.post("/",ce,En),Dn.get("/:externalApiMiddlewareId/collection-items",ce,kn);const Pn=Dn;var In=r(8027),wn=o().Router();wn.get("/",g.interceptLogger,ce,(function(e,t,r){(0,In.x)(e.builderDB,e.projectId).then((function(e){t.status(200).send(e)})).catch((function(e){r(e)}))}));var Tn=r(9336),Mn=r.n(Tn),An=r(1738),Cn=r.n(An),Rn=r(6303).spawn,Ln=r(3844),Bn=(process.env,"webconnect-upload"),jn="localhost",Un="27017",Nn="/Users/vijayshukla/work-area/",Sn=new(Mn().S3)({accessKeyId:"AKIAX4BKOZ6FHUQHT4KH",secretAccessKey:"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",region:"ap-south-1"}),Wn=Cn()().single("file"),Kn=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(At.Z.info("DB Dump Request Initiated",{label:"DB_DUMP"}),e.prev=1,a=t.projectId,s=t.params,o=s.uuid,c="http://localhost:5000/api/",a){e.next=8;break}return At.Z.err("Invalid Project ID",{label:"DB_DUMP"}),e.abrupt("return",r.status(400).send({message:"Invalid Project ID"}));case 8:if(o){e.next=11;break}return At.Z.err("Invalid DB Dump Request",{label:"DB_DUMP"}),e.abrupt("return",r.status(400).send({message:"Invalid DB Dump Request"}));case 11:u="mongodb://".concat(jn,":").concat(Un,"/project_").concat(a),At.Z.info("db_config ".concat(u),{label:"DB_DUMP"}),i="mongodump --uri ".concat(u," --forceTableScan"),Rn(i,{cwd:Nn,shell:!0,stdio:"inherit"}).on("close",function(){var e=y()(O().mark((function e(t){var n,s,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return At.Z.info("DB Dump successfully => ".concat(t),{label:"DB_DUMP"}),n=new Ln,s="project_".concat(a,".zip"),u="".concat(Nn,"/dump/project_").concat(a),i="".concat(Nn,"/dump/").concat(s),At.Z.info("".concat({outputFile:s,localFolder:u,generatedPath:i}),{label:"DB_DUMP"}),e.next=8,n.addLocalFolder(u);case 8:return e.next=10,n.writeZip(i);case 10:return e.next=12,ar().readFileSync(i);case 12:return l=e.sent,At.Z.info("Uploading to S3",{label:"DB_DUMP"}),p={Bucket:Bn,Key:"project_".concat(a,"/dump/").concat(X()(new Date).valueOf(),"/").concat(s),Body:l},At.Z.info("Created ".concat(s," successfully ").concat(p),{label:"DB_DUMP"}),e.next=18,Sn.upload(p);case 18:e.sent.send(function(){var e=y()(O().mark((function e(t,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return At.Z.error("err :>> ".concat(t),{label:"DB_DUMP"}),e.abrupt("return",r.status(400).send({message:"Some Error Occurred"}));case 3:return ar().rmSync(u,{recursive:!0,force:!0}),ar().unlinkSync(i),_r()({url:"".concat(c,"db-export/").concat(o),method:"PUT",headers:{"Content-Type":"application/json","x-project-id":a},data:{key:null==n?void 0:n.Key}}).then((function(e){var t=e.data;return At.Z.info("response.data :>> ".concat(t),{label:"DB_DUMP"})})).catch((function(e){return At.Z.error("err :>> ".concat(e),{label:"DB_DUMP"})})),e.abrupt("return",r.status(200).send({key:n.Key}));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),At.Z.err("e: ".concat(e.t0),{label:"DB_DUMP"}),n(e.t0);case 22:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Fn=function(){var e=y()(O().mark((function e(t,r,n){var a,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a=t.body.key,s={Bucket:Bn,Key:a},Sn.deleteObject(s,(function(e){return e?r.status(400).send({msg:e.message}):r.status(200).send({msg:"deleted successfully"})}))}catch(e){console.log(e),n(e)}case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),$n=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.projectId,s=t.body,o=s.collectionName,c=s.fields,u=s.type,At.Z.info("Request Received",{label:"COLLECTION_DUMP"}),["CSV","JSON","MONGO_DUMP"].includes(u)){e.next=6;break}return e.abrupt("return",r.status(400).json({data:"Invalid Request Type"}));case 6:At.Z.info("Type Verified",{label:"COLLECTION_DUMP"}),At.Z.info("collectionName :>> ".concat(o),{label:"COLLECTION_DUMP"}),i="project_".concat(a),l=Nn,p="mongoexport --host ".concat(jn," --port ").concat(Un," --db ").concat(i," --collection ").concat(o),_="mongodump --host ".concat(jn," --port ").concat(Un," --db ").concat(i," --collection ").concat(o),d="".concat(l).concat(a,"/").concat(o),At.Z.info("ExportPath: ".concat(d," Export: ").concat(p," Dump: ").concat(_)),"CSV"===u?(At.Z.info("CSV Export",{label:"COLLECTION_DUMP"}),m="".concat(d,".csv"),f="".concat(p," --type=csv --out ").concat(m," --fields ").concat(c)):"JSON"===u?(At.Z.info("JSON Export",{label:"COLLECTION_DUMP"}),m="".concat(d,".json"),f="".concat(p," --jsonArray --pretty --out ").concat(m)):"MONGO_DUMP"===u&&(At.Z.info("MONGO Export",{label:"COLLECTION_DUMP"}),b="".concat(l).concat(a),f="".concat(_," --out ").concat(b),m="".concat(b,"/").concat(i,"/").concat(o,".bson")),At.Z.warn("query: >> ".concat(f," => exportedPath: >> ").concat(JSON.stringify(m)),{label:"COLLECTION_DUMP"}),ar().existsSync(m)&&(At.Z.info("Deleting Previous File",{label:"COLLECTION_DUMP"}),ar().unlinkSync(m)),Rn(f,{cwd:l,shell:!0,stdio:"inherit"}).on("close",function(){var e=y()(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(At.Z.info("code ".concat(t),{label:"COLLECTION_DUMP"}),0!==t){e.next=9;break}if(!ar().existsSync(m)){e.next=6;break}return e.abrupt("return",r.download(m));case 6:return e.abrupt("return",r.status(400).send("Failed to create file on server"));case 7:e.next=12;break;case 9:return At.Z.info("failed",{label:"COLLECTION_DUMP"}),r.status(400).json({message:"Failed to Download"}),e.abrupt("return");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),At.Z.error("dumpCollection: >> ".concat(e.t0),{label:"COLLECTION_DUMP"}),n(e.t0);case 25:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,r,n){return e.apply(this,arguments)}}(),qn=function(){var e=y()(O().mark((function e(t,r,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{Wn(t,r,function(){var e=y()(O().mark((function e(n){var a,s,o,c,u,i,l,p,_,d,f,m;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}throw n;case 2:if(a=t.file,s=t.params,o=t.projectId,c=s.type,u=s.collectionName,["CSV","JSON","MONGO_DUMP"].includes(c)){e.next=6;break}return e.abrupt("return",r.status(400).json({data:"Invalid Request Type"}));case 6:if(!a){e.next=23;break}return l="".concat(i=Nn).concat(o,"/"),ar().existsSync(l)||ar().mkdirSync(l),l="".concat(l).concat(a.originalname),console.log("mongoImportPath :>> ",l),console.log(ar().existsSync(l)),ar().existsSync(l)&&(At.Z.info("Deleting ".concat(l),{label:"COLLECTION_DUMP"}),ar().unlinkSync(l)),e.next=16,ar().writeFileSync("".concat(l),a.buffer);case 16:p="project_".concat(o),_="--host ".concat(jn," --port ").concat(Un," --db ").concat(p," --collection ").concat(u),d="mongoimport ".concat(_),f="mongorestore ".concat(_),"CSV"===c?m="".concat(d," --type csv --file ").concat(l," --headerline"):"JSON"===c?m="".concat(d," --jsonArray --file ").concat(l):"MONGO_DUMP"===c&&(m="".concat(f," ").concat(l)),Rn(m,{cwd:i,shell:!0,stdio:"inherit"}).on("close",(function(e){return 0===e?r.status(200).json({message:"Dump has been restored",success:!0}):r.status(400).json({message:"Dump may not bee restored",success:!1})}));case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(e){console.log(e),At.Z.error("restoreCollection: >> ".concat(e)),n(e)}case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Gn=o().Router();Gn.get("/dbdump/:uuid",g.interceptLogger,Kn),Gn.post("/dbdump/delete",g.interceptLogger,Fn),Gn.post("/take/",g.interceptLogger,$n),Gn.post("/restore/:collectionName/type/:type",g.interceptLogger,qn);const Jn=Gn;var Zn="".concat("/api/").concat("v1","/"),Hn="".concat(Zn,"projects"),zn="".concat(Zn,"auth"),Vn="".concat(Zn,"events"),Qn="".concat(Zn,"conditions"),Xn="".concat(Zn,"email"),Yn="".concat(Zn,"items"),ea="".concat(Zn,"collection-table"),ta="".concat(Zn,"collection-details"),ra="".concat(Zn,"open/collection-form"),na="".concat(Zn,"collection-form"),aa="".concat(Zn,"plaid"),sa="".concat(Zn,"fluid-pay"),oa="".concat(Zn,"external-api"),ca="".concat(Zn,"file"),ua="".concat(Zn,"form-themes"),ia="".concat(Zn,"marketplace-cart"),la=("".concat(Zn,"dev"),"".concat(Zn),"".concat(Zn,"admin"),"".concat(Zn,"external-api-middleware")),pa="".concat(Zn,"stripe-connect"),_a="".concat(Zn,"bng-payment"),da="".concat(Zn,"webhooks"),fa="".concat(Zn,"developer"),ma="".concat(Zn,"docs"),ba="".concat(Zn,"dump"),va="".concat(Zn,"indexes"),ha="".concat(Zn,"plugins"),ga=r(4587),xa=r(7525);r(3515);var ya="localhost",Ea="27017",Oa="localhost",ka="27017",Da=process.env.PROJECT_HOSTNAME;ya=ya||"localhost",Ea=Ea||27017,Oa=Oa||"localhost",ka=ka||27017;const Pa=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.subdomains,s=t.headers,o=t.originalUrl,c=t.hostname,u=!1,At.Z.info("PROJECT_HOSTNAME: >> ".concat(Da," hostname: >> ").concat(c)),Da===c&&(u=!0),i=s.origin,l=s.referer,p=s.projectid,At.Z.info("referer :>> ".concat(l," origin :>> ").concat(i)),e.prev=7,!o.includes("/api/v1/projects/build")){e.next=24;break}if(At.Z.warn("I am project build related"),p){e.next=12;break}return e.abrupt("return",r.status(400).json({message:"Not a valid project. Please contact Admin"}));case 12:if(_="project_config_".concat(p),!u){e.next=17;break}e.t0=Global_builderDB,e.next=20;break;case 17:return e.next=19,(0,ga.I)(Oa,_,ka);case 19:e.t0=e.sent;case 20:t.builderDB=e.t0,n(),e.next=99;break;case 24:if(!u){e.next=39;break}return At.Z.warn("I am global connection"),t.db=Global_db,t.builderDB=Global_builderDB,t.projectId=Global_projectId,t.projectName=Global_projectName,t.projectCreatedAt=Global_projectCreatedAt,t.projectConstants=Global_projectConstants,t.timezone=Global_timezone,t.projectRemoteDb=Global_projectRemoteDb,t.perconaDb=Global_perconaDb,t.environment=Global_environment,t.apiPublicAccess=Global_apiPublicAccess,t.connectorApiKey=Global_connectorApiKey,e.abrupt("return",n());case 39:if(d={$or:[]},f=null,!c.includes("api.prodeless.com")){e.next=51;break}if(i&&(At.Z.warn("I am inside origin"),i=(i=i.replace("http://","").replace("https://","")).split(":")[0],d.$or.push({domainName:i})),m=null,At.Z.info("subdomains:>> ".concat(a)),xa.S.includes(a[0])?(At.Z.warn("I am staging"),m=a[2]):m=a[1],void 0!==m||"undefined"!=m){e.next=48;break}return e.abrupt("return",r.status(400).send("Please use subdomain"));case 48:d.$or.push({seoName:m}),e.next=52;break;case 51:d={apiDomainName:c};case 52:return e.next=54,(0,ga.I)(Oa,"project_detail",ka);case 54:return b=e.sent,e.next=57,(0,$.T3)(b,d);case 57:if(f=e.sent,b.close(),t.db=null,t.builderDB=null,!f){e.next=98;break}return v="project_".concat(f.uuid),h="project_config_".concat(f.uuid),At.Z.info("***** pDatabase :>> ".concat(v," ***** pcDatabase :>> ").concat(h)),e.prev=65,e.next=68,(0,ga.I)(ya,v,Ea);case 68:return t.db=e.sent,e.next=71,(0,ga.I)(Oa,h,ka);case 71:t.builderDB=e.sent,e.next=77;break;case 74:e.prev=74,e.t1=e.catch(65),At.Z.error("error Failed to Connect Project Database ".concat(e.t1));case 77:if(t.perconaDb=null,t.projectRemoteDb=null,!(g=f.mongoConfig)){e.next=84;break}return e.next=83,(0,ga.X)(g);case 83:t.projectRemoteDb=e.sent;case 84:return x=null,(y=f.environments)&&0!==y.length?xa.V.includes("development")&&(console.log("I am CMS",y),x=y.find((function(e){return"PREVIEW"===e.envType}))):console.log("No Environment"),t.projectId=f.uuid,t.projectName=f.name,t.projectCreatedAt=f.createdAt,t.projectConstants=f.constants,t.timezone=f.timezone,t.environment=x,t.apiPublicAccess=f.enableDevKey,t.connectorApiKey=f.connectorApiKey,e.abrupt("return",n());case 98:return e.abrupt("return",r.status(404).send("This url does not exist. Please publish again."));case 99:e.next=105;break;case 101:return e.prev=101,e.t2=e.catch(7),At.Z.error("error failed to connect builder database :>> ".concat(e.t2)),e.abrupt("return",r.status(404).send("This url does not exist. Failed to connect to database"));case 105:case"end":return e.stop()}}),e,null,[[7,101],[65,74]])})));return function(t,r,n){return e.apply(this,arguments)}}();var Ia=function(){var e=y()(O().mark((function e(t,r,n,a,s){var o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,D.ME)(t,r,n,a,s);case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return",{code:400,message:"No Products found",status:"failed"});case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),wa=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("==> STRIPE CONNECT processCheckout has REFERENCE :>> ",t),a=t[0],s=r?JSON.parse(r).filter((function(e){return e.fieldName===a}))[0]:"",console.log("==> STRIPE CONNECT processCheckout has REFERENCE refCollectionData :>> "),o=s?s.refCollection.collectionName:"",c=s?s.refCollection.collectionField:"",u=n[a][0],console.log("==> STRIPE CONNECT processCheckout has REFERENCE refCollectionName :>> ",o,"==> refCollectionField :>> ",c,"==> refCollectionValue :>> ",u),u){e.next=10;break}return e.abrupt("return",{code:400,message:"Reference Collection Item not found",status:"failed"});case 10:return console.log("==> STRIPE CONNECT processCheckout refCollectionValue :>> "),e.abrupt("return",u[c]);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();function Ta(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ma(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ta(Object(r),!0).forEach((function(t){w()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ta(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Aa=["AUSTRALIA","BRAZIL","CANADA","EUROPE","JAPAN","MALAYSIA","NEW_ZEALAND","SINGAPORE","UNITED_STATES"],Ca=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,k,I,w,T,M,A,C,R,L,B,j,U,N,S,W,K,F,$,q,G,J,Z,H,z,Q,X,Y,ee,te;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.db,o=t.projectId,c=t.environment,e.prev=1,u=t.body,i=u.itemUuid,l=u.collectionName,p=u.nameField,_=u.descriptionField,d=u.priceField,f=u.selectedCollectionData,e.next=5,Ia(a,s,o,l,i);case 5:if(m=e.sent){e.next=8;break}return e.abrupt("return",r.json({code:400,message:"Item not found",status:"failed"}));case 8:if(console.log("==> STRIPE CONNECT processCheckout productToPurchaseResponse :>> "),b=m.data,v="",h="",g="",!p||!p.includes(".")){e.next=23;break}return x=p.split("."),e.next=17,wa(x,f,b);case 17:if(y=e.sent){e.next=20;break}return e.abrupt("return",r.json({code:400,message:"Reference item field not found",status:"failed"}));case 20:v=y,e.next=24;break;case 23:v=b[p];case 24:if(!_||!_.includes(".")){e.next=34;break}return E=_.split("."),e.next=28,wa(E,f,b);case 28:if(k=e.sent){e.next=31;break}return e.abrupt("return",r.json({code:400,message:"Reference item field not found",status:"failed"}));case 31:h=k,e.next=35;break;case 34:h=b[_];case 35:if(!d||!d.includes(".")){e.next=46;break}return I=d.split("."),e.next=39,wa(I,f,b);case 39:if(w=e.sent){e.next=42;break}return e.abrupt("return",r.json({code:400,message:"Reference item field not found",status:"failed"}));case 42:g=(T=w)?100*T:0,e.next=48;break;case 46:M=b[d],g=M?100*M:0;case 48:return console.log("==> STRIPE CONNECT processCheckout productName :>> ",v,"==> productDescription :>> ",h,"==> productAmount :>> ",g),e.next=51,(0,In.Z)(a,{code:"STRIPE_CONNECT",projectId:o});case 51:if(A=e.sent){e.next=54;break}return e.abrupt("return",r.json({code:400,message:"Stripe Connect Payment Plugin not installed",status:"failed"}));case 54:if(console.log("==> STRIPE CONNECT processCheckout installedStripeConnect"),C=A.setting,R=C.secretKey,L=C.failedURL,B=C.successURL,j=C.paymentMode,U=C.region,N=C.hasConnectedAccount,S=C.chargeType,W=C.currency,K=C.recurringInterval,R=(0,P.LO)(R,c),L=(0,P.LO)(L,c),B=(0,P.LO)(B,c),F=new bt.Stripe(R),$=(0,V.v4)(),q=[],G={collectionId:l,productId:i,transfer_group:$},J={currency:W,product_data:{name:v,description:h},unit_amount:g},"subscription"===j&&(J.recurring={interval:K||"month"}),q.push({price_data:J,quantity:1}),Z=Aa.includes(U),console.log("==> STRIPE CONNECT processCheckout doSeparatePayment",Z),H=null,z={line_items:q,mode:j,metadata:G,cancel_url:L,success_url:B},!N||"DIRECT_CHARGE"===S){e.next=108;break}return e.next=74,(0,D.pb)(a,s,o,"stripe_connected_accounts");case 74:if(Q=e.sent,console.log("==> STRIPE CONNECT processCheckout stripeConnectAccountItems :>> "),X=[],console.log("==> STRIPE CONNECT processCheckout productToPurchase.connectedAccountId :>> "),(Y=b.connectedAccountId?b.connectedAccountId:[])||(Y=b.connected_account_id?b.connected_account_id:[]),console.log("==> STRIPE CONNECT processCheckout productConnectedAccountIds :>> "),Y&&Y.length>0&&(X=Q?Q.filter((function(e){return Y.includes(e.uuid)})):[]),ee=X&&X.length>0?X[0]:"",console.log("==> STRIPE CONNECT processCheckout productConnectAccounts :>> "),"SEPARATE_CHARGE"!==S||!Z){e.next=96;break}if("subscription"!==j){e.next=91;break}return e.next=88,F.checkout.sessions.create(Ma(Ma({},z),{},{subscription_data:{transfer_group:$}}));case 88:H=e.sent,e.next=94;break;case 91:return e.next=93,F.checkout.sessions.create(Ma(Ma({},z),{},{payment_intent_data:{transfer_group:$}}));case 93:H=e.sent;case 94:e.next=106;break;case 96:if(te=ee.accountId,"subscription"!==j){e.next=103;break}return e.next=100,F.checkout.sessions.create(Ma(Ma({},z),{},{subscription_data:{transfer_data:{destination:te}}}));case 100:H=e.sent,e.next=106;break;case 103:return e.next=105,F.checkout.sessions.create(Ma(Ma({},z),{},{payment_intent_data:{transfer_data:{destination:te}}}));case 105:H=e.sent;case 106:e.next=111;break;case 108:return e.next=110,F.checkout.sessions.create(Ma({},z));case 110:H=e.sent;case 111:r.json({code:303,url:H.url}),e.next=117;break;case 114:e.prev=114,e.t0=e.catch(1),n(e.t0);case 117:case"end":return e.stop()}}),e,null,[[1,114]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ra=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,E,I,w,T,M,A,C,R,L,B,j,U;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.db,o=t.projectId,c=t.environment,e.prev=1,e.next=4,(0,In.Z)(a,{code:"STRIPE_CONNECT",projectId:o});case 4:if(u=e.sent){e.next=7;break}return e.abrupt("return",r.json({code:400,message:"Stripe Connect Payment Plugin not installed",status:"failed"}));case 7:if(console.log("==> STRIPE CONNECT processWebhook installedStripeConnect"),i=u.setting,l=i.webhookSecretKey,p=i.secretKey,_=i.region,d=i.hasConnectedAccount,f=i.chargeType,m=i.currency,l=(0,P.LO)(l,c),p=(0,P.LO)(p,c),b=l,console.log("==> STRIPE CONNECT endpointSecret :>> "),b){e.next=16;break}return e.abrupt("return",r.json({code:400,message:"Stripe Webhook Signing Secret key is required",status:"failed"}));case 16:if(v=new bt.Stripe(p),h=t.body,!b){e.next=31;break}g=t.body,console.log("==> STRIPE CONNECT processWebhook signature :>> "),x=JSON.stringify(g,null,2),E=v.webhooks.generateTestHeaderString({payload:x,secret:b}),e.prev=23,h=v.webhooks.constructEvent(x,E,b),e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(23),console.log("âš ï¸  Webhook signature verification failed.",e.t0.message),e.abrupt("return",r.status(400).send("Webhook Error: ".concat(e.t0.message)));case 31:e.t1=h.type,e.next="checkout.session.completed"===e.t1?34:70;break;case 34:if(I=h.data.object,console.log("==> STRIPE CONNECT processWebhook checkout completed paymentIntent :>> "),w=Aa.includes(_),!d||"SEPARATE_CHARGE"!==f||!w){e.next=69;break}return T=I.metadata.collectionId,M=I.metadata.productId,A=I.metadata.transfer_group,C=I.amount_total,console.log("==> STRIPE CONNECT processWebhook  transferGroupId :>> "),console.log("==> STRIPE CONNECT processWebhook  productAmount :>> "),e.next=46,(0,k.GB)(a,{collectionName:T,projectId:o});case 46:if(e.sent){e.next=49;break}return e.abrupt("return",r.json({code:400,message:"No collection data has found for ".concat(T),status:"failed"}));case 49:return console.log("==> STRIPE CONNECT processWebhook  collection"),e.next=52,Ia(a,s,o,T,M);case 52:if(R=e.sent){e.next=55;break}return e.abrupt("return",r.json({code:400,message:"Item not found",status:"failed"}));case 55:return console.log("==> STRIPE CONNECT processWebhook checkout.session.completed productToPurchaseResponse"),L=R.data,e.next=59,(0,D.pb)(a,s,o,"stripe_connected_accounts");case 59:B=e.sent,console.log("==> STRIPECONNECT processWebhook checkout completed stripeConnectAccountItems :>> "),j=[],console.log("==> STRIPECONNECT processCheckout productToPurchase.connectedAccountId :>> "),(U=L.connectedAccountId?L.connectedAccountId:[])||(U=L.connected_account_id?L.connected_account_id:[]),console.log("==> STRIPE CONNECT processCheckout productConnectedAccountIds :>> "),U&&U.length>0&&(j=B?B.filter((function(e){return U.includes(e.uuid)})):[]),console.log("==>STRIPECONNECT processWebhook checkout completed productConnectAccounts:>>"),j&&j.length>0&&j.forEach(function(){var e=y()(O().mark((function e(t){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.amountPercent,n=t.accountId,e.next=4,v.transfers.create({amount:C*(r/100),currency:m,destination:n,transfer_group:A});case 4:console.log("==> STRIPE CONNECT processWebhook checkout completed transfer :>> ");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 69:return e.abrupt("break",71);case 70:console.log("==> STRIPE CONNECT processWebhook Unhandled event type ".concat(h.type));case 71:r.send(),e.next=77;break;case 74:e.prev=74,e.t2=e.catch(1),n(e.t2);case 77:case"end":return e.stop()}}),e,null,[[1,74],[23,27]])})));return function(t,r,n){return e.apply(this,arguments)}}(),La=o().Router();La.post("/process-checkout",ce,Ca),La.post("/webhook",o().json({type:"application/json"}),ce,Ra);const Ba=La;var ja=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,k,D,P,I,w,T,M,A,C,R,L,B,j;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.db,o=t.projectId,e.prev=1,e.next=4,(0,In.Z)(a,{code:"BNG_PAYMENT",projectId:o});case 4:if(c=e.sent){e.next=7;break}return e.abrupt("return",r.json({code:400,message:"BNG Payment Plugin not installed",status:"FAILED"}));case 7:return console.log("==> BNG Payment processWebhook installedBNGPayment"),u=c.setting,i=t.body,l=i.itemUuid,p=i.collectionName,_=i.skuField,d=i.descriptionField,f=i.quantityField,m=i.selectedCollectionData,e.next=12,Ia(a,s,o,p,l);case 12:if(b=e.sent){e.next=15;break}return e.abrupt("return",r.json({code:400,message:"Item not found",status:"FAILED"}));case 15:if(console.log("==> BNG Payment processCheckout productToPurchaseResponse :>> "),v=b.data,h="",g="",x="",!_||!_.includes(".")){e.next=30;break}return y=_.split("."),e.next=24,wa(y,m,v);case 24:if(E=e.sent){e.next=27;break}return e.abrupt("return",r.json({code:400,message:"Reference item field not found",status:"FAILED"}));case 27:h=E,e.next=31;break;case 30:h=v[_];case 31:if(!d||!d.includes(".")){e.next=41;break}return k=d.split("."),e.next=35,wa(k,m,v);case 35:if(D=e.sent){e.next=38;break}return e.abrupt("return",r.json({code:400,message:"Reference item field not found",status:"FAILED"}));case 38:x=D,e.next=42;break;case 41:x=v[d];case 42:if(!f||!f.includes(".")){e.next=53;break}return P=f.split("."),e.next=46,wa(P,m,v);case 46:if(I=e.sent){e.next=49;break}return e.abrupt("return",r.json({code:400,message:"Reference item field not found",status:"FAILED"}));case 49:g=I||0,e.next=55;break;case 53:w=v[f],g=w||0;case 55:console.log("productQuantity",g),console.log("==> BNG PAYMENT processCheckout"),T=u.type,M=u.lineItemType,A=u.currency,C=u.showReceipt,R=u.redirectToSuccessUrl,L=u.sendToCustomer,B=[],M&&"purchase"!==M?"customPayment"===M&&(B=[{lineItemType:M,description:x,currency:A}]):B=[{lineItemType:M,sku:h,quantity:g}],console.log("lineItems",B),j={showReceipt:C,redirectToSuccessUrl:R,sendToCustomer:L},console.log("receipt",j),r.json({status:"SUCCESS",lineItems:B,receipt:j,type:T}),e.next=69;break;case 66:e.prev=66,e.t0=e.catch(1),n(e.t0);case 69:case"end":return e.stop()}}),e,null,[[1,66]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ua=o().Router();Ua.post("/process-checkout",ce,ja);const Na=Ua;var Sa=r(6268),Wa=function(){var e=y()(O().mark((function e(t,r,n,a,s){var o,c,u,i,l,p,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("webhooks").findOne({uuid:n,projectId:a});case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return",{status:405,message:"No Webhook Found with this project"});case 5:if(e.prev=5,c=o.collectionName,u=o.responseDataMapping,i=o.type,l=o.itemsPath,p=o.customPrimaryKey,c&&u){e.next=9;break}return e.abrupt("return",{status:405,message:"Collection Name or Mapping is missing"});case 9:return e.next=11,(0,Sa.r)(t,r,null,c,i,u,a,l,s,{},p);case 11:return _=e.sent,console.log("primaryKeyQuery processDataToSaveInDB :>> ",_),e.abrupt("return",{status:200,message:"Data has been updated. Please Reload."});case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",{status:405,message:e.t0});case 19:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),Ka=function(e,t,r,n){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(a){var s={body:e,header:t,url:r,response:arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,method:n,status:arguments.length>7&&void 0!==arguments[7]?arguments[7]:400,error:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,type:"WEBHOOK_API",token:arguments.length>8&&void 0!==arguments[8]?arguments[8]:null};(0,g.dbLogger)(s,a)}},Fa=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,u=t.body,console.log("projectId :>> ",c),i=o.webhookId,console.log("webhookId :>> ",i),console.log("body :>> ",u),e.next=8,Wa(a,s,i,c,u);case 8:Ka(u,t.headers,t.url,t.method,null,null,!0,200,null),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n(e.t0));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),$a=o().Router();$a.post("/:webhookId/process-data",ce,Fa);const qa=$a;var Ga=r(1758),Ja=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p,_,d,f,m;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.builderDB,s=t.params,o=t.headers,c=t.db,u=t.body,i=t.user,l=t.projectId,p=s.constructorId,_=s.collectionName,e.prev=2,e.next=5,(0,D.OK)(a,c,l,_,u,p,i);case 5:return f=e.sent,(0,Ga.Uk)(u,o,t.url,t.method,f,f.code,null,null==t||null===(d=t.headers)||void 0===d?void 0:d.token,!0),e.abrupt("return",r.status(f.code).send(f.data));case 10:e.prev=10,e.t0=e.catch(2),(0,Ga.Uk)(null==t?void 0:t.body,t.headers,t.url,t.method,null,500,e.t0,null==t||null===(m=t.headers)||void 0===m?void 0:m.token,!0),n(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Za=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.builderDB,a=t.params,s=t.headers,o=t.query,c=t.projectId,u=t.db,i=t.timezone,l=a.collectionName,p=a.filterUuid,_=s.authorization,e.prev=3,e.next=6,(0,Ga.vy)(n,u,null,c,l,p,_,i,s,o,0,1);case 6:f=e.sent,m=f.code,b=f.result,v=f.message,h=200!=m?{code:m,message:v}:b,(0,Ga.Uk)(null==t?void 0:t.body,s,t.url,t.method,h,m,null,null==t||null===(d=t.headers)||void 0===d?void 0:d.token,!0),r.status(m).json(h),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(3),(0,Ga.Uk)(null==t?void 0:t.body,t.headers,t.url,t.method,null,400,e.t0,null==t||null===(g=t.headers)||void 0===g?void 0:g.token,!0),console.log(e.t0),r.status(400).json({code:400,message:"Failed"});case 20:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(t,r){return e.apply(this,arguments)}}(),Ha=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_,d,f,m,b,v,h,g;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.builderDB,a=t.params,s=t.headers,o=t.query,c=t.projectId,u=t.db,i=t.timezone,l=a.collectionName,p=a.filterUuid,_=s.authorization,e.prev=3,e.next=6,(0,Ga.vy)(n,u,null,c,l,p,_,i,s,o,1,1);case 6:f=e.sent,m=f.code,b=f.result,v=f.message,console.log("code",m),console.log("result",b),console.log("message",v),h=200!=m?{code:m,message:v}:b,(0,Ga.Uk)(null==t?void 0:t.body,s,t.url,t.method,h,m,null,null==t||null===(d=t.headers)||void 0===d?void 0:d.token,!0),r.status(m).json(h),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(3),console.log("error",e.t0),(0,Ga.Uk)(null==t?void 0:t.body,s,t.url,t.method,null,400,e.t0,null==t||null===(g=t.headers)||void 0===g?void 0:g.token,!0),r.status(400).json({message:"Failed"});case 23:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(t,r){return e.apply(this,arguments)}}(),za=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,u=t.body.ids||t.query.ids,i=o.collectionName,l=t.query,e.next=7,(0,D.pb)(a,s,c,i,u,l);case 7:if(p=e.sent,(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,p,200,null,null==t||null===(n=t.headers)||void 0===n?void 0:n.token,!0),p){e.next=12;break}return r.status(200).send([]),e.abrupt("return");case 12:return e.abrupt("return",r.status(200).send(p));case 15:e.prev=15,e.t0=e.catch(0),(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,400,e.t0,null==t||null===(_=t.headers)||void 0===_?void 0:_.token,!0),r.status(400).json({message:"Failed"});case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),Va=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,u=t.body.ids||t.query.ids,i=o.collectionName,e.next=6,(0,D.nr)(a,s,c,i,u,t.query);case 6:if(l=e.sent,(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,l,200,null,null==t||null===(n=t.headers)||void 0===n?void 0:n.token,!0),l){e.next=11;break}return r.status(200).send([]),e.abrupt("return");case 11:return e.abrupt("return",r.status(200).send(l));case 14:e.prev=14,e.t0=e.catch(0),(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,400,e.t0,null==t||null===(p=t.headers)||void 0===p?void 0:p.token,!0),console.log("error",e.t0),r.status(400).json({message:"Failed"});case 19:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r){return e.apply(this,arguments)}}(),Qa=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.params,o=t.db,c=t.projectId,u=s.collectionName,i=s.itemUuid,e.next=5,(0,D.ME)(a,o,c,u,i);case 5:if(l=e.sent){e.next=10;break}return(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,404,{message:"Record not found with id ".concat(i)},null==t||null===(p=t.headers)||void 0===p?void 0:p.token,!0),r.status(404).send({message:"Record not found with id ".concat(i)}),e.abrupt("return");case 10:return(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,l,200,null,null==t||null===(n=t.headers)||void 0===n?void 0:n.token,!0),r.status(l.code).send(l.data),e.abrupt("return");case 15:e.prev=15,e.t0=e.catch(0),(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,400,e.t0,null==t||null===(_=t.headers)||void 0===_?void 0:_.token,!0),r.status(400).json({message:"Failed"});case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),Xa=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.params,o=t.body,c=t.user,u=t.projectId,i=t.db,l=s.collectionName,p=s.itemUuid,e.next=5,(0,D.ks)(a,i,u,l,p,o,c);case 5:return _=e.sent,(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,_.data,_.code,null,null==t||null===(n=t.headers)||void 0===n?void 0:n.token,!0),e.abrupt("return",r.status(_.code).send(_.data));case 10:e.prev=10,e.t0=e.catch(0),(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,400,null,null==t||null===(d=t.headers)||void 0===d?void 0:d.token,!0),r.status(400).json({message:"Failed"});case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),Ya=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.builderDB,s=t.db,o=t.params,c=t.projectId,u=o.itemUuid,i=o.collectionName,e.next=5,(0,k.n6)(a,c,i);case 5:if(e.sent){e.next=8;break}return e.abrupt("return",r.status(404).send(P.WS));case 8:return e.next=10,(0,D.Qo)(s,i,u);case 10:l=e.sent,(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,l,l.code||500,null,null==t||null===(n=t.headers)||void 0===n?void 0:n.token,!0),r.status(l.code||500).send(l),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),(0,Ga.Uk)(null==t?void 0:t.body,null==t?void 0:t.headers,t.url,t.method,null,400,null,null==t||null===(p=t.headers)||void 0===p?void 0:p.token,!0),r.status(400).json({message:"Failed"});case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}();const es=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.environment,s=t.apiPublicAccess,o=t.connectorApiKey,c=t.headers,u=c["x-api-key"],o!==u){e.next=5;break}return e.abrupt("return",n());case 5:if(At.Z.info("projectEnvs ".concat(JSON.stringify(a))),s){e.next=8;break}return e.abrupt("return",n());case 8:if(At.Z.info("projectEnvs ".concat(JSON.stringify(a))),a){e.next=11;break}return e.abrupt("return",n());case 11:if(i=a.key,!a.publicAccess){e.next=14;break}return e.abrupt("return",n());case 14:if(i){e.next=17;break}return At.Z.error("Neither Key generated nor mark it public"),e.abrupt("return",r.status(401).json({error:"API is not public and no key generated",status:"FAILED"}));case 17:if(At.Z.info("header key ".concat(u)),u){e.next=21;break}return At.Z.error("No keys provided"),e.abrupt("return",r.status(401).json({error:"Authentication key is missing ",status:"FAILED"}));case 21:if(i===u){e.next=24;break}return At.Z.error("Provided key is not valid"),e.abrupt("return",r.status(403).json({error:"Unauthorized, authorization key is not valid",status:"FAILED"}));case 24:return e.abrupt("return",n());case 27:return e.prev=27,e.t0=e.catch(0),At.Z.error(e.t0),e.abrupt("return",r.status(400).json({error:e.t0,status:"ERROR"}));case 31:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,r,n){return e.apply(this,arguments)}}();var ts=o().Router();ts.post("/collection/:collectionName/items/",ce,es,Ja),ts.get("/collection/:collectionName/items",ce,es,za),ts.get("/collection/:collectionName/updated-items",es,Va),ts.get("/collection/:collectionName/filter/:filterUuid/items",ce,es,Za),ts.get("/collection/:collectionName/filter/:filterUuid/count",ce,es,Ha),ts.post("/collection/:collectionName/itemsbyids",ce,es,za),ts.get("/collection/:collectionName/item/:itemUuid",ce,es,Qa),ts.put("/collection/:collectionName/item/:itemUuid",ce,es,Xa),ts.delete("/collection/:collectionName/item/:itemUuid",ce,es,Ya);const rs=ts;var ns=r(3515),as=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.body,a=t.db,s=n.collectionName,o=n.unique,c=void 0!==o&&o,u=n.indexes,i=n.name,l=void 0===i?"".concat(s,"-index"):i,u.length){e.next=6;break}return At.Z.info("index: >> indexes can't be empty",{label:"DB_INDEX"}),e.abrupt("return",r.status(400).json({msg:"Indexes can't be empty"}));case 6:return p={},u.map((function(e){p["".concat(e.fieldName)]="ASC"===e.orderBy?1:-1})),_={background:!0,name:l,unique:c},a.collection(s).createIndex(p,_),e.abrupt("return",r.status(201).json({msg:"Index will be created"}));case 13:return e.prev=13,e.t0=e.catch(0),At.Z.error("index: >> ".concat(e.t0),{label:"DB_INDEX"}),e.abrupt("return",r.status(500).json({msg:e.t0.message}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r){return e.apply(this,arguments)}}(),ss=function(){var e=y()(O().mark((function e(t,r){var n,a,s,o,c,u,i,l,p,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.body,a=t.db,s=n.collectionName,o=n.unique,c=void 0!==o&&o,u=n.indexes,i=n.name,l=void 0===i?"".concat(s,"-index"):i,u.length){e.next=6;break}return At.Z.info("index: >> indexes can't be empty",{label:"DB_INDEX"}),e.abrupt("return",r.status(400).json({msg:"indexes can't be empty"}));case 6:return p={},u.map((function(e){var t="ASC"===e.orderBy?1:-1;p["".concat(e.fieldName)]=t})),_={background:!0,name:l,unique:c},a.collection(s).dropIndex(p,_),e.abrupt("return",r.status(200).json({msg:"Indexing will be deleted"}));case 13:return e.prev=13,e.t0=e.catch(0),At.Z.error("index: >> ".concat(e.t0),{label:"DB_INDEX"}),e.abrupt("return",r.status(500).json({msg:e.t0.message}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r){return e.apply(this,arguments)}}(),os=o().Router();os.post("/create",g.interceptLogger,as),os.post("/delete",g.interceptLogger,ss);const cs=os;var us=function(){var e=y()(O().mark((function e(t,r){var n,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("plugins");case 2:return n=e.sent,e.next=5,n.findOne({code:"FLUID_PAY",projectId:r});case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),is=function(){var e=y()(O().mark((function e(t,r,n,a,s,o,c){var u,i,l,p,_,d,f,m,b,v,h,g,x,y,E,k,D,I,w,T,M,A,C,R,L;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.paymentResponseToken,i=s.collectionName,l=s.itemUuid,p=s.itemPriceField,_=s.itemDescField,d=s.paymentResponseUser,console.log("paymentResponseUser",d),f=o.privateKey,m=o.environment,b=o.currency,v=o.email_receipt,h=o.successURL,g=o.failedURL,x="",f=(0,P.LO)(f,c),console.log(">>> 8"),x="PRODUCTION"===m?"https://app.fluidpay.com/":"https://sandbox.fluidpay.com/",console.log("%c environmentUrl","color:yellow;border:1px solid red;text-shadow:2px 2px black;padding:3px;font-size:14px;",x),e.next=10,Ia(r,n,t,i,l);case 10:if(y=e.sent,console.log(">>> 9"),y){e.next=15;break}return console.log(">>> 10"),e.abrupt("return",{code:400,message:"Item not found",status:"FAILED"});case 15:return console.log("==> BNG Payment processCheckout productToPurchaseResponse :>> "),console.log(">>> 11"),E=y.data,k="",k=(k=E[p])||0,console.log("productPrice",k),D="",console.log("itemDescriptionField",_),D=E[_],console.log("productDescription",D),D=D||"Unique Project",console.log("productDescription",D),console.log(">>> 12"),I="user@email.com",v&&(I=a.userName?a.userName:a.email),w={type:"sale",amount:k,currency:b,description:D,email_receipt:v,email_address:I,payment_method:{token:u}},console.log(">>> 13"),T={headers:{Authorization:f,"Content-Type":"application/json"}},console.log(">>> 14",T),e.prev=35,e.next=38,_r().post("".concat(x,"api/transaction"),w,T);case 38:return M=e.sent,A=M.data,console.log(">>> 15"),console.log("fluidResponse",A),e.abrupt("return",{code:200,fluidResponse:A.data,status:"SUCCESS",successURL:h,failedURL:g});case 45:return e.prev=45,e.t0=e.catch(35),console.log(">>>> 16 Payment Failed"),console.log("error",e.t0),C="",e.t0.response&&(C=null===e.t0||void 0===e.t0||null===(R=e.t0.response)||void 0===R||null===(L=R.data)||void 0===L?void 0:L.msg),console.log("errorData",C),e.abrupt("return",{code:400,message:C,failedURL:g,status:"FAILED"});case 53:case"end":return e.stop()}}),e,null,[[35,45]])})));return function(t,r,n,a,s,o,c){return e.apply(this,arguments)}}(),ls=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.projectId,o=t.user,c=t.environment,o){e.next=3;break}return e.abrupt("return",r.status(401).send({code:403,message:"Invalid token."}));case 3:return e.prev=3,e.next=6,us(a,s);case 6:u=e.sent,i=u.setting.publicKey,i=(0,P.LO)(i,c),At.Z.info("apiKey Fluid Pay Setting: ".concat(i)),console.log("%c apiKey","color:yellow;border:1px solid red;text-shadow:2px 2px black;padding:3px;font-size:14px;",i),r.json({api_key:i}).status(200),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ps=function(){var e=y()(O().mark((function e(t,r,n){var a,s,o,c,u,i,l,p;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.builderDB,s=t.db,o=t.projectId,c=t.user,u=t.environment,i=t.body,console.log(">>> 1"),c){e.next=5;break}return console.log(">>> 2"),e.abrupt("return",r.status(401).send({code:403,message:"Invalid token."}));case 5:return console.log(">>> 4"),e.prev=6,console.log(">>> 5"),e.next=10,us(a,o);case 10:if(l=e.sent){e.next=14;break}return console.log(">>> 6"),e.abrupt("return",r.status(400).send({code:400,message:"Fluid Pay plugin not installed"}));case 14:return console.log(">>> 7"),e.next=17,is(o,a,s,c,i,l.setting,u);case 17:if("FAILED"!==(p=e.sent).status){e.next=20;break}return e.abrupt("return",r.status(p.code).json(p));case 20:return e.abrupt("return",r.status(200).json(p));case 23:e.prev=23,e.t0=e.catch(6),n(e.t0);case 26:console.log(">>> 17");case 27:case"end":return e.stop()}}),e,null,[[6,23]])})));return function(t,r,n){return e.apply(this,arguments)}}(),_s=o().Router();_s.post("/api-key",ce,ls),_s.post("/process-payment",ce,ps);const ds=_s;r(2707);var fs="5002";fs=fs||5001;var ms=o()();ms.use(l().urlencoded({extended:!0})),ms.use(l().json({limit:"50mb"})),ms.use(l().raw({limit:"50mb"})),ms.use(f()()),ms.use("/",o().static("public")),ms.use(_()()),ms.use(a()({exposedHeaders:["Content-Disposition"]})),(0,ns.default)();var bs={definition:{openapi:"3.0.3",schemes:["https"],consumes:["application/json"],produces:["application/json"],info:{title:"Drapcode API with Swagger",version:"1.1.0",description:"This is a developer API to perform basic action in your project.\\\n        \\\n        \\\n         1. **Production/Live:** *https://{project_seo_name}.api.drapcode.io/api/v1/developer*\\\n         \\\n         2. **Preview/Staging:** *https://{project_seo_name}.api.preview.drapcode.io/api/v1/developer*\\\n         \\\n         3. **UAT/Beta:** *https://{project_seo_name}.api.beta.drapcode.io/api/v1/developer*\\\n         \\\n         4. **Sandbox/Alpha:** *https://{project_seo_name}.api.alpha.drapcode.io/api/v1/developer*",contact:{name:"Drapcode",url:"https://drapcode.com",email:"info@drapcode.com"}},servers:[{url:"/api/v1/developer",description:"This is for build/publish server"},{}]},apis:["./developer/developer.route.js"]},vs=h()(bs);ms.use(ma,b().serve,b().setup(vs,{explorer:!0})),ms.use(Pa),ms.use(ba,Jn),ms.use(va,cs),ms.use(Hn,un),ms.use(zn,ke),ms.use(Vn,it),ms.use(Qn,dn),ms.use(Xn,de.EI,mt),ms.use(Yn,nt),ms.use(ea,ie),ms.use(oa,de.EI,Xt),ms.use(ca,we),ms.use(ta,hn),ms.use(ua,xn),ms.use(la,Pn),ms.use(pa,Ba),ms.use(_a,Na),ms.use(da,qa),ms.use(fa,rs),ms.use(ha,wn),ms.use(ia,de.$v,It),ms.use(ra,de.EI,z),ms.use(na,de.$v,Z),ms.use(aa,de.$v,Bt),ms.use(sa,de.$v,ds),ms.use(g.errorLogger),ms.get("/",(function(e,t){t.json({message:"Welcome to exchange application"})})),ms.all("*",(function(e,t,r,n){n(e)})),ms.listen(fs,(function(){console.log("Server is listening on port ".concat(fs))})),u().connection.on("error",(function(e){console.log("********** $$$$$$ ********"),console.log("Connection Broke from Database"),console.log("Connection Err :>> ",e),console.log("********** $$$$$$ ********")}))},8729:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(1185),a=new(0,n.Schema)({uuid:String,originalName:String,contentType:String,mimeType:String,size:Number,collectionName:String,projectId:String,key:String},{timestamp:!0});const s=n.model("FileUploads",a)},9914:(e,t,r)=>{"use strict";r.d(t,{GB:()=>m,My:()=>f,dY:()=>d,kB:()=>b,qL:()=>_,yH:()=>p});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(2167),u=r.n(c);r(8729);var i=r(1423),l=r(6231),p=function(){var e=a()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.model("FileUploads"),a=new n(r),e.abrupt("return",a.save());case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=a()(o().mark((function e(t,r){var n,a,s,c,u,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.originalname,a=r.mimetype,s=r.contentType,c=r.size,u=r.key,i=u.split("/"),l={uuid:i[2],originalName:n,contentType:s,mimeType:a,size:c,collectionName:i[1],projectId:i[0],key:u},e.next=5,p(t,l);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map(function(){var e=a()(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=a()(o().mark((function e(t,r,n,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.model("FileUploads"),e.next=3,s.find(r).limit(n).skip(n*a).exec();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),m=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.model("FileUploads"),e.abrupt("return",n.findOne(r));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=a()(o().mark((function e(t){var r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.basename(t),n="/Users/vijayshukla/Downloads/",n+=r,l.existsSync(n)&&l.unlinkSync(n),a=l.createWriteStream(n),e.prev=5,e.next=8,u()({method:"GET",url:t,responseType:"stream"});case 8:return e.sent.data.pipe(a),e.abrupt("return",new Promise((function(e,t){a.on("finish",e(n)),a.on("error",t)})));case 13:e.prev=13,e.t0=e.catch(5),console.log("error",e.t0);case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()},7705:(e,t,r)=>{"use strict";r.d(t,{cn:()=>D,lU:()=>C,Lf:()=>O,M6:()=>A,jJ:()=>w,fo:()=>P,mh:()=>k});var n=r(9591),a=r.n(n),s=r(1307),o=r.n(s),c=r(1738),u=r.n(c);const i=require("multer-s3");var l=r.n(i),p=r(5828),_=r(9336),d=r.n(_),f=r(7060),m=r(9914),b=r(2826),v=r(1423),h=r(6231),g=new(d().S3)({accessKeyId:"AKIAX4BKOZ6FHUQHT4KH",secretAccessKey:"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",region:process.env.AWS_S3_REGION}),x=u()({storage:l()({s3:g,acl:"public-read",bucket:"webconnect-upload",metadata:function(e,t,r){r(null,{fieldName:t.fieldname})},key:function(e,t,r){r(null,e.projectId+"/"+e.params.collectionId+"/"+(0,p.v4)()+"/"+t.originalname)}}),fileFilter:function(e,t,r){console.log("req.params:::",e.params),console.log("req.params:::",t),(0,b.in)(e.builderDB,e.projectId,e.params.collectionId,e.params.fieldId).then((function(e){console.log("field.validation::",e);var n=e.allowedFileTypes;console.log("noAllowedFiles,allowedFiles::",n);var a=n.join("|"),s=new RegExp(a).test(v.extname(t.originalname).toLowerCase());return console.log("extname:::",s),s?r(null,!0):r(new Error("Only ".concat(n.join(", ")," files are allowed!")),!1)}))}}),y=x.single("file"),E=x.array("files"),O=function(e,t,r){try{y(e,t,(function(r){return console.log(">>>>>>>>>>>>:: error in single file upload method::",r),console.log("IN route::",e.file),e.file?r instanceof u().MulterError||r?t.status(500).send(r.message):void(0,m.qL)(e.db,e.file).then((function(e){return console.log(e),t.status(200).send(e)})):t.status(500).send(r.message)}))}catch(e){console.log(">>>>>>>>>>>>>:: error in single file upload",e),r(e)}},k=function(){var e=a()(o().mark((function e(t,r,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{E(t,r,(function(e){return console.log(">>>>>>>>>>>>:: error in multiple file upload method::",e),console.log("IN route::",t.files),t.files?e instanceof u().MulterError||e?r.status(500).send(e.message):void(0,m.dY)(t.db,t.files).then((function(e){return console.log(e),r.status(200).send(e)})):r.status(500).send(e.message)}))}catch(e){console.log(">>>>>>>>>>>>>:: error in multiple file upload",e),n(e)}case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),D=function(){var e=a()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.yH)(t.db,t.body);case 3:n=e.sent,r.json(n),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),r.status(500).send({message:e.t0.message});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),P=function(){var e=a()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("event find all::",t.params,t.db.name),n=(0,f.calculatePageLimit)(t.query.limit,t.query.page),e.prev=2,e.next=5,(0,m.My)(t.db,{},n.limit,n.page);case 5:a=e.sent,console.log("result",a),r.status(200).send(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),r.status(500).send({message:e.t0.message||"Some error occurred while retrieving events."});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r){return e.apply(this,arguments)}}(),I=u()({storage:l()({s3:g,acl:"public-read",bucket:"webconnect-upload",metadata:function(e,t,r){r(null,{fieldName:t.fieldname})},key:function(e,t,r){r(null,e.projectId+"/"+(0,p.v4)())}})}).single("file"),w=function(e,t){I(e,t,(function(r){return console.log("IN route::",e.file),e.file?r instanceof u().MulterError||r?t.status(500).send(r.message):void(0,m.qL)(e.db,e.file).then((function(e){return console.log(e),t.status(200).send(e)})):t.status(500).send(r.message)}))},T=u().diskStorage({destination:function(e,t,r){var n="/Users/vijayshukla/Downloads/";console.log("*** localFilePath :>> ",n),r(null,n)},filename:function(e,t,r){var n=Date.now()+"-"+Math.round(1e9*Math.random());r(null,t.fieldname+"-"+n+"-"+t.originalname)}}),M=u()({storage:T}).single("file"),A=function(e,t){M(e,t,(function(r){return e.file?r instanceof u().MulterError||r?t.status(500).send(r.message):t.status(200).send(e.file):t.status(500).send(r?r.message:"File not found!")}))},C=function(){var e=a()(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("key",r,"fileName",t),n="/Users/vijayshukla/Downloads/",n+=t,h.existsSync(n)&&h.unlinkSync(n),console.log("localFilePath",n),a={Bucket:"webconnect-upload",Key:r},s=h.createWriteStream(n),e.abrupt("return",new Promise((function(e,t){var r=g.getObject(a).createReadStream();r.on("error",(function(e){console.error(e),t(null)})),s.once("finish",(function(){e(n)})),r.pipe(s)})));case 11:return e.prev=11,e.t0=e.catch(0),console.log("fileDownload",e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},7714:(e,t,r)=>{"use strict";r.d(t,{WS:()=>d,IQ:()=>W,Qr:()=>m,uO:()=>f,B$:()=>g,LO:()=>h,pS:()=>b}),r(8779),r(9591);var n=r(6958),a=r.n(n);r(1307);const s=require("mathjs");var o=r.n(s),c=r(7060),u=r(3790),i=r.n(u);r(1758);var l=r(4612),p=r(8032),_=r(9501),d=(new(i()),{code:404,message:"Collection not found with provided name"}),f=function(e){try{return e=(e=e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,""),JSON.parse(e)}catch(e){return{}}},m=function(e){return 0===Object.keys(e).length&&e.constructor===Object},b=10,v="environment_variable.",h=function(e,t){return e&&"string"==typeof e&&e.startsWith(v)&&t&&t.constants?t.constants.find((function(t){return t.name===e.replace(v,"")})).value:e},g=function(e,t,r,n){var a,s,o,c,u,i,p,_,d,f,m,b,v,h,g,M,L,W="",F=[];switch(e.args.forEach((function(e){var r=e.name,n=e.key;"formatType"===r?a=n:"restToLower"===r?s=n:"whitespace"===r?o=n:"type"===r?u=n:"noSplitopt"===r?c=n:"length"===r?i=n:"endopt"===r?p=n:"startLength"===r?_=n:"endLength"===r?d=n:"startString"===r?f=n:"endString"===r?m=n:"separator"===r?b=n:"expression"===r?W=n:"refField"===r?v=n:"index"===r?h=n:"match"===r?g=n:"refFieldType"===r?M=n:"condition"===r&&(L=n);var l=[];["formatType","restToLower","whitespace","type","noSplitopt","length","endopt","startLength","endLength","startString","endString","separator","expression","refField","index","match","refFieldType","condition"].includes(r)||(Array.isArray(n)?(n.forEach((function(e){l.push(t[e])})),F.push(l)):F.push(t[n]))})),e.functionType){case"CAPITALIZE":return x(F[0],s);case"LOWER_CASE":return y(F[0]);case"UPPER_CASE":return E(F[0]);case"SLUGIFY":return O(F[0]);case"TRIM":return k(F[0],o,u);case"TITLE_CASE":return D(F[0],c);case"TRUNCATE":return P(F[0],i,p);case"SUB_STRING":return I(F[0],_,d);case"STRING_JOIN":return w(F[0],b,f,m);case"CUSTOM_SENTENCE":return T(W,t,r,n);case"ADDITION":return C(a,{numbers:F[0]});case"AVERAGE":return A(a,{numbers:F[0]});case"MULTIPLY":return R(a,{numbers:F[0]});case"DIVIDE":return U(a,{number1:F[0],number2:F[1]});case"CUSTOM_CALCULATION":return N(W,t,r,a,n);case"CUSTOM_JS_LOGIC":return S(W,t,r,n);case"SUBSTRACTION":return B(a,{numbers1:F[0],numbers2:F[1]});case"COUNT":return j(F[0],L,v,g,M);case"FIND_RECORD":return K(F[0],v,h);case"FORMAT_DATE":return l(a,F[0]);default:return""}},x=function(e,t){return _.capitalize(e,"TRUE"===t)},y=function(e){return _.lowerCase(e)},E=function(e){return _.upperCase(e)},O=function(e){return _.slugify(e)},k=function(e,t,r){return"LEFT"===r?_.trimLeft(e,t):"RIGHT"===r?_.trimRight(e,t):_.trim(e,t)},D=function(e,t){return _.titleCase(e,[t])},P=function(e,t,r){return _.truncate(e,t,r)},I=function(e,t,r){return _.substr(e,t,r)},w=function(e,t,r,n){return t=t?t.replace(/##@@##@@##/g," "):" ",e=(e=Array.isArray(e)?e:[e]).filter(Boolean),"".concat(r?r.replace(/##@@##@@##/g," ")+t:"").concat(e.join(t)).concat(n?t+n.replace(/##@@##@@##/g," "):"")},T=function(e,t,r,n){return e=e?M(e):" ",(0,c.replaceDataValueIntoExpression)(e,t,r,n)},M=function(e){return e.replace(/##@@##@@##/g," ").replace(/##@@##@@@@/g,">").replace(/@@@@##@@@@/g,"<").replace(/U\+000A/g,"<br/>")},A=function(e,t){var r=t.numbers;return p(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){return e+t}),0)/e.length}(a()(r))).format(e||"00.00")},C=function(e,t){var r=t.numbers,n=a()(r).reduce((function(e,t){return e+t}),0);return p(n).format(e||"00.00")},R=function(e,t){var r=t.numbers,n=a()(r).reduce((function(e,t){return e*t}),0);return p(n).format(e||"00.00")},L=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,t){return e+t}),0)},B=function(e,t){var r=t.numbers1,n=t.numbers2,s=Array.isArray(r)?L(a()(r)):r,o=Array.isArray(n)?L(a()(n)):n;return p(s-o).format(e||"00.00")},j=function(e,t,r,n,a){switch(t){case"EQUALS":e=e.filter((function(e){return!!["dynamic_option","static_option"].includes(a)&&e[r].includes(n)}));break;case"NOT_EQUAL":e=e.filter((function(e){return!!["dynamic_option","static_option"].includes(a)&&!e[r].includes(n)}))}return e.length},U=function(e,t){var r=t.number1,n=t.number2;return p(o().divide(r,n)).format(e||"00.00")},N=function(e,t,r,n,a){e=e?M(e):" ";var s=(0,c.replaceDataValueIntoExpression)(e,t,r,a);try{return p(o().evaluate(s)).format(n||"00.00")}catch(e){return""}},S=function(e,t,r,n){e=e?M(e):" ";var a=(0,c.replaceDataValueIntoExpression)(e,t,r,n);try{return new Function(a.toString())()}catch(e){return""}},W=function(e){return function(t,r){return t[e]&&r[e]&&"undefined"!==t[e]&&"undefined"!==r[e]?"number"==typeof t[e]||"number"==typeof r[e]?t[e]<r[e]?-1:t[e]>r[e]?1:0:t[e].toLowerCase()<r[e].toLowerCase()?-1:t[e].toLowerCase()>r[e].toLowerCase()?1:0:0}},K=function(e,t,r){return"FIRST_RECORD"===r?e[0][t]:"LAST_RECORD"===r?e[e.length-1][t]:void 0}},6540:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});const n=require("winston");var a=n.format.timestamp,s=n.format.combine,o=n.format.align,c=n.format.printf,u=n.format.errors,i={level:process.env.LOG_LEVEL||"info",transports:[new n.transports.Console],format:s(u({stack:!0}),a({format:"MMM-DD-YYYY HH:mm:ss"}),o(),c((function(e){return"".concat(e.timestamp,"|[").concat(e.label||"","]|").concat(e.level.toUpperCase(),"=>").concat(e.message)})))};const l=(0,n.createLogger)(i)},4786:(e,t,r)=>{"use strict";r.d(t,{It:()=>c,NZ:()=>i,oH:()=>o});var n=r(9501),a=r.n(n),s=(r(6517),r(7060)),o=function(e){if(!e)return!1;var t=new RegExp(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/);return e.match(t)},c=function(e,t,r,n,o){if(t&&a().startsWith(e,t)&&(e=a().last(e,e.length-t.length)),n&&a().endsWith(e,n)){var c=a().lastIndexOf(e,n);e=a().first(e,c)}return r&&a().startsWith(e,"0")&&(e=u(a().slice(e,1))),console.log("previousUuid 4",e),(0,s.nextGeneratedString)(e,t,r,n,o)},u=function e(t){for(;a().startsWith(t,"0");)t=e(a().slice(t,1));return t},i=function(e,t,r,n){var a=p(n),s=l(t,a);return"".concat(e).concat(s).concat(r)},l=function(e,t){for(var r="",n=t.length,a=0;a<e;a++)r+=t.charAt(Math.floor(Math.random()*n));return r},p=function(e){return"randomAlphanumeric"===e?"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ":"randomNumeric"===e?"0123456789":"randomAlphabet"===e?"ABCDEFGHIJKLMNOPQRSTUVWXYZ":void 0}},4971:e=>{"use strict";e.exports=require("@babel/register")},9591:e=>{"use strict";e.exports=require("@babel/runtime/helpers/asyncToGenerator")},8779:e=>{"use strict";e.exports=require("@babel/runtime/helpers/defineProperty")},353:e=>{"use strict";e.exports=require("@babel/runtime/helpers/slicedToArray")},6958:e=>{"use strict";e.exports=require("@babel/runtime/helpers/toConsumableArray")},9293:e=>{"use strict";e.exports=require("@babel/runtime/helpers/typeof")},1307:e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},3844:e=>{"use strict";e.exports=require("adm-zip")},9336:e=>{"use strict";e.exports=require("aws-sdk")},2167:e=>{"use strict";e.exports=require("axios")},7096:e=>{"use strict";e.exports=require("bcrypt")},306:e=>{"use strict";e.exports=require("chance")},6303:e=>{"use strict";e.exports=require("child_process")},7745:e=>{"use strict";e.exports=require("clean-css")},1626:e=>{"use strict";e.exports=require("csv-stringify")},4612:e=>{"use strict";e.exports=require("dateformat")},3790:e=>{"use strict";e.exports=require("device-detector-js")},5142:e=>{"use strict";e.exports=require("dotenv")},7060:e=>{"use strict";e.exports=require("drapcode-utility")},1239:e=>{"use strict";e.exports=require("events")},4945:e=>{"use strict";e.exports=require("external-api-util")},6231:e=>{"use strict";e.exports=require("fs")},6517:e=>{"use strict";e.exports=require("lodash")},2245:e=>{"use strict";e.exports=require("moment")},1185:e=>{"use strict";e.exports=require("mongoose")},1738:e=>{"use strict";e.exports=require("multer")},8032:e=>{"use strict";e.exports=require("numeral")},3511:e=>{"use strict";e.exports=require("passport")},136:e=>{"use strict";e.exports=require("passport-jwt")},7055:e=>{"use strict";e.exports=require("passport-local")},1423:e=>{"use strict";e.exports=require("path")},5828:e=>{"use strict";e.exports=require("uuid")},9501:e=>{"use strict";e.exports=require("voca")}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__(1239).EventEmitter.defaultMaxListeners=25,__webpack_require__(5142).config(),__webpack_require__(4971)({presets:["@babel/preset-env"]}),__webpack_require__(1186)})();